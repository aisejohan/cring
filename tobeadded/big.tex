

\subsection{$\spec R$ and the Zariski topology}

\lecture{[Section] 9/12}

\subsection{The ideal class group}

This was taught by X. Wang at a recitation.

\begin{example} 
Consider the nonprincipal ideal $I=(2 , 1+\sqrt{-5}) \subset
\mathbb{Z}[\sqrt{-5}]$.  It is nonprincipal (exercise), but its square is
$(2)$, which is principal.  So $I$  is not principal, but its square is.  How
can we make this more general? 
\end{example} 

\newcommand{\cl}{\mathrm{Cl}}

In an integral domain $R$, we define $\cl(R)$ to be the set of all nonzero ideals $I
\subset R$ modulo the relation that $I \sim J$ if there is $\alpha, \beta \in
R^*$ such that $\alpha I = \beta J$.

\begin{definition} 
We define $\cl(R)$ to be the \textbf{ideal class set} of $R$.
\end{definition} 

We need to check that this is a group.
Clearly we can define a notion of multiplication by multiplying ideals. The
unit ideal is the unit element.  
But do inverses exist?  Given $I$, is there an ideal $J$ such that
\[ IJ \ \mathrm{is} \ \mathrm{principal?} \]

\subsection{Dedekind domains}
\begin{theorem} 
Let $R$ be a domain such that:
\begin{enumerate}
\item $R$ is noetherian (i.e. every ideal is finitely generated).
\item Every nonzero prime ideal of $R$ is maximal. (I.e. $R$ has Krull
dimension one.)
\item $R$ is integrally closed.
\end{enumerate}
Then the ideal class set is a group.  
\end{theorem} 

\begin{proof} 
We need to prove that for any $I$, there is another ideal $J$ such that $IJ $
is prinicpal.  Pick $I \subset R$.  We can assume $I \subsetneq R$.  Take an
element $\alpha \in I - \left\{0\right\}$.  If we can find an ideal $J$ such
that $IJ = (\alpha)$, we should take $J$ to be the set
\[ J = \left\{x: xI \subset (\alpha) \right\}.  \]
We have $IJ \subset (\alpha)$.
Now consider $\mathfrak{b}=\frac{1}{\alpha} IJ$; this is an ideal, because it is a submodule
of $R$.  We are to prove that it is equal to $R$.

Suppose not. Suppose $c \in \mathfrak{b} - \left\{0\right\}$.  We know that
$\mathfrak{b}$ is contained in a maximal ideal $\mathfrak{m}$ since
$\mathfrak{b} \neq R$ by assumption. We have a chain of ideals
\[ (c) \subset \mathfrak{b} \subset \mathfrak{m}.  \]

\begin{lemma} 
If $R$ is noetherian, then every ideal contains a product of nonzero prime
ideals.
\end{lemma} 
\begin{proof} 
Consider the set of all ideals that do not contain a product of nonzero
primes.  Then this set $S$ has a maximal element if it is nonempty.  Call this
element $\mathfrak{n}$.  Clearly $\mathfrak{n}$ isn't prime or it wouldn't be
in $S$.  
This means that there are $a,b \notin \mathfrak{n}$ with $ab \in
\mathfrak{n}$.  In particular, if we look at the ideals
\[ \mathfrak{n} + (a), \mathfrak{n} + (b) \supsetneq \mathfrak{n}  \]
then these contain products of primes. So their product
\[ (\mathfrak{n} + (a))(\mathfrak{n}+(b)) \subset \mathfrak{n}  \]
contains a product of primes. Thus $\mathfrak{n}$ contains a product of primes.  
\end{proof} 


In particular, $(c)$ contains a product of primes $\mathfrak{p}_1 \dots
\mathfrak{p}_r$. Suppose $r$ is the minimal possible so $(c)$ does not contain
any product of $r-1$ ideals.  
We have that 
\[ \mathfrak{p}_1 \dots \mathfrak{p}_r \subset \mathfrak{m}  \]
so one $\mathfrak{p}_i$, wlog $\mathfrak{p}_1$, must lie in the prime (and
maximal) ideal $\mathfrak{m}$.  

But every nonzero prime ideal is maximal, so $\mathfrak{m} = \mathfrak{p}_1$.  

\begin{lemma} 
Under the above hypotheses, there is $\gamma \in K - R$ with $\gamma
\mathfrak{b} \subset R$.
\end{lemma} 
\begin{proof} 
Suppose $r=1$. We have
\[ \mathfrak{m} \supset \mathfrak{b} \supset (c) \supset \mathfrak{p}_1 =
\mathfrak{m}. \]
So $\frac{1}{c}\mathfrak{b} \subset R$.  

Suppose $r >1$.  We know then that $\mathfrak{p}_2 \dots \mathfrak{p}_r
\not\subset (c)$, and we can choose an element $d \in \mathfrak{p}_2 \dots
\mathfrak{p}_r - (c)$.  
Then 
\[ \frac{d}{c}\mathfrak{b} \subset \frac{d}{c}\mathfrak{m} \subset
\frac{1}{c} \mathfrak{p_2}\dots \mathfrak{p}_r \mathfrak{p}_1 \subset R.  \]
\end{proof} 

So we have something in the fraction field such that when we multiply by it, we
get something in $R$.

Recap: We started with an ideal $I \neq 0 \subset R$ and chose $\alpha \in I -
\left\{0\right\}$. We took $J$ to be the conductor of $I$ in $(\alpha)$.  We
took $\mathfrak{b}=\frac{1}{\alpha} IJ$, which we want to prove to be $R$.  Now
we have found something outside of $R$ which takes $\mathfrak{b}$ into tiself.

\begin{lemma} 
$\gamma J \subset J$.
\end{lemma} 
\begin{proof} 
We need to show 
\[ \gamma J I \subset (\alpha),  \]
i.e.
\[ \gamma \frac{IJ}{\alpha} \subset R  \]
which we showed earlier as $\mathfrak{b} = \frac{IJ}{\alpha}$.
\end{proof} 
Now since $J$ is finitely generated, we see that $\gamma$ is integral over $R$. (This will be
talked about in class.) So $\gamma \in R$, contradiction.
\end{proof} 


\begin{definition} 
A \textbf{Dedekind domain} is a domain  if it satisfies the above three
conditions: it is noetherian, every nonzero prime is maximal, and it is
integrally closed.
\end{definition} 

So in a Dedekind domain, we have a notion of an ideal class group.  I.e.,
$\cl(R)$ is a group.  

\begin{corollary} 
$R$ admits unique factorization into ideals.
\end{corollary} 
\begin{proof} 
Exercise.  
\end{proof}

\begin{example} 
\begin{enumerate}
\item $\mathbb{Z}$.  More generally, any PID (which is a UFD, hence
integrally closed).  Any ideal is generated by one element, and every prime is
maximal. This is an uninteresting example because the ideal class group is
$\left\{1\right\}$.
\item The ring of integers of a number field.  Let's discuss this.
\end{enumerate}

Recall that a \textbf{number field} is a finite extension of $\mathbb{Q}$.   An
element of a number field $K$ is \textbf{integral} if it satisfies a monic
polynomial with coefficients in $\mathbb{Z}$.  It is known (and probably will
be proved in class) that the set of all
integral elements form a ring $\mathcal{O}_K$.  

\begin{proposition} 
$\mathcal{O}_K$ is a Dedekind domain. 
\end{proposition} 
\begin{proof} 
$\mathcal{O}_K$ is an integral closure, so it is integrally
closed.\footnote{This will be discussed in class! This is not a complete proof.} 
We cheat again and quote another result:

\begin{lemma} 
There is a finite $\mathbb{Z}$-basis for $\mathcal{O}_K$.
\end{lemma} 
In particular, $\mathcal{O}_K$ is a finite $\mathbb{Z}$-module, and
consequently is a noetherian ring.  

We need now only to show that  any prime ideal is maximal.  Let $\mathfrak{p}
\subset \mathcal{O}_K$ be prime; we must show that it is maximal. It is easy to
check that $\mathcal{O}_K/\mathfrak{p}$ is a  finite integral domain by
choosing a triangular $\mathbb{Z}$-basis for $\mathfrak{p}$. But a finite
integral domain is a field.  
\end{proof} 
\newcommand{\card}{\mathrm{card}}
We denote by $h_K$ the size of the class group $\card  \cl(\mathcal{O}_K)$.
This is finite for number fields, which is a very important result.  

\begin{exercise} 
In the field $K = \mathbb{Q}(\sqrt{-5})$, one can show that the ring of
integers is $\mathbb{Z}[\sqrt{-5}]$.  The ideal $I = (2, 1+\sqrt{-5})$ is a
nontrivial element of $\cl(\mathcal{O}_K)$, but its square is trivial.  

Using the Minkowski bound, one can show that any ideal is equivalent to any
ideal of norm at most two or three, whence it can be shown that $I$ generates
$\cl(\mathcal{O}_K)$.
\end{exercise} 

Note that in the exercise, $\mathcal{O}_K$ was also not a UFD, because 6
admitted two different factorizations. This is no coincidence:

\begin{proposition} 
If $R$ is  a Dedekind domain, then $R$ is a UFD if and only if $\cl(R) =
\left\{1\right\}$.
\end{proposition} 
\begin{proof} 
One way is clear because a PID is a UFD.  The other direction is an exercise. 
\end{proof} 


\end{example} 
\lecture{9/13}


\subsection{Discrete valuation rings}
We will talk about discrete valuation rings today.  

First, we review the idea of localization. Let $R$ be a commutative ring and
$S$ a multiplicative subset. Then there is a correspondence between prime
ideals in $S^{-1}R$ and prime ideals of $R$ not intersecting $S$.

Recall also that a domain $R$ is a \textbf{Dedekind domain} if:
\begin{enumerate}
\item $R$ is noetherian. 
\item Every prime ideal of $R$ is maximal.
\item  $R$ is integrally closed. 
\end{enumerate}

Fix a Dedekind domain $R$.
Take a nonzero prime ideal $\mathfrak{p} \subset R$, and look at the localization
$R_{\mathfrak{p}}$. The prime ideals of this local ring are just $\mathfrak{p}$
and $0$, because every nonzero prime ideal is maximal. In particular,
\[ \spec R_{\mathfrak{p}}  = \left\{(0), \mathfrak{p}R_{\mathfrak{p}}\right\} .\]
The closed subsets are just $\{\mathfrak{p}R_{\mathfrak{p}}\}$ and the whole
space. So $\mathfrak{p}R_{\mathfrak{p}}$ is called a \textbf{closed point}
while $(0)$ is called a \textbf{generic point}  because its closure is the
whole space.  

Consider an ideal of $R_{\mathfrak{p}}$. This can be written as the form $I
R_{\mathfrak{p}}$ for $I$ an ideal in $R$.  But $R$ is a Dedekind domain. So we have that
\[ I = \prod \mathfrak{p}_i  \]
for some (not necessarily distinct) prime ideals $\mathfrak{p}_i$ of $R$, by unique factorization of
ideals. Thus we get a factorization of $IR_{\mathfrak{p}}$ as
\[ I R_{\mathfrak{p}} = \prod \mathfrak{p}_i R_{\mathfrak{p}}  \]
which is just a power of 
\[ \mathfrak{p}R_{\mathfrak{p}},  \]
though, since $\mathfrak{p}_i R_{\mathfrak{p}} = R_{\mathfrak{p}}$ if
$\mathfrak{p}_i \neq \mathfrak{p}$. 
Suppose $I R_{\mathfrak{p}} = (\mathfrak{p}R_{\mathfrak{p}})^n$. 
\begin{definition} 
Then $n$ is called the \textbf{$\mathfrak{p}$-adic valuation} of $I$ and is
denoted $v_{\mathfrak{p}}(I)$. The
$\mathfrak{p}$-adic valuation of $x \in R - \left\{0\right\}$ is defined to be the valuation of
$(x)$ and is denoted $v_{\mathfrak{p}}(x)$.
\end{definition} 

Here are some properties of $v_{\mathfrak{p}}$:

\begin{enumerate}
\item $v_{\mathfrak{p}}(xy) = v_{\mathfrak{p}}(x) + v_{\mathfrak{p}}(y)$.
\item $v_{\mathfrak{p}}(x+y) \geq \min (v_{\mathfrak{p}}(x),
v_{\mathfrak{p}}(y))$.
\end{enumerate}

It is clear that $v_{\mathfrak{p}}(x)=0$ if and only if $x$ is a unit in
$R_{\mathfrak{p}}$. Also, if $v_{\mathfrak{p}}(x) = 1$, then
\[ (x) R_{\mathfrak{p}} = \mathfrak{p}R_{\mathfrak{p}}  \]
implying that $x$ generates $\mathfrak{p}R_{\mathfrak{p}}$.

It is not obvious that there exists such an $x$ with valuation one, though.
However:

\begin{proposition} 
$R_{\mathfrak{p}}$ is a PID.
\end{proposition} 
\begin{proof} 
We know that $\mathfrak{p} \neq \mathfrak{p}^2$ in $R$ because otherwise we
could multiply by an inverse to get $(1) \in \mathfrak{p}$. Take $a \in
\mathfrak{p} - \mathfrak{p}^2$.  Then it is clear that 
\[ (a) R_{\mathfrak{p}} \subset \mathfrak{p}R_{\mathfrak{p}}  \]
but 
\[ (a) R_{\mathfrak{p}} \not\subset (\mathfrak{p}^2)R_{\mathfrak{p}}  \]
so that $a$ has valuation one. 
\end{proof} 


We now make:

\begin{definition} 
A ring $R$ is a \textbf{discrete valuation ring (DVR)} if it is a PID and has a
unique nonzero prime ideal $\mathfrak{m}$. Any element generating
$\mathfrak{m}$ is called a \textbf{uniformizer}.	
\end{definition} 


If $\mathfrak{p} \subset R$ is a nonzero prime ideal of a Dedekind domain $R$,
then we have shown that $R_{\mathfrak{p}}$ is a DVR. 

If $R$ is a DVR, then $R$ is a Dedekind domain, so we can define the
$\mathfrak{m}$-adic valuation on $R$, because every nonzero ideal of $R$ is a  product
of copies of $\mathfrak{m}$.

Alternatively one defines $v_{\mathfrak{m}}(x)$ as the largest $n$ such that $x
\in \mathfrak{m}^n$.
One has to check then that
\[ \bigcap \mathfrak{m}^n = (0) \]
which can be done.
Thus we get our valuation, in either case.

The valuation extends to the field of fractions $K$, so we get a map
\[ K^* \to \mathbb{Z}  \]
by defining $v_{\mathfrak{m}}(x/y) = v_{\mathfrak{m}}(x) -
v_{\mathfrak{m}}(y)$. It is easy to see that this is well-defined.  

\begin{remark} 
$R$ is precisely the set of elements of $K$ with nonnegative valuation.  $R^*$
(the units of $R$) are precisely the elements with zero valuation.
$\mathfrak{m}$ consists of elements with positive valuation. 
\end{remark} 

\begin{definition} 
The quotient $R/\mathfrak{m}$ is called the \textbf{residue field}.
\end{definition} 

One can also define a discrete valuation ring by starting with a field with
such a valuation $v: K^* \to \mathbb{Z}$. One defines the ring by taking the
set of elements with nonnegative valuation. 

\begin{definition} 
The pair $(K, v)$ for $K$ a field is a \textbf{discrete valuation field} if $v:
K^* \to \mathbb{Z}$ is a surjective homomorphism satisfying
the \textbf{ultrametric property}
\[ v(x+y) \geq \min v(x), v(y).  \]
\end{definition} 

\begin{exercise} 
If $(K,v)$ is a discrete valuation field, then the set $R=\left\{x \in K:
v(x) \geq 0\right\}$ is a discrete valuation ring whose quotient field is $K$. 
\end{exercise} 

\begin{example} 
Let $K = \mathbb{C}((t))$ of formal series
\[ \sum_{n \geq n_0} a_n t^n, \quad \forall a_n \in \mathbb{C}.  \]
This is the field of fractions of the power series ring $\mathbb{C}[[t]]$.
Indeed, this is easily seen because the units of the power series ring are
precisely the formal power series $\sum_{n \geq 0} a_n t^n$ with $a_0 \neq 0$. 

We can define the \textbf{$t$-adic valuation} of $\sum_{n \geq n_0} a_n t^n \in
\mathbb{C}[[t]]$ to be $n_0$ if $a_{n_0} \neq 0$. So the $t$-adic valuation is
the order at zero.
\end{example} 

\begin{theorem} 
Suppose $R$ is a noetherian domain such that all the localizations at non-zero primes are DVRs. Then $R$ is a
Dedekind domain.  
\end{theorem} 

Interestingly, this result is \textbf{false} without noetherian hypothesis.
\begin{proof} 
We've shown that a Dedekind domain has localizations which are DVRs above.
Suppose $R$ is a domain whose localizations $R_{\mathfrak{m}}$ at
\emph{maximal} $\mathfrak{m}$ are DVRs; then we show that $R$ is Dedekind.

First, we  have assumed that $R$ is noetherian. 

It is clear that $R$ has dimension one if all its localizations at maximal
ideals have dimension 1.

$R$ is integrally closed because it is the intersection in its quotient field
of the integrally closed domains $\bigcap R_{\mathfrak{m}}$.  Cf. the lemma
below.
\end{proof} 

\begin{lemma} 
For $R$ any integral domain, we have
\[ R = \bigcap_{\mathfrak{m} \ \mathrm{maximal}} R_{\mathfrak{m}} . \]

The intersection is taken inside the field of fractions.
\end{lemma} 

\begin{proof} 
Exercise to the reader.
\end{proof} 

There is, incidentally, a harder result:
\begin{theorem} 
$R$ is an integral domain which is integrally closed, then 
\[ R = \bigcap_{\mathfrak{p} \ \mathrm{height \ }1 } R_{\mathfrak{p}}.	  \]
\end{theorem} 
\begin{proof} 
Omitted.
\end{proof} 



Let now $R$ be a Dedekind domain.
For each localization $R_{\mathfrak{p}}$, we have a valuation
$v_{\mathfrak{p}}$ on $R$. What interaction do these have with each other?
Answer: they're basically independent.
Let's see what this means.

If $I$ is an ideal of $R$, we can write $I = \prod \mathfrak{p}_i^{n_i}$
uniquely for each $\mathfrak{p}_i$ prime.  We have defined
$v_{\mathfrak{p}_i}(I) = n_i$.  
We also defined $v_{\mathfrak{p}_i}(x)$ by looking at the ideal $(x)$ it
generates. 

Let us prove the \textbf{weak approximation theorem}, which is a
generalization of the Chinese remainder theorem.

\begin{theorem}[Weak approximation theorem] Let $R$ be a Dedekind domain,
$\mathfrak{p}_1, \dots, \mathfrak{p}_k$ nonzero prime ideals. Suppose $x_1,
\dots, x_k \in K$ and $n_1, \dots, n_{k} \in \mathbb{Z}$.

Then there is $x \in K$ such that
\[ v_{\mathfrak{p}_i}(x - x_i) \geq n_i  \]
and, moreover,
\[ v_{\mathfrak{q}}(x) \geq 0  \]
for any $\mathfrak{q}$ not among the $\mathfrak{p}_i$.
\end{theorem} 

\begin{proof} 
First, we assume that each $x_i \in R$ and each $n_i \geq 0$, by multiplying by
highly divisible elements.  We will in fact take $x \in R$. The two lines below will translate into
\[ x-x_i  \in \mathfrak{p}_i^{n_i}  \]
and
\[ x \in R.  \]
Now it is just the Chinese remainder theorem, but we sketch a proof anyway.

Consider the ideal
\[ \mathfrak{a} =  \mathfrak{p}_1^{n_1} + \mathfrak{p}_2^{n_2}\mathfrak{p}_3^{n_3}+\dots
\mathfrak{p}_k^{n_k}.  \]
Any valuation of this is zero. So this $\mathfrak{a}$ is just $(1)$. We write 
\[ x_1 = y_1 + z_1,  \]
for 
\[ y_1 \in \mathfrak{p}_1^{n_1}, \quad z_1 \in \mathfrak{p}_2^{n_2}\dots
\mathfrak{p}_k^{n_k}.  \]
Thus $z_1$ is very close to $0$ at each $\mathfrak{p}_i^{n_i}$ for $i >1$
and close to $x_1$ at $\mathfrak{p}$. We can do this for each index.  Taking
the sum of correspondingly $z_i$ does what we want. 
\end{proof} 

There is a ``strong approximation theorem'' for number fields where one works
with ``primes at  $\infty$,'' i.e. archimedean absolute values; one then has to
use adeles or something like that.

A corollary is that:
\begin{corollary} 
Hypotheses as above, we can choose $x$ such that
\[ v_{\mathfrak{p}_i}(x-x_i) = n_i  \]
for each $i$.
\end{corollary} 
So we don't have to settle for inequality.
\begin{proof} 
Take some $\xi_i \in \mathfrak{p}_i^{n_i} - \mathfrak{p}_i^{n_i+1}$ for each
$i$.  We look for $x$ such that 
\[ x - x_i \equiv  \xi_i \ \mathrm{mod} \mathfrak{p}_i^{n_i+1} \]
which will do what we want. But we can just invoke the previous theorem for
this. 
\end{proof} 

Why is this good? Here is an appplication:
\begin{theorem} 
A Dedekind domain with $\spec R$ finite is principal.
\end{theorem} 
\begin{proof} 
It is sufficient to show that any prime $\mathfrak{p}$ is principal since $R$
is Dedekind. We apply the weak approximation theorem (more precisely, its
corollary) to find an element which
is a uniformizer at $\mathfrak{p}$ and units at other primes. Then this element
is a generator for $\mathfrak{p}$ because, for any $x \in R$, we have
\[ x = \prod_{\mathfrak{q}} \mathfrak{q}^{v_{\mathfrak{q}}(x)}.  \]
\end{proof} 
The converse is obviously false (e.g.  $R  = \mathbb{Z}$).



\lecture{9/20}

The next few section lectures will focus on Fitting ideals.

We  need to review Nakayama's lemma.

\subsection{Nakayama's lemma}

\begin{lemma}[Nakayama] Let $R$ be a local ring, $\mathfrak{p}$ the maximal
ideal, $M$ a finitely generated $R$-module.

Then if $M = \mathfrak{p}M$, we have $M = 0$.

Moreover, any lift of a $R/\mathfrak{p}$-basis of $M/\mathfrak{p}M$ to $M$
generates $M$.
\end{lemma} 

\begin{proof} 
Omitted for now. Probably, it will be covered in class.
\end{proof} 

\subsection{Complexes}

We now review  a little homological algebra.

\begin{definition} 
A \textbf{complex} of $R$-modules is a sequence of $R$-modules
\[ \to F_n \stackrel{d}{\to} F_{n-1} \to \dots \to F_1 \to F_0 \to \dots  \]
such that the composite of two consecutive differentials is zero. 
\end{definition} 

\begin{definition} 
The $n$-th \textbf{homology} of the complex, denoted $H_n(F)$, is defined as
$\ker(F_n \to F_{n-1})/\im(F_{n+1} \to F_n)$.
The complex is \textbf{acyclic} if it has trivial homology.
\end{definition} 

Note that we can add complexes. If $F, G$ are complexes, then $F \oplus G$ is a
complex whose $n$-th term is $F_n \oplus G_n$. Then 
\[ H_n(F \oplus G) = H_n(F) \oplus H_n(G).  \]

\begin{definition} 
A complex is called \textbf{flat} (resp. \textbf{free, projective}) if each
module in question is flat (resp. free, projective).
\end{definition} 


\begin{example} 
The complex
\[ 0 \to R \stackrel{1}{\to}R \to 0 .  \]
is acyclic and has trivial homology. A direct sum of these is called a
\textbf{trivial complex}.
\end{example} 

\begin{lemma} 
If $R$ is local, then an acyclic free complex with a right endpoint (i.e. of
the form $\dots \to F_1 \to F_0 \to 0$) is a direct sum of trivial complexes.
\end{lemma} 
\begin{proof} 
This is an easy exercise following from the fact that any projective
module over a local ring is free.
\end{proof} 


Suppose $R$ is noetherian. Then $M$ has a resolution by finitely generated free
modules. Indeed, start by taking a surjection $R^{n_0} \twoheadrightarrow M$;
the kernel $M_1$ is finitely generated since $R$ is noetherian, so there is an
surjection $R^{n_1} \twoheadrightarrow M_1$. There is an exact sequence
\[ R^{n_1} \to R^{n_0} \to M \to 0  \]
which we can continue indefinitely to the left. 
In this way, we get a \textbf{free resolution} of $M$. 


Free resolutions are not unique, because you can add trivial complexes.  

Let now $R$ be a local noetherian ring, $\mathfrak{p}$ local, $k =
R/\mathfrak{p}$.  Let $m_1, \dots, m_{n_0} \in M$ be a lifting of a $k$-basis for
$M \otimes_R k$. Then we have a surjection 
\[ R^{n_0} \to M \to 0  \]
in view of Nakayama. We can take the kernel $M_1$ and lift a $k$-basis for $M_1
\otimes_R k$ to get a surjection into $M_1$, and repeat this. So we get a free
resolution
\[ \dots \to R^{n_1} \to R^{n_0} \to M \to 0.  \]
Note that the image of the first differential $d_1$ lies in $\mathfrak{p}
R^{n_0}$. This is true more generally: the image of $d_i$ is contained in
$\mathfrak{p}R^{n_i}$.
The reason is simply that we lifted \emph{bases} over the reductions mod $k$.
\begin{definition} 
A \textbf{minimal free resolution}  over a local ring $R$ is a free resolution
\[  \dots \to F_1 \to F_0 \to 0  \]
such that $\im(d_n) \subset \mathfrak{p}F_{n-1}$.

\end{definition} 
We know that a minimal free resolution always exists by the above discussion.

Why is this interesting?


\begin{theorem} Let $F$ be a minimal free resolution of $M$.
If $\dots \to G_1 \to G_0 \to M$ is another finitely generated free resolution of $M$, then $G$ is
a direct sum of $F$ and a trivial complex.
\end{theorem} 

\begin{corollary} 
A minimal free resolution is unique.
\end{corollary} 

\begin{proof}[Proof of the theorem]
We need to find a split injection from $F \to G$. The cokernel will be an
acyclic projective, hence free, complex; this will imply by the earlier lemma
that $G$ is trivial.

We now need a lemma in homological algebra:
\begin{lemma} Let $R$ be any ring.
Suppose given two complexes of $R$-modules
\[ F: \dots \to F_1 \to F_0 \to M \to 0  \]
and
\[ G: \dots \to G_1 \to G_0 \to N \to 0.  \]
Suppose $F$ is projective and $G$ acyclic. Then any $M \to N$ extends to a map
of complexes. 

Any two such liftings differ by a chain homotopy.\footnote{Recall that this
means that for each $n$, ther is a map $h: F_n \to G_{n+1}$ such that the
difference between the two liftings $F \to G$ is $dh +hd$.}
\end{lemma} 
\begin{proof}
Since $F_0 \to M \to N$ is defined, we can lift $F_0 \to G_0$ since $G_0$ is
projective. Now $F_1 \to F_0 \to G_0$ lands in the image of $G_1 \to G_0$ since
it is killed when you go to $N$. Thus $F_1 \to G_0$ can be lifted to $F_1 \to
G_1$. Inductively, you keep going.

The proof of the chain homotopy fact can be proved similarly. (This is a loose
sketch.)
\end{proof} 

In our case, we have two free resolutions of the same module $M$; both are
projective and acyclic. There is thus a map $\alpha: F \to G$ extending the identity $M
\to M$.  Similarly, we get a map of complexes $ \beta: G \to F$ extending the identity.
Since $\alpha \circ \beta, \beta \circ \alpha$ are maps $G \to G, F \to F$
extending the identity, $\alpha \circ \beta$ and $\beta \circ \alpha$ are chain
homotopic to the identity. In particular, we can find maps 
$h_n: F_n \to F_{n+1}$ such that
\[ (1 - \beta_n \alpha_n) = d_{n+1}h_n + h_{n-1}d_n.  \]
But the $d_n$ have images in $\mathfrak{p} F_{n}$. This is because $F$ is
minimal free.

Therefore, the matrix representative of $ \beta_n \alpha_n$ of the form 
\[ I + \begin{bmatrix}
\mathfrak{p} & \mathfrak{p} & \mathfrak{p} \\
\mathfrak{p} \\
\end{bmatrix}\]
In particular, the determinant of $\beta_n \alpha_n: F_n \to F_n$ is equal to
one modulo $\mathfrak{p}$, in particular it is invertible. So $\beta_n
\alpha_n$ is invertible since its determinant is invertible.  It follows that
$\alpha_n$ must therefore be a split injection because its inverse is $(\beta_n
\alpha_n)^{-1} \beta_n$. 
\end{proof} 



\subsection{Fitting ideals}




Let $R$ be a general ring. If $\phi: F \to G$ is a map between finitely
generated free modules, then in a basis $\left\{f_1, \dots, f_m\right\}$ for
$F$ and a basis $\left\{g_1, \dots, g_n\right\}$ for $G$, we have
\[ \phi(f_i) = \sum a_{ij} g_j  \]
for some  $a_{ij} \in R$.  Then we have represented $\phi$ as a matrix
\[ \begin{bmatrix}
a_{11} & a_{21} & \dots \\
a_{12} & \dots \\
\vdots \\
\end{bmatrix}\]

Now consider the map
\[ \wedge^l \phi: \wedge^l F \to \wedge^l G.   \]
You can convince yourself that this sends $f_{i_1} \wedge \dots f_{i_l}$ of
suitable sums of $l$-by-$l$ minors. 
Namely,
\[ (\wedge^l \phi)(f_{i_1} \wedge \dots f_{i_l}) = \sum \det \begin{bmatrix}
 a_{i_1 j_1} & \dots  & a_{i_l j_1} \\
 \vdots & & \vdots \\
 a_{i_1 j_l} & \dots & a_{i_l j_l} \end{bmatrix}g_{j_1} \wedge \dots \wedge g_{j_l}
\]


\begin{definition} 
Define $I_l \phi$ as the image of $\wedge^l F \otimes (\wedge^l G)^* \to R$,
which is the ideal generated by the $l$-by-$l$ minors of $\phi$.
\end{definition} 

\begin{definition} 
Let $M$ be of \textbf{finite presentation}, i.e. one with a resolution $F
\stackrel{\phi}{\to} G
\to M \to 0$ where $F, G$ are finite free. Let $G$ have rank $r$.
Then we call $I_{r-i}(\phi) $ the \textbf{$i$th Fitting ideal.}
\end{definition} 

Let us show that these are unique and depend only on $M$. 
\begin{proof} 
Suppose given two free resolutions
\[ F \stackrel{\phi}{\to} G \to M \to 0  \] 
and
\[ F' \stackrel{\phi'}{\to} G' \to M \to 0 . \] 
Suppose $G$ has rank $r$ and $G'$ rank $r'$.
We will show that $I_{r-i}(\phi) = I_{r' - i}(\phi')$. 

Suppose, without loss of generality, that $R$ is local. To show that two ideals
are equal, it is sufficient to show that their localizations are, so this is
acceptable.
Then we can assume that one of them is a minimal resolution and the other a sum
of the minimal one and a trivial complex.  
Then $\phi'$ is of the form $\phi \oplus 1_{R^t}$, so the second resolution is
just the first with $0 \to R^t \to R^t \to 0$ added to it.
Any nonzero $k+t$ by $k+t$ minor of $\phi'$ comes from a $k$ by $k$ minor of
$\phi$ and a $t$ by $t$ minor of $1_t$.  From this it can be seen that the two
Fitting ideals are the same. 

\end{proof} 

\begin{definition} 
So it makes sense to define
\[ \mathrm{Fitt}_k(M)  \]
as the $k$-th \textbf{Fitting ideal} of $M$ (i.e. the Fitting ideal of any
finite free resolution, which is well defined by the argument above).
\end{definition} 

\begin{remark} 
By cofactor expansion,
\[ I_{l+1}(\phi) = I_l(\phi).  \]
\end{remark} 


\begin{remark} 
$I_k(\phi \oplus \phi') = \sum_{i + j = k} I_i\phi I_j \phi'$. This follows by
the definitions. This implies a formula for the Fitting ideals. In particular, 
\[ \mathrm{Fitt}_k(M_1 \oplus M_2) = \sum_{i+j=k} \mathrm{Fitt}_i(M_1)
\mathrm{Fitt}_j (M_2).  \]
\end{remark} 

We can define the ``polynomial series''
\[ \mathrm{Fitt}_M(t) = \sum_n \mathrm{Fitt}_n(M) t^n ,  \]
which is a formal power series whose coefficients are ideals of $R$. 

\subsection{Examples}

These notes are a bit sketchy because I'm having trouble following the lecture.



\begin{example} 
Let us compute the Fitting ideals for the $R$-module $R/I$. Then a generator is $1$. Then we
have an exact sequence
\[ I \rightarrowtail  R \twoheadrightarrow R/I  \]
so if we pick a finite generating set $(a_1, \dots, a_n) $ in $I$, we have a
resolution
\[ R^n \stackrel{\phi}{\to} R \twoheadrightarrow R/I.  \]
Here $\phi$ sends a vector to its dot product with $(a_1, \dots, a_n)$. The
matrix representing $\phi$ is just 
\[ (a_1, \dots, a_n).  \]
In particular, the zeroth Fitting ideal or $I_1(\phi)$ is the ideal generated
by the 1-by-1 minors, i.e. $I$ itself. The first Fitting ideal is $I_0(\phi)$,
which is by convention $R$. The Fitting polynomial is then
\[ I + Rt  + Rt^2 + \dots.  \]
\end{example} 

\begin{example} 
Let us compute the Fitting ideal for the $R$-module $R^k$. Then the resolution
\[  0 \stackrel{\phi = 0}{\to} R^k \to R^k \to 0 \]
works, where $\phi=0$. The Fitting ideals are just zero and $R$. 
One can check that the Fitting polynomial is 
\[ Rt^k + Rt^{k+1} + \dots.  \]
\end{example} 


In general, $\mathrm{Fitt}_j(M)$ should be thought of as the obstruction to $M$
being generated by $j$ elements. If $M$ is generated by $j$ elements, then its
$j$th Fitting ideal is $M$. Nonetheless, it is possible that the Fitting ideal
is $R$ but the module is not generated by $j$ elements.

\begin{example} 
Take $R  = \mathbb{Z}[\sqrt{-5}]$ and $M = (2, 1+\sqrt{-5})$. It can be checked
that $\mathrm{Fitt}_1(M) = R$, but the ideal $M$ is not principal. 
\end{example} 

\begin{proposition} 
If $R$ is local and $\mathrm{Fitt}_j(M) =R$, then $M$ is generated by $j$
elements. 
\end{proposition} 
\begin{proof} 
Next time.
\end{proof} 

So the correct statement over every ring is that $\mathrm{Fitt}_j=R$ if and
only if $M$ is \emph{locally} $j$-generated.

\begin{remark} 
Fitting ideals behave well under base change.  In particular, if $R \to S$ is a
morphism of rings, then
\[ \mathrm{Fitt}_j(M) \otimes_R S = \mathrm{Fitt}_j(M \otimes_R S).   \]
\end{remark} 

It is possible to use the Fitting polynomial to characterize modules over PIDs.

\begin{theorem} 
Over a PID, the Fitting ideal generates the (finitely generated) module.
\end{theorem} 

This is also true over Dedekind domains to a limited extent:

\begin{theorem} 
Over a Dedekind domain, the Fitting polynomial determines the torsion part of a
module and the rank of the projective part.
\end{theorem} 

We will probably go over the classification of modules over a Dedekind domain.
Note that the Fitting ideals can't tell you more about the projective module
because those are always degenerate.

\begin{theorem} Let $R$ be any noetherian ring. 
$M$ is projective of constant rank\footnote{I.e. the ranks at all localizations
are $r$.} $r$ if and only if 
\[ \mathrm{Fitt}_M(t) = Rt^r + Rt^{r+1} + \dots.   \]
\end{theorem} 
Today, we want to start heading towards Serre's criterion for normality. The
first we need to talk about is the theory of Artinian rings.

\subsection{Artinian rings}

\begin{definition} 
A commutative ring $R$ is \textbf{Artinian} every descending chain of ideals
$I_0 \supset I_1 \supset I_2 \supset \dots$
stabilizes.
\end{definition} 

\begin{remark} 
The same definition makes sense for modules. We can define an $R$-module $M$ to
be \textbf{Artinian} if every descending chain of submodules stabilizes. 
\end{remark} 

\begin{remark} 
If $0 \to M' \to M \to M'' \to 0$ is an exact sequence, then $M$ is Artinian
iff $M', M''$ are. This is proved in the same way as for noetherianness.
\end{remark} 

This definition is obviously dual to the notion of noetherianness, but it is
much more restrictive.  
Our first goal for today is to prove:

\begin{theorem} 
A commutative ring $R$ is artinian iff:
\begin{enumerate}
\item $R$ is noetherian. 
\item Every prime ideal of $R$ is maximal.\footnote{This is much different from
the Dedekind ring condition---there, zero is not maximal. An artinian domain is
necessarily a field, in fact.}
\end{enumerate}
\end{theorem} 


So artinian rings are very simple---small in some sense.


\begin{proof} 
Let's warm up to this by first proving 2. Let $R$ be artinian; we prove that:

\begin{lemma} 
Every prime $\mathfrak{p} \subset R$ is maximal.
\end{lemma} 
\begin{proof} 
Indeed, $R/\mathfrak{p}$ is artinian. We want to show that this is a field,
which is the same thing as saying that $\mathfrak{p}$ is maximal. Let $x \in
R/\mathfrak{p}$ be nonzero. We have a descending chain
\[ R/\mathfrak{p} \supset (x) \supset (x^{2}) \dots  \]
which necessarily stabilizes. Then we have $(x^n) = (x^{n+1})$ for some $n$. In
particular, we have $x^n = y x^{n+1}$ for some $y \in R/\mathfrak{p}$. But $x$
is a nonzerodivisor, and  we find $$ 1 = xy$$ so $x$ is invertible. Thus
$R/\mathfrak{p}$ is a field.
\end{proof} 

Next, we claim there aren't many primes:
\begin{lemma} 
If $R$ is artinian, there are only finitely many maximal ideals.
\end{lemma} 
\begin{proof} 
Assume otherwise. Then we have an infinite sequence
\[ \mathfrak{m}_1, \dots, \mathfrak{m}_2, \dots  \]
of distinct maximal ideals. Then we have the descending chain
\[ R \supset \mathfrak{m}_1 \supset \mathfrak{m}_1 \cap \mathfrak{m}_2 \supset \dots.  \]
This stabilizes. So for some $n$, we have that $\mathfrak{m}_1 \cap \dots \cap 
\mathfrak{m}_n \subset \mathfrak{m}_{n+1}$. However, this means that
$\mathfrak{m}_{n+1}$ contains one of the $\mathfrak{m}_1, \dots,
\mathfrak{m}_n$ since these are prime ideals (a familiar argument).  Maximality
and distinctness of the $\mathfrak{m}_i$ give a contradiction.
\end{proof} 

In particular, we see that $\spec R$ for an artinian ring is just a finite set.
In fact, since each point is closed, as each prime is maximal, the set has the
\emph{discrete topology.}

This means that $R$ factors as a product of rings. Whenever $\spec R$ can be
written as a disjoint union of components, you get a factoring of $R$ into a
product (this was on the homework). So $R = \prod R_i$ where each $R_i$ has
only one maximal ideal. We find, as a result, 
\begin{proposition} 
Any artinian ring is a finite product of local artinian rings.
\end{proposition} 

Now, let us continue our analysis. We may as well assume that we are working
with \emph{local} artinian rings $R$ in the future. In particular, $R$ has a unique
prime $\mathfrak{m}$, which must be the radical of $R$ as the radical is the
intersection of all primes. In particular, $\mathfrak{m}$ consists of
nilpotent elements.

I claim now that:
\begin{lemma} Let $(R, \mathfrak{m})$ be a local artinian ring.
Then $\mathfrak{m}$ is nilpotent. In particular, there is $n$ such that
$\mathfrak{m}^n = (0)$.
\end{lemma}
\begin{proof}
We have the chain of ideals 
\[ \mathfrak{m} \supset \mathfrak{m}^2 \supset \dots,  \]
which stabilizes, so there is a large $n$ with $\mathfrak{m}^n =
\mathfrak{m}^{n+1} = \dots$. Let us call this stable ideal $I$. We want to show
that $I = 0$. 

Assume not. Consider all ideals $J$ such that $IJ \neq 0$. This is nonempty (as
$I = I(1) \neq 0$). There is a minimal such ideal $J$. That's what the
condition of artinianness buys us---any nonempty collection of ideals in an
artinian ring has a minimal element.

First, I claim that $J$ is principal. Indeed, there is $x \in J$ with $x I \neq
0$; thus $(x)I \neq 0$, and minimality implies that $J = (x)$. 

%Also we can now say that $x I^n \neq 0$ as $I = I^2$ by the definition of $I$
%as the limit of the $\mathfrak{m}^k$.

I now claim that $x \in \mathfrak{m}$. If otherwise, then $x$ would be
invertible, so $J = R$. In particular, no nontrivial ideals $J$ satisfy $JI =
0$. But $\mathfrak{m}I = I$ by construction of $I$. So $x$ is a nonunit.

Consider ideals $I'$ such that $xI' \neq 0$. There is at least one, namely $I$. 
So there is a minimal one. 

%We consider the sequence
%\[ xI \supset x^2 I \supset x^3 I \supset \dots  \]

OK, we messed up. Let's assume this.
\end{proof}

Finally, we may prove:

\begin{lemma} 
A local artinian ring $R$ is noetherian.
\end{lemma} 
\begin{proof} 
We have the filtration $R \supset \mathfrak{m} \supset \mathfrak{m}^2 \supset
\dots$. This eventually stabilizes at zero---that's the previous statement. I
claim that $R$ is noetherian as an $R$-module. To prove this, it suffices to
show that $\mathfrak{m}^k/\mathfrak{m}^{k+1}$ is noetherian as an $R$-module.
But of course, this is annihilated by $\mathfrak{m}$, so it is really a vector
space over the field $R/\mathfrak{m}$. But $\mathfrak{m}^k/\mathfrak{m}^{k+1}$
is a subquotient of an artinian module so is artinian itself. We have to show
that it is noetherian. 
It suffices to show now that if $k$ is a field, and $V$ a $k$-vector space,
then TFAE:
\begin{enumerate}
\item $V$ is artinian. 
\item $V$ is noetherian.
\item $V$ is finite-dimensional.
\end{enumerate}
This is evident by linear algebra. 	
\end{proof} 

Now, finally, we have shown that an artinian ring is noetherian. We have to
discuss the converse. Let us assume now that $R$ is noetherian and has only
maximal prime ideals. We show that $R$ is artinian. Let us consider $\spec R$;
there are only finitely many minimal primes by the theory of associated primes.
Every prime ideal is minimal in this case. Once again, we learn that $\spec R$
is finite and has the discrete topology. This means that $R$ is a product of
factors $\prod R_i$ where each $R_i$ is a local noetherian ring with a unique
prime ideal. We might as well now prove:

\begin{lemma} 
Let $(R, \mathfrak{m})$ be a local noetherian ring with one prime ideal. Then
$R$ is artinian.
\end{lemma} 
\begin{proof} 
We know that $\mathfrak{m} = \mathrm{rad}(R)$. So $\mathfrak{m}$ consists of
nilpotent elements, so by finite generatedness it is nilpotent.  Then we have a
finite filtration
\[ R \supset \mathfrak{m} \supset \dots \supset \mathfrak{m}^k = 0.  \]
Each of the quotients are finite-dimensional vector spaces, so artinian---this
implies that $R$ itself is artinian. 

\end{proof} 


\end{proof} 

The theory of artinian rings is thus a special case of the theory of noetherian
rings.

\subsection{Reducedness}

Recall:

\begin{definition} 
A ring $R$ is \textbf{reduced} if it has no nonzero nilpotents.
\end{definition} 

\begin{proposition} 
If $R$ is noetherian, then $R$ is reduced if and only if it satisfies the
following conditions:
\begin{enumerate}
\item Every associated prime of $R$ is  minimal (no embedded primes).
\item If $\mathfrak{p}$ is minimal, then $R_{\mathfrak{p}}$ is  a field.
\end{enumerate}
\end{proposition}
\begin{proof} 
First, assume $R$ reduced. What can we say? Say $\mathfrak{p}$ is a minimal
prime; then $R_{\mathfrak{p}}$ has precisely one prime ideal (namely,
$\mathfrak{m}=\mathfrak{p}R_{\mathfrak{p}}$). It is in fact a local artinian ring, though we
don't need that fact. The radical of $R_{\mathfrak{p}}$ is just $\mathfrak{m}$.
But $R$ was reduced, so $R_{\mathfrak{p}}$ was reduced; it's an easy argument
that localization preserves reducedness. So $\mathfrak{m}=0$. The fact that 0
is a maximal ideal in $R_{\mathfrak{p}}$ says that it is a field.

On the other hand, we still have to do part 1. $R$ is reduced, so $\rad(R) =
\bigcap_{\mathfrak{p} \in \spec R} \mathfrak{p} = 0$. In particular, 
\[ \bigcap_{\mathfrak{p} \ \mathrm{minimal}}\mathfrak{p} = 0.  \]
The map
\[ R \to \prod_{\mathfrak{p} \ \mathrm{minimal}}R/\mathfrak{p}  \]
is injective. The associated primes of the product, however, are just the
minimal primes. So $\ass(R)$ can contain only minimal primes. 

That's one direction of the proposition. Let us prove the converse now. Assume
$R$ satisfies the two conditions listed. In other words, $\ass(R)$ consists of
minimal primes, and each $R_{\mathfrak{p}}$ for $\mathfrak{p} \in \ass(R)$ is a
field. We would like to show that $R$ is reduced. 
Primary decomposition tells us that there is an injection 
\[ R \hookrightarrow \prod_{\mathfrak{p}_i \ \mathrm{minimal}} M_i, \quad M_i
\ \  \mathfrak{p}_i-\mathrm{primary}. \]
In this case, each $M_i$ is primary with respect to a minimal prime. We have a
map
\[ R \hookrightarrow \prod M_i \to \prod (M_i)_{\mathfrak{p}_i},  \]
which is injective, because when you localize a primary module at its
associated prime, you don't kill anything by definition of primariness. Since
we can draw a diagram
\[ 
\xymatrix{
R \ar[r] \ar[d]  &  \prod M_i \ar[d]  \\
\prod R_{\mathfrak{p}_i} \ar[r] & \prod (M_i)_{\mathfrak{p}_i}
}
\]
and the map $R \to \prod (M_i)_{\mathfrak{p}_i}$ is injective, the downward
arrow on the right injective. Thus $R$ can be embedded in
a product of the fields $\prod R_{\mathfrak{p}_i}$, so is reduced.
\end{proof} 

This proof actually shows: 
\begin{proposition}[Scholism] A noetherian ring $R$ is reduced iff it injects
into a product of fields. We can take the fields to be the localizations at the
minimal primes. 
\end{proposition} 

\begin{example} 
Let $R = k[X]$ be the coordinate ring of a variety $X$ in $\mathbb{C}^n$. Assume $X$ is
reduced. Then $\mathrm{MaxSpec} R$ is a union of irreducible components $X_i$, which
are the closures of the minimal primes of $R$. The fields you get by localizing
at minimal primes depend only on the irreducible components, and in fact are
the rings of meromorphic functions on $X_i$. 
Indeed, we have a map
\[ k[X] \to \prod k[X_i] \to \prod k(X_i).  \]

If we don't assume that $R$ is radical, this is \textbf{not} true.
\end{example} 

There is a stronger condition than being reduced we could impose. We could say:

\begin{proposition} 
If $R$ is a noetherian ring, then $R$ is a domain iff 
\begin{enumerate}
\item $R$ is reduced. 
\item $R$ has a unique minimal prime.
\end{enumerate}
\end{proposition} 
\begin{proof} 
One direction is obvious. A domain is reduced and $(0)$ is the minimal prime. 

The other direction is proved as follows. Assume 1 and 2. Let $\mathfrak{p}$ be
the unique minimal prime of $R$. Then $\rad (R) = 0 = \mathfrak{p}$ as every
prime ideal contains $\mathfrak{p}$. As $(0)$ is a prime ideal, $R$ is a domain.
\end{proof} 

We close by making some remarks about this embedding of $R$ into a product of
fields. 

\begin{definition} 
Let $R$ be any ring, not necessarily a domain. Let $K(R)$ be the localized ring
$S^{-1}R$ where $S$ is the multiplicatively closed set of nonzerodivisors in
$R$.  $K(R)$ is called the \textbf{total ring of fractions} of $R$.

When $R$ is a field, this is the quotient field.
\end{definition} 

First, to get a feeling for this, we show:

\begin{proposition} Let $R$ be noetherian. The set of nonzerodivisors $S$ can be described by
$S = R- \bigcup_{\mathfrak{p} \in \ass(R)} \mathfrak{p}$.
\end{proposition} 
\begin{proof} 
If $x \in\mathfrak{p} \in \ass(R)$, then $x$ must kill something in $R$ as it
is in an associated prime. 	So $x$ is a zerodivisor. 

Conversely, suppose $x$ is a zerodivisor, say $xy = 0$ for some $y \in R -
\left\{0\right\}$. In
particular, $x \in \ann(y)$. We have an injection $R/\ann(y) \hookrightarrow R$
sending 1 to $y$. But $R/\ann(y)$ is nonzero, so it has an associated prime
$\mathfrak{p}$ of $R/\ann(y)$, which contains $\ann(y)$ and thus $x$. But $\ass(R/\ann(y)) \subset \ass(R)$. 
So $x$ is contained in a prime in $\ass(R)$. 
\end{proof} 

Assume now that $R$ is reduced.  Then $K(R)  = S^{-1}R$ where $S$ is the
complement of the union of the minimal primes. 
At least, we can claim:

\begin{proposition} Let $R$ be reduced and noetherian. Then
$K(R) = \prod_{\mathfrak{p}_i \ \mathrm{minimal}} R_{\mathfrak{p}_i}$.
\end{proposition} 

So $K(R)$ is the product of fields into which $R$ embeds.  
We will give a proof of this next time. 
\lecture{10/18}

\subsection{A loose end}
Let us start with a little IOU from last time.
We were talking about the theory of artinian rings. We asserted the following
without proof.

\begin{lemma} 
If $R$ is artinian, then $\rad (R) $ is nilpotent.
\end{lemma} 
\begin{proof} 
Call $J = \rad(R)$. Consider the decreasing filtration
\[ R \supset J \supset J^2 \supset J^3 \supset \dots.  \]
We want to show that this stabilizes at zero. A priori, we know that it
stabilizes \emph{somewhere}. For some $n$, we have
\[ J^n = J^{n'}, \quad n' \geq n.  \]
Call the eventual stabilization of these ideals $I$. Consider ideals $I'$ such
that
\[ II' \neq 0.  \]
\begin{enumerate}
\item There aren't any such $I'$. Then $I = 0$, and we're done. 
\item Otherwise, there is one, namely the unit ideal $(1)$. So there is a
minimal such $I'$ as this is an artinian ring. What can we say about $I'$?
Necessarily it is nonzero, and furthermore there is $x \in I'$ with $x I \neq
0$. It follows by minimality that
\[ I' = (x)  \]
so $I'$ is principal, generated by some $x \in I'$. Then $xI \neq 0$; observe
that this is also $(xI)I $ as $I^2  = I$ from the definition of $I$. Since
$(xI) I \neq 0$, it follows again by minimality that
\[ xI = (x).  \] This means that there is $y \in I$ such that $xy = x$; but now, by construction $I \subset J = \rad (R)$, implying that $y $ is nilpotent.
It follows that
\[ x = xy = xy^2 = \dots = 0  \]
as $y$ is nilpotent. However, $x \neq 0$ as $xI \neq 0$. 
\end{enumerate}
\end{proof} 
This finishes the IOU.

\subsection{Total rings of fractions}

We now continue the discussion begun last time. Let $R$ be noetherian and $M$ a
finitely generated $R$-module. We would like to understand very rough features of $M$.  
We can embed $M$ into a larger $R$-module.
Here are two possible approaches.

\begin{enumerate}
\item  $S^{-1}M$, where $S$ is a large multiplicatively closed subset of $M$.
Let us take $S $ to be the set of all $a \in R$ such that $M
\stackrel{a}{\to}M$ is injective, i.e. $a$ is not a zerodivisor on $M$. Then
the map 
\[ M \to S^{-1}M  \]
is an injection. Note that $S$ is the complement of the union of $\ass(R)$.
\item Another approach would be to use a \emph{primary decomposition}
\[ M \hookrightarrow \prod M_i,  \]
where each $M_i$ is $\mathfrak{p}_i$-primary for some prime $\mathfrak{p}_i$
(and these primes range over $\ass(M)$). In this case, it is clear that
anything not in each $\mathfrak{p}_i$ acts injectively. So we can draw a
commutative diagram
\[ 
\xymatrix{
M \ar[d]  \ar[r] &  \prod M_i \ar[d]  \\
\prod M_{\mathfrak{p}_i} \ar[r] &  \prod (M_i)_{\mathfrak{p}_i}
}.
\]
The map going right and down is injective.
It follows that $M$ injects into the product of its localizations at associated
primes. 
\end{enumerate}

The claim is that these constructions agree if $M$ has no embedded primes.
I.e., if there are no nontrivial containments among the associated primes of
$M$, then $S^{-1}M$ (for $S =  R - \bigcup_{\mathfrak{p} \in \ass(M)} \mathfrak{p}$)
is just $\prod M_{\mathfrak{p}}$. 
To see this, note that any element of $S$ must act invertibly on $\prod
M_{\mathfrak{p}}$. We thus see that there is always a map
\[ S^{-1}M \to \prod_{\mathfrak{p} \in \ass(M)} M_{\mathfrak{p}} . \]
\begin{proposition} 
This is an isomorphism if $M$ has no embedded primes. 
\end{proposition} 

\begin{proof} 
Let us go through a series of reductions. Let $I = \ann(M) = \left\{a: aM
= 0\right\}$. Wlog, we can replace $R $ by $R/I$. This plays nice with the
associated primes.

The assumption is now that $\ass(M)$ consists of the minimal
primes of $R$.

Without loss of generality, we can next replace $R$ by $S^{-1}R$ and $M$ by
$S^{-1}M$, because that doesn't affect the conclusion; localization plays nice
with associated primes. 

Now, however, $R$ is artinian: i.e., all primes of $R$ are minimal (or maximal). Why is this? 
Let $R$ be \emph{any} noetherian ring and $S = R - \bigcup_{\mathfrak{p} \
\mathrm{minimal}} \mathfrak{p}$. Then I claim that $S^{-1}R$ is artinian. We'll
prove this in a moment. 

So $R$ is artinian, hence a product $\prod R_i$ where each $R_i$ is local
artinian. Without loss of generality, we can replace $R$ by $R_i$ by taking
products. The condition we are trying to prove is now that
\[ S^{-1}M \to M_{\mathfrak{m}}  \]
for $\mathfrak{m} \subset R$ the maximal ideal. But $S$ is the complement of
the union of the minimal primes, so it is $R - \mathfrak{m}$ as $R$ has one
minimal (and maximal) ideal.  This is obviously an isomorphism: indeed, both
are $M$.
\end{proof} 
Let us return to the claim. It is called \textbf{prime avoidance}.
We start by proving:
\begin{proposition} 
Let $\mathfrak{p}_1, \mathfrak{p}_2, \dots, \mathfrak{p}_n$ be a finite set of
primes of $R$. Suppose $I \subset R$ is not contained in any $\mathfrak{p}_i$.
Then there is $x \in I$ such that $x $ is not contained in any $\mathfrak{p}_i$. 
\end{proposition} 
This implies the claim made earlier. In a noetherian ring, a nonminimal prime will contain an element
which does not belong to any minimal prime. It follows that if $S = R -
\bigcup_{\mathfrak{p} \ \mathrm{minimal}} \mathfrak{p}$, then $S$ contains an
element of each nonminimal prime. So $S^{-1}R$ has only minimal primes.

\begin{proof} 
Induction on $n$.

When $n=1$, this is obvious.

Suppose $n>1$ and the result is true for $n-1$. The inductive hypothesis states
that for each $i \in [1, n]$, there is $x_i \in I$ which fails to lie in
$\mathfrak{p}_i$ for $i \neq j$. 
If there is $i$ such that $x_i \notin \mathfrak{p}_i$, then we're done---take
$x = x_i$. Assume otherwise, so each $x_i \in \mathfrak{p}_i$.

We now take
\[  x = \sum_i \prod_{j \neq i} x_j.  \]
Then evidently $x \in I$, $I$ being an ideal. We now show that $x \notin
\mathfrak{p}_i$ for each $i$. The reason is that there is one term in the sum
which doesn't include the factor $x_i$, but is the product of the $x_j, j \neq
i$; this doesn't belong to $\mathfrak{p}_i$ then. All the other terms in the
sum include the factor $x_i$ so do belong to $\mathfrak{p}_i$. When we add up a
bunch of things such that one doesn't belongs  $\mathfrak{p}_i$ and the others
do, the sum isn't in $\mathfrak{p}_i$. This establishes prime avoidance.
\end{proof} 

\begin{corollary} 
Let $R$ be a noetherian ring with no embedded primes (i.e. $\ass(R)$ consists
of minimal primes).
Then $K(R) = \prod_{\mathfrak{p}_i \ \mathrm{minimal}} R_{\mathfrak{p_i}}$.
\end{corollary} 
If $R$ is reduced, we get the statement made last time: there are no
embedded primes, and $K(R)$ is a product of
fields. 

\subsection{The image of $M \to S^{-1}M$}
Let's ask now the following question. Let $R$ be a noetherian ring, $M$ a finitely generated
$R$-module, and $S$ the set of nonzerodivisors on $M$, i.e. $R -
\bigcup_{\mathfrak{p} \in \ass(M)} \mathfrak{p}$. We have seen that there is an
imbedding
\[ \phi: M \hookrightarrow S^{-1}M.  \]
What is the image? Given $x \in S^{-1}M$, when does it belong to the imbedding
above.

To answer such a question, it suffices to check locally. In particular:
\begin{proposition} 
$x$ belongs to the image of $M $ in $S^{-1}M$ iff for every $\mathfrak{p} \in
\spec R$, the image of $x$ in $(S^{-1}M)_{\mathfrak{p}}$ lies inside
$M_{\mathfrak{p}}$. 
\end{proposition} 

This isn't all that interesting. However, it turns out that you can check this
at a smaller set of primes.

\begin{proposition} 
In fact, it suffices to show that $x$ is in the image of $\phi_{\mathfrak{p}}$
for every $\mathfrak{p} \in \ass(M/sM)$ where $s \in S$.
\end{proposition} 
This is a little opaque; soon we'll see what it actually means.
The proof is very simple.

\begin{proof} 
Remember that $ x \in S^{-1}M$. In particular, we can write $x = y/s$ where $y
\in M, s \in S$. What we'd like to prove that $x \in M$, or equivalently that
$y \in sM$.\footnote{In general, this would be equivalent to $ty \in tsM$ for
some $t \in S$; but $S$ consists of nonzerodivisors on $M$.}
In particular, we want to know that $y$ maps to zero in $M/sM$. If not, there
exists an associated prime $\mathfrak{p} \in \ass(M/sM)$ such that $y$ does not
get 
killed in $(M/sM)_{\mathfrak{p}}$. 
We have assumed, however, for every associated prime $\mathfrak{p}\in \ass(M)$, 
$x \in ( S^{-1}M)_{\mathfrak{p}}$ lies in the image of $M_{\mathfrak{p}}$. This
states that the image of $y$ in this quotient $(M/sM)_{\mathfrak{p}}$ is zero,
or that $y$ is divisible by $s$ in this localization.
\end{proof} 

The case we actually care about is the following:

Take $R$ as a noetherian domain and $M = R$.  Then $S = R - \left\{0\right\}$
and $S^{-1}M $ is just the fraction field $K(R)$.  The goal is to describe $R$
as a subset of $K(R)$. What we have proven is that $R$ is the intersection in
the fraction field 
\[ \boxed{ R = \bigcap_{\mathfrak{p} \in \ass(R/s), s \in R - 0}
R_{\mathfrak{p}} . }\]
So to check that something belongs to $R$, we just have to check that in a
\emph{certain set of localizations}.

Let us state this as a result:
\begin{theorem}[Krull intersection theorem, preliminary version]
If $R$ is a noetherian domain
\[ R = \bigcap_{\mathfrak{p} \in \ass(R/s), s \in R - 0}
R_{\mathfrak{p}}  \]
\end{theorem} 

\subsection{Serre's criterion}

We can now state a result.
\begin{theorem}[Serre] Let $R$ be a noetherian domain.  Then $R $ is integrally
closed iff it satisfies 
\begin{enumerate}
\item For any $\mathfrak{p} \subset R$ of height one, $R_{\mathfrak{p}}$ is a
DVR.
\item For any $s \neq 0$, $R/s$ has no embedded primes (i.e. all the
associated primes of $R/s$ are height one). 
\end{enumerate}
\end{theorem} 

Here is the non-preliminary version of the Krull theorem.
\begin{theorem}[Krull]
Let $R$ be a noetherian integrally closed ring. Then 
\[ R = \bigcap_{\mathfrak{p} \ \mathrm{height \ one}} R_{\mathfrak{p}},  \]
where each $R_{\mathfrak{p}}$ is a DVR.
\end{theorem} 

\begin{proof} 
Now evident from the earlier Krull theorem and Serre's criterion.
\end{proof} 
Earlier in the class, we proved that a domain was integrally closed if and only
if it could be described as an intersection of valuation rings. We have now
shown that when $R$ is noetherian, we can take \emph{discrete} valuation rings. 

\begin{remark} 
In algebraic geometry, say $R = \mathbb{C}[x_1, \dots, x_n]/I$.  Its maximal
spectrum is a subset of $\mathbb{C}^n$.  If $I$ is prime, and $R$ a domain, this variety is
irreducible.  We are trying to describe $R$ inside its field of fractions. 

The field of fractions are like the ``meromorphic functions''; $R$ is like the
holomorphic functions. Geometrically, this states to check that a meromorphic
function is holomorphic, you can just check this by computing the ``poleness''
along each codimension one subvariety. If the function doesn't blow up on each
of the codimension one subvarieties,  and $R$ is normal, then you can extend it
globally.

This is an algebraic version of Hartog's theorem: this states that a
holomorphic function on $\mathbb{C}^2 - (0,0)$ extends over the origin, because
this has codimension $>1$. 

All the obstructions of extending a function to all of $\spec R$ are in
codimension one. 
\end{remark} 

Now, we prove Serre's criterion.
\begin{proof} 
Let us first prove that $R$ is integrally closed if 1 and 2 occur. We know that 
\[ R = \bigcap_{\mathfrak{p} \in \ass(R/x), x \neq 0} R_{\mathfrak{p}} ; \]
by condition 1, each such $\mathfrak{p}$ is of height one, and
$R_{\mathfrak{p}}$ is a DVR. So $R$ is the intersection of DVRs and thus
integrally closed.

The hard part is going in the other direction. Assume $R$ is integrally closed. 
We want to prove the two conditions. In $R$, consider the following conditions
on a prime ideal $\mathfrak{p}$:
\begin{enumerate}
\item $\mathfrak{p}$ is an associated prime of $R/x$ for some $x \neq 0$.
\item $\mathfrak{p} $ is height one.
\item $\mathfrak{p}_{\mathfrak{p}}$ is principal in $R_{\mathfrak{p}}$.
\end{enumerate}
First, 3 implies 2 implies 1. 3 implies that $\mathfrak{p}$ contains an element
$x$ which 
generates $\mathfrak{p}$ after localizing.
It follows that there can be no prime between $(x)$ and $\mathfrak{p}$ because
that would be preserved under localization.  Similarly, 2 implies 1 is easy. If
$\mathfrak{p}$ is minimal over $(x)$, then $\mathfrak{p} \in \ass R/(x)$ since
the minimal primes in the support are always associated.

We are trying to prove the inverse implications. In that case, the claims
of the theorem will be proved. We have to show that 1 implies 3.
This is an argument we really saw last time, but let's see it again. Say
$\mathfrak{p} \in \ass(R/x)$. We can replace $R$ by $R_{\mathfrak{p}}$ so that
we can assume that $\mathfrak{p}$ is maximal. We want to show that
$\mathfrak{p}$ is generated by one
element. 

What does the condition $\mathfrak{p} \in \ass(R/x)$ buy us? It tells us that
there is $\overline{y} \in R/x$ such that $\ann(\overline{y}) = \mathfrak{p}$.
In particular, there is $y \in R$ such that $\mathfrak{p}y \subset (x)$ and $y
\notin (x)$. 
We have the element $y/x \in K(R)$ which sends $\mathfrak{p}$ into $R$.  That
is,
\[ (y/x) \mathfrak{p} \subset R.  \]
There are two cases to consider, as in last time:
\begin{enumerate}
\item $(y/x) \mathfrak{p}  = R$. Then $\mathfrak{p} = R (x/y)$ so $\mathfrak{p}
$ is principal. 
\item $(y/x) \mathfrak{p} \neq R$. In particular, $(y/x)\mathfrak{p} \subset
\mathfrak{p}$. Then since $\mathfrak{p}$ is finitely generated, we find that $y/x $ is
integral over $R$, hence in $R$. This is a contradiction as $y \notin (x)$. 
\end{enumerate}
Only the first case is now possible. So $\mathfrak{p}$ is in fact principal. 
\end{proof} 


\lecture{10/20}

What we'd like to talk about today is something mentioned on the first day, and
many times since. Namely, the \textbf{Nullstellensatz.}

\subsection{The Hilbert Nullstellensatz}

There are several ways to say it. Let us start with the following. 

\begin{theorem} 
All maximal ideals in the polynomial ring $R=\mathbb{C}[x_1, \dots, x_n]$ come
from points in $\mathbb{C}^n$. 
\end{theorem} 
The maximal spectrum of $R=\mathbb{C}[x_1, \dots, x_n]$ is thus identified with
$\mathbb{C}^n$. This can be thought of in the following way. Let
$\mathfrak{m}\subset R$ be a maximal ideal. Then there is a map
\[ \mathbb{C} \to R \to R/\mathfrak{m}  \]
where $R/\mathfrak{m}$ is thus a finitely generated $\mathbb{C}$-algebra, as
$R$ is. 
We would like to show that $R/\mathfrak{m}$ is a finitely generated $\mathbb{C}$-vector
space. This would imply that $R/\mathfrak{m}$ is integral over $\mathbb{C}$,
and there are no proper algebraic extensions of $\mathbb{C}$.

The Nullstellensatz in this form would follow from the next claim:

\begin{proposition} 
Let $k$ be a field, $L/k$ an extension of fields. Suppose $L$ is a finitely
generated $k$-algebra. Then $L$	is a finite $k$-vector space.
\end{proposition} 
This is what we will prove.

We start with an easy proof in the special case:
\begin{lemma} 
Assume $k$ is uncountable (e.g. $\mathbb{C}$, the original case of interest).
Then the above proposition is true. 
\end{lemma} 
\begin{proof} 
Since $L$ is a finitely generated $k$-algebra, it suffices to show that $L/k$ is algebraic.
If not, there exists $x \in L$ which isn't algebraic over $k$. So $x$ satisfies
no nontrivial polynomials. 
I claim now that the uncountably many elements $\frac{1}{x-\lambda}, \lambda \in K$ are linearly
independent over $K$. This will be a contradiction as $L$ is a finitely
generated $k$-algebra, hence at most countably dimensional over $k$. (Note that
the polynomial ring is countably dimensional over $k$, and $L$ is a quotient.)

So let's prove this. Suppose not. Then there is a nontrivial linear dependence
\[ \sum \frac{c_i}{x - \lambda_i}  = 0, \quad c_i, \lambda_i \in K. \]
Here the $\lambda_j$ are all distinct to make this nontrivial. Clearing denominators, we find
\[ \sum_i c_i \prod_{j \neq i } (x- \lambda_j) = 0. \]
Wlog, $c_1 \neq 0$. 
This equality was in the field $L$. But $x$ is transcendental over $k$. So we
can think of this as a polynomial ring relation. 
Since we can think of this as a relation in the polynomial ring, we see that
doing so, all but the $i =1$ term in the sum is divisible by $x - \lambda_1$
as a polynomial.
It follows that, as polynomials in the indeterminate $x$, 
\[ x - \lambda_1 \mid c_1 \prod_{j \neq 1} (x - \lambda_j).  \]
This is a contradiction since all the $\lambda_i$ are distinct.
\end{proof} 

This is kind of a strange proof, as it exploits the fact that $\mathbb{C}$ is
uncountable. 
This shouldn't be relevant.

\subsection{The normalization lemma}

Let's now give a more algebraic proof. 
We shall exploit the following highly useful fact in commutative algebra:

\begin{theorem}[Noether normalization lemma] Let $k$ be a field, and $R =
k[x_1, \dots, x_n]/\mathfrak{p}$ be a finitely generated domain over $k$ (where
$\mathfrak{p}$ is a prime ideal in the polynomial ring).

Then there exists a polynomial subalgebra $k[y_1, \dots, y_m] \subset R$ such
that $R$ is integral over $k[y_1, \dots, y_m]$. 
\end{theorem} 

Later we will see that $m$ is the \emph{dimension} of $R$.

There is a geometric picture here. Then $\spec R$ is some irreducible algebraic
variety in $k^n$ (plus some additional points), with a smaller dimension than
$n$ if $\mathfrak{p} \neq 0$. Then there exists a \emph{finite map} to $k^m$.
In particular, we can map surjectively $\spec R \to k^m$ which is integral.
The fibers are in fact finite, because integrality implies finite fibers.  (We
have not actually proved this yet.)

How do we actually find such a finite projection? In fact, in characteristic
zero, we just take a
vector space projection $\mathbb{C}^n \to \mathbb{C}^m$. For a ``generic''
projection onto a subspace of the appropriate dimension, the projection will 
will do as our finite map. In characteristic $p$, this may not work.

\begin{proof} 
First, note that $m$ is uniquely determined as the transcendence degree of the
quotient field of $R$ over $k$. 	

Among the variables $x_1, \dots, x_n \in R$ (which we think of as in $R$ by an
abuse of notation), choose a maximal subset which is algebraically independent.
This subset has no nontrivial polynomial relations. In particular, the ring
generated by that subset is just the polynomial ring on that subset.
We can permute these variables and assume that
$$\left\{x_1,\dots, x_m\right\}$$ is the maximal subset. In particular, $R$
contains the \emph{polynomial ring} $k[x_1, \dots, x_m]$ and is generated by
the rest of the variables. The rest of the variables are not adjoined freely
though. 

The strategy is as follows.  We will implement finitely many changes of
variable so that $R$ becomes integral over $k[x_1, \dots, x_m]$. 

The essential case is where $m=n-1$. Let us handle this. So we have 
\[ R_0 = k[x_1, \dots, x_m]  \subset R = R_0[x_n]/\mathfrak{p}.  \]
Since $x_n$ is not algebraically independent, there is a nonzero polynomial
$f(x_1, \dots, x_m, x_n) \in \mathfrak{p}$. 

We want $f$ to be monic in $x_n$. This will buy us integrality. A priori, this
might not be true. We will modify the coordinate system to arrange that,
though. Choose $N \gg 0$. Define for $1 \leq i \leq m$,
\[ x_i' = x_i + x_n^{N^i}.  \]
Then the equation becomes:
\[ 0 = f(x_1, \dots, x_m, x_n) = f( \left\{x_i' - x_n^{N^i}\right\} , x_n). \]
Now $f(x_1, \dots, x_n, x_{n+1})$ looks like some sum
\[ \sum \lambda_{a_1 \dots b} x_1^{a_1} \dots x_m^{a_m} x_n^{b} , \quad
\lambda_{a_1 \dots b} \in k. \]
But $N$ is really really big. Let us expand this expression in the $x_i'$ and
pay attention to the largest power of $x_n$ we see. 
We find that
\[ f(\left\{x_i' - x_n^{N_i}\right\},x_n)
\]
has the largest power of $x_n$ precisely where, in the expression for $f$,  $a_m$ is maximized first, then
$a_{m-1}, $ and so on. The largest exponent would have the form
\[ x_n^{a_m N^m + a_{m-1}N^{m-1} + \dots + b}.  \]
We can't, however, get any exponents of $x_n$ in the expression 
\( f(\left\{x_i' - x_n^{N_i}\right\},x_n)\) other than these. If $N$ is super
large, then all these exponents will be different from each other. 
In particular, each power of $x_n$ appears precisely once in the expansion of
$f$. We see in particular that $x_n$ is integral over $x_1', \dots, x_n'$. 
Thus each $x_i$ is as well.

So we find
\begin{quote}
$R$ is integral over $k[x_1', \dots, x_m']$. 
\end{quote}

We have thus proved the normalization lemma in the codimension one case. What
about the general case? We repeat this. 
Say we have
\[ k[x_1, \dots, x_m] \subset R.  \]
Let $R'$ be the subring of $R$ generated by $x_{1}, \dots,x_m, x_{m+1}$. The
argument we just gave implies that we can choose $x_1', \dots, x_m'$ such that
$R'$ is integral over $k[x_1', \dots, x_m']$, and the $x_i'$ are
algebraically independent. 
We know in fact that $R' = k[x_1', \dots, x_m', x_{m+1}]$. 

Let us try repeating the argument while thinking about $x_{m+2}$. Let $R'' =
k[x_1', \dots, x_m', x_{m+2}]$ modulo whatever relations that $x_{m+2}$ has to
satisfy. So this is a subring of $R$. The same argument shows that we can
change variables such that $x_1'', \dots, x_m''$ are algebraically independent
and $R''$ is integral over $k[x_1'', \dots, x_m'']$. We have furthermore that
$k[x_1'', \dots, x_m'', x_{m+2}] = R''$. 

Having done this, let us give the argument where $m=n-2$. You will then see
how to do the general case. Then I claim that:
\begin{quote}
$R$ is integral over $k[x_1'', \dots, x_m'']$.
\end{quote}
For this, we need to check that $x_{m+1}, x_{m+2}$ are integral (because these
together with the $x''_i$ generate $R''[x_{m+2}][x_{m+2}]=R$. 
But $x_{m+2}$ is integral over this by construction. The integral closure of
$k[x_1'', \dots, x_{m}'']$ in $R$ thus contains
\[ k[x_1'', \dots, x''_m, x_{m+2}] = R''.  \]
However, $R''$ contains the elements $x_1', \dots, x_m'$. But by construction,
$x_{m+1}$ is integral over the $x_1', \dots, x_m'$. The integral closure of
$k[x_1'', \dots, x_{m}'']$ must contain $x_{m+2}$. This completes the proof in
the case $m=n-2$. The general case is similar; we just make several changes of
variables, successively.

\end{proof} 
\subsection{Back to the Nullstellensatz}

Consider a finitely generated $k$-algebra $R$ which is a field. We need to show that $R$ is a
finite $k$-module. This will prove the proposition.
Well, note that $R$ is integral over a polynomial ring $k[x_1, \dots, x_m]$ for
some $m$.
If $m > 0$, then this polynomial ring has more than one prime. 
For instance, $(0)$ and $(x_1, \dots, x_m)$. But these must lift to primes in
$R$. Indeed, we have seen that whenever you have an integral extension, the
induced map on spectra is surjective. So 
\[ \spec R \to \spec k[x_1, \dots, x_m]  \]
is surjective. If $R$ is a field, this means $\spec k[x_1, \dots, x_m]$ has one
point and $m=0$. So $R$ is integral over $k$, thus algebraic. This implies that
$R$ is finite as it is finitely generated. This proves one version of the
Nullstellensatz. 


\subsection{Another version} Another version of the Nullstellensatz, which is
more precise, says:

\begin{theorem} 
Let $I \subset \mathbb{C}[x_1, \dots, x_n]$. Let $V \subset \mathbb{C}^n$ be
the subset of $\mathbb{C}^n$ defined by the ideal $I$ (i.e. the zero locus of
$I$).

Then $\rad(I)$ is precisely the collection of $f$ such that $f|_V = 0$. In
particular, 
\[ \rad(I) = \bigcap_{\mathfrak{m} \supset I, \mathfrak{m} \
\mathrm{maximal}} \mathfrak{m}.  \]
\end{theorem} 

In particular, there is a bijection between radical ideals and algebraic
subsets of $\mathbb{C}^n$.

The last form of the theorem, which follows from the expression of maximal
ideals in the polynomial ring, is very similar to the result
\[ \rad(I) = \bigcap_{\mathfrak{p} \supset I, \mathfrak{p} \
\mathrm{prime}} \mathfrak{p},  \]
true in any commutative ring. However, this general result is not necessarily
true.

\begin{example} 
The intersection of all primes in a DVR is zero, but the intersection of all
maximals is nonzero. 
\end{example} 
\begin{proof} 
It now suffices to show that for every $\mathfrak{p} \subset \mathbb{C}[x_1,
\dots, x_n]$ prime, we have
\[ \mathfrak{p} = \bigcap_{\mathfrak{m} \supset I \ \mathrm{maximal}} \mathfrak{m}  \]
since every radical ideal is an intersection of primes. 

How can we prove this? Well, let $R = \mathbb{C}[x_1, \dots,
x_n]/\mathfrak{p}$. This is a domain finitely generated over $\mathbb{C}$. We
want to show that the intersection of maximal ideals in $R$ is zero. This is
equivalent to the above displayed equality. 

So fix $f \in R - \left\{0\right\}$. Let $R' = R[f^{-1}]$. Then $R'$ is also an
integral domain, finitely generated over $\mathbb{C}$.  $R'$ has a maximal
ideal $\mathfrak{m}$ (which a priori could be zero). If
we look at the map $R' \to R'/\mathfrak{m}$, we get a map into a field finitely generated
over $\mathbb{C}$, which is thus $\mathbb{C}$. 
The composite map 
\[ R \to  R' \to R'/\mathfrak{m}   \]
is just given by an $n$-tuple of complex numbers, i.e. to a point in
$\mathbb{C}^n$ which is even in $V$ as it is a map out of $R$. This corresponds
to a maximal ideal in $R$. 
This maximal ideal does not contain $f$ by construction. 
\end{proof} 
\lecture{10/22}

Today, we will start talking about completions of commutative rings. Let us
begin with some motivation.

\subsection{Motivation}
Say you have a commutative ring $R$. We can draw $\spec R$, a picture whose
points are the primes of $R$. Consider a maximal ideal $\mathfrak{m} \in \spec
R$. If you think of $\spec R$ as a space, and $R$ as a collection of functions
on that space, then $R_{\mathfrak{m}}$ is the collection of ``germs'' of
functions defined near the point $\mathfrak{m}$. 

The Zariski topology is kind of lousy as far as topologies go, and you can't
really find small neighborhoods of $\mathfrak{m}$.

\begin{example} 
Let $X$ be a compact Riemann surface, and let $x \in X$. Let $R$ be the ring of
holomorphic functions on $X - \left\{x\right\}$ which are meromorphic at $x$.
In this case, $\spec R$ has the ideal $(0)$ and maximal ideals corresponding to
the zero locus at some point in $X - \left\{x\right\}$. So $\spec R$ is $X -
\left\{x\right\}$ together with a ``generic'' point.

Let's just look at the closed points.  If we pick $y \in X - \left\{x\right\}$,
then we can consider the local ring $R_y = \left\{s^{-1}r, s(y) \neq
0\right\}$. This ring is a direct limit of the rings of holomorphic functions
on sets $U$ that extend meromorphically to $X$, where $U$ ranges over open
subsets of $X$ containing $y$ which are the nonzero loci of things in $R$. However, $U$ really ranges over complements of
finite subsets. It does not range over open sets in the \emph{complex} topology.

Near $y$, $X$ looks like the complex numbers in the complex plane. In the Zariski topology, this
isn't the case. Each $R_y$ actually remembers the whole Riemann surface. The
reason is that the quotient field of $R_y$ is the rational function field of
$X$, which recovers $X$. Thus $R_y$ remembers too much. 
\end{example} 

We would like a variant of localization that would remember much less about the
global topology.

\subsection{Definition}

\begin{definition} 
Let $R$ be a commutative ring and $I \subset R$ an ideal. Then we define the
\textbf{completion of $R$ at $I$}
\[ \hat{R}_I = \varprojlim R/I^n.  \]
So this is the inverse limit of the quotients $R/I^n$. There is a tower of
commutative rings
\[ \dots \to  R/I^3 \to R/I^2 \to R/I   \]
whose inverse limit is $R^{\vee}_I$. 
\end{definition} 

Let us give some examples.
\begin{example} 
Let $R = \mathbb{Z}, I = (p)$. Then the completion is denoted $\mathbb{Z}_p$
and is called the ring of \textbf{$p$-adic integers.} This is the inverse limit
of the rings $\mathbb{Z}/p^i$. 
\end{example} 

\begin{example} 
Let $X$ be a Riemann surface. Let $ x \in X$ be as before, and let $R$ be as
before: the ring of meromorphic functions on $X$ with poles only at $x$. We can
complete $R$ at the ideal $\mathfrak{m}_y \subset R$ corresponding to $y \in X - \left\{x\right\}$. This
is always isomorphic to a power series ring
\[ \mathbb{C}[[t]]  \]
where $t$ is a holomorphic coordinate at $y$. 

The reason is that if you consider $R/\mathfrak{m}_y^n$, you always get
$\mathbb{C}[t]/(t^n)$, where $t$ corresponds to a local coordinate at $y$. Thus
\emph{these} rings don't remember much about the Riemann surface. They're all
isomorphic, for instance. 
\end{example} 

\begin{remark} 
Usually, we will complete $R$ at \emph{maximal} ideals.
If we wanted to study $R$ near a prime $\mathfrak{p} \in \spec R$, we might
first approximate $R$ by $R_{\mathfrak{p}}$, which is a local ring; we might
make another approximation by completing $R_{\mathfrak{p}}$. Then we get a
\emph{really} local structure. 
\end{remark} 

\begin{remark} 
There is always a map $R \to \hat{R}_I$ by taking the limit of the maps $R/I^i$.
\end{remark} 

A priori, you might think you get  a big mess. The amazing thing is that for
noetherian rings, you get well-behaved stuff.

\subsection{Properties of completions}

\begin{proposition} 
Let $R$ be noetherian, $I \subset R$ an ideal. Then $\hat{R}_I$ is noetherian.
\end{proposition} 
\begin{proof} 
Choose generators $x_1, \dots, x_n \in I$. This can be done as $I$ is finitely generated
Consider a power series ring 
\[ R[[t_1, \dots, t_n]] ; \]
the claim is that there is a map $R[[t_1\dots t_n]] \to \hat{R}_I$ sending each
$t_i$ to $x_i  \in \hat{R}_I$. This is not trivial, since we aren't talking
about a polynomial ring, but a power series ring. 

To build this map, we  want a compatible family of maps
\[ R[[t_1, \dots, t_n]] \to R[t_1, \dots, t_n]/(t_1, \dots, t_n)^k  \to R/I^k.  \]
where the second ring is the polynomial ring where you have killed homogeneous
polynomials of degree $\geq k$. There is a map from $R[[t_1, \dots, t_n]]$ to
the second ring that kills monomials of degree $ \geq k$. The second map
$R[t_1, \dots, t_n]/(t_1, \dots, t_n)^k \to R/I^k$ sends $t_i \to x_i$ and is
obviously well-defined.

So we get the map
\[ \phi:  R[[t_1, \dots, t_n]] \to \hat{R}_I ,  \]
which I claim is surjective. Let us prove this. Suppose $a \in \hat{R}_I$. Then $a$ can be thought
of as a collection of elements $(a_k) \in R/I^k$ which are compatible with one
another.  We can lift each $a_k$ to some $\overline{a_k} \in R$ in a
compatible manner, such that
\[ \overline{a_{k+1}} = \overline{a_k} + b_k, \quad b_k \in I^k.  \]
Since $b_k \in I^k$, we can write it as
\[ b_k = f_k(x_1, \dots, x_n)  \]
for $f_k$ a polynomial in $R$ of degree $k$, by definition of the generators in
$I^k$. 

I claim now that 
\[ a = \phi\left( \sum f_k(t_1, \dots, t_n)  \right).  \]
The proof is just to check modulo $I^k$ for each $k$. This we  do by induction.
When you reduce  modulo $I^k$, one checks easily that you get $a_k$.

As we have seen, $\hat{R}_I$ is the quotient of a power series ring. In the
homework, it was seen that $R[[t_1, \dots, t_n]]$ is noetherian; this is a
variant of the Hilbert basis theorem proved in class. So $\hat{R}_I$ is
noetherian.
\end{proof} 

We want to think of completion as analogous to localization. We would like to
think of it as an inoffensive operation. One way to say this for localization
was that localization is an exact functor. This is true for completions too.
But first, we need a variant: completions of modules.

\begin{definition} 
Let $R$ be a ring, $M$ an $R$-module, $I \subset R$ an ideal. We define the
\textbf{completion of $M$ at $I$} as 
\[ \hat{M}_I =  \varprojlim M/I^n M.  \]

This is an inverse limit of $R$-modules, so it is an $R$-module. Furthermore,
it is even an $\hat{R}_I$-module, as one easily checks. It is also functorial.
\end{definition} 

\begin{proposition} \label{completionisexact}
If $R$ is noetherian and $I \subset R$ an ideal, then the construction $M \to
\hat{M}_I$ is exact when restricted to finitely generated modules.
\end{proposition} 


Let's be more precise.  If $M$ is finitely generated, and 
\( 0 \to M' \to M \to M'' \to 0  \)
is an exact sequence,\footnote{The ends are finitely generated by noetherianness.} then
\[ 0 \to \hat{M'}_I \to \hat{M}_I \to \hat{M''}_I \to 0  \]
is also exact. 

For a moment, let us step back and think about exact sequences of inverse
limits of abelian groups. Say we have a tower of exact sequences of abelian
groups
\[ 
\xymatrix{
0 \ar[r] &  \vdots \ar[d]  \ar[r] &  \vdots \ar[d]  \ar[r] & \vdots \ar[d]
\ar[r] &  0 \\
0 \ar[r] &  A_2 \ar[d]  \ar[r] &  B_2 \ar[d]  \ar[r] &  C_2 \ar[d]  \ar[r] &  0
\\
0 \ar[r] &  A_1 \ar[d]  \ar[r] &  B_1 \ar[d]  \ar[r] &  C_1 \ar[d]  \ar[r] &  0
\\
0 \ar[r] &  A_0 \ar[r] &  B_0 \ar[r] &  C_0 \ar[r] &  0
}.
\]
Then we get a sequence
\[ 0 \to \varprojlim A_n \to \varprojlim B_n \to \varprojlim C_n \to 0.  \]
In general, it is \emph{not} exact. But it is left-exact. 

\begin{proposition} 
Hypotheses as above, $ 0 \to \varprojlim A_n \to \varprojlim B_n \to
\varprojlim C_n$ is exact. 
\end{proposition} 
\begin{proof} 
It is obvious that $\phi \circ \psi = 0$. 

Let us first show that $\phi: \varprojlim A_n \to \varprojlim B_n$ is
injective. So suppose $a $ is in the projective limit, represented by a
compatible sequence of elements $(a_k )\in A_k$. If $\phi$ maps to zero, all
the $a_k$ go to zero in $B_k$. Injectivity of $A_k \to B_k$ implies that each
$a_k$ is zero. This implies $\phi$ is injective. 

Now let us show exactness at the next step. Let $\psi:  \varprojlim B_n \to
\varprojlim C_n$ and let $b = (b_k)$ be in $\ker \psi$. This means that each
$b_k$ gets killed when it maps to $C_k$. This means that each $b_k$ comes from
something in $a_k$. These $a_k$ are unique by injectivity of $A_k \to B_k$. It
follows that the $a_k$ have no choice but to be compatible. Thus $(a_k)$ maps
into $(b_k)$. So $b$ is in the image of $\phi$. 
\end{proof} 

So far, so good. We get some level of exactness. But the map on the end is not
necessarily surjective. Nonetheless:

\begin{proposition} 
$\psi: \varprojlim B_n \to \varprojlim C_n$ is surjective if each $A_{n+1} \to
A_n$ is surjective.
\end{proposition} 
\begin{proof} 
Say $c \in \varprojlim C_n$, represented by a compatible family $(c_k)$. We
have to show that there is a compatible family $(b_k) \in \varprojlim B_n$
which maps into $c$. It is easy to choose the $b_k$ \emph{individiually} since
$B_k \to C_k$ is surjective. The problem is that a priori we may not get
something compatible.

We construct $b_k$ by induction on then, therefore. Assume that $b_k$ which
lifts $c_k$ has been constructed. 
We know that $c_k$ receives  a map from $c_{k+1}$. 
\[ \xymatrix{
& & c_{k+1 } \ar[d] \\
& b_k \ar[r] &  c_k
}.\]
Choose any $x \in B_{k+1}$ which maps to $c_{k+1}$. However, $x$ might not map
down to $b_k$, which would screw up the compatibility conditions. Next, we try to adjust $x$. 
Consider $x' \in B_k$ to be the image of $x$ under $B_{k+1} \to B_k$. We know
that $x' - b_k$ maps to zero in $C_k$, because $c_{k+1}$ maps to $c_k$.
So $x' - b_k$ comes from something in $A_k$, call it $a$. 
\[ \xymatrix{
& x \ar[r] &  c_{k+1 } \ar[d] \\
& b_k \ar[r] &  c_k
}.\]
But $a$ comes from some $\overline{a} \in A_{k+1}$. Then we define
\[ b_{k+1} = x - \overline{a},  \]
which adjustment doesn't change the fact that $b_{k+1}$ maps to $c_{k+1}$.
However, this adjustment makes $b_{k+1}$ compatible with $b_k$. Then we
construct the family $b_k$ by induction. We have seen surjectivity.
\end{proof} 

Now, let us study the exactness of completions.
\begin{proof}[Proof of Proposition~\ref{completionisexact}]

Let us try to apply the general remarks above to studying the sequence 
\[ 0 \to \hat{M'}_I \to \hat{M}_I \to \hat{M''}_I \to 0.  \]
Now $\hat{M}_I = \varprojlim M/I^n$. We can construct  surjective maps
\[ M/I^n \twoheadrightarrow M''/I^n  \]
whose inverse limits lead to $\hat{M}_I \to \hat{M''}_I$. The image is
$M/(M' + I^n M)$. What is the kernel?
Well, it is $M' + I^n M/ I^n M$.  This is equivalently
\[ M'/M' \cap I^n M.  \]
So we get an exact sequence
\[ 0 \to M'/M' \cap I^n M \to M/I^n M \to M''/I^n M'' \to 0.  \]
By the above analysis of exactness of inverse limits, we get an exact sequence
\[ 0 \to \varprojlim M'/(I^n M \cap M') \to \hat{M}_I \to \hat{M''}_I \to 0.  \]
We of course have surjective maps $M'/I^n M' \to M'/(I^n M \cap M') $ though
these are generally not isomorphisms. Something ``divisible by $I^n$'' in $M$ but
in $M'$ is generally not divisible by $I^n$ in $M'$.
Anyway, we get a map
\[ \varprojlim M'/I^n M' \to \varprojlim M'/I^n M \cap M'  \]
where the individual maps are not necessarily isomorphisms. Nonetheless, I
claim that the map on inverse limits is an isomorphism. This will imply that
completion is indeed an exact functor.

Essentially, to say that this map is an isomorphism is to say that the
filtrations $I^n M'$ and $I^n M \cap M'$ on $M'$ are \emph{comparable.} To
prove this, and to complete the proof of exactness, it suffices to show:
\begin{proposition}[Artin-Rees lemma] Let $R$ be noetherian, $I \subset R$ an
ideal. Suppose $M$ is a finitely generated $R$-module and $M' \subset M$ a submodule. Then
there is a  constant $c$ such that
\[ I^{n+c} M \cap M' \subset I^n M'.  \]
So the two filtrations $I^n M \cap M', I^n M'$ on $M$ are equivalent up to a
shift.
\end{proposition} 
\begin{proof} 
Define a new ring $R' = R \oplus It \oplus I^2 t^2 + \dots$, which is a subring of
$R[t]$. The coefficient of $t^n $ is required to belong to $I^n$. 

\begin{lemma} 
$R'$ is noetherian.
\end{lemma} 
\begin{proof} 
Choose generators $x_1, \dots, x_n \in I$; then there is a map $R[y_1, \dots,
y_n] \to R'$ sending $y_i \to x_i t$. This is surjective. Hence by the basis
theorem, $R'$ is noetherian.
\end{proof} 

Let $N = M \oplus  IM t \oplus I^2 M [t] \oplus \dots \subset M[t] = M
\otimes_R R[t]$. Note that $N$ is an $R'$-module. It is in fact a finitely
generated $R'$-module, hence noetherian, since $M$ was finitely generated over
$R$. Let $N' = N \cap M'[t]$. In particular
\[ N' = M' \oplus (M' \cap IM ) t \oplus \dots.  \]
So $N' \subset N$ is finitely generated. Choose generators for $N'$, and let
$c$ be the largest degree (exponent of $t$) that occurs.
I claim that $c$ works.  This is easy to check, but we're out of time. We'll
talk about this more next week. 
\end{proof} 
\end{proof} 
\lecture{10/25}

Last time, we were talking about completions. We showed that if $R$ is
noetherian and $I \subset R$ an ideal, an exact sequence
\[ 0 \to M' \to M \to M \to 0   \]
of finitely generated $R$-modules leads to a sequence
\[ 0 \to \hat{M'}_I \to \hat{M}_I \to \hat{M;}_I \to 0  \]
which is also exact. We showed this using the Artin-Rees lemma.

\begin{remark}
In particular, completion is an \textbf{exact functor}: if $A \to B \to C$ is
exact, so is the sequence of completions. This can be seen by drawing in
kernels and cokernels, and using the fact that completions preserve short
exact sequences. 
\end{remark}

\subsection{Completions and flatness}

Suppose that $M$ is a finitely generated $R$-module. Then there is a surjection $R^n
\twoheadrightarrow M$, whose kernel is also finitely generated as $R$ is
noetherian. It follows that
$M$ is finitely presented. In particular, there is a sequence
\[ R^m \to R^n \to M \to 0.  \]
We get an exact sequence
\[ \hat{R}^m \to \hat{R}^n \to \hat{M} \to 0  \]
where the second map is just multiplication by the same $m$-by-$n$ matrix as in
the first case.

\begin{corollary} 
If $M$ is finitely generated, there is a canonical isomorphism
\[ \hat{M}_I \simeq M \otimes_R \hat{R}_I.  \]
\end{corollary} 

\begin{proof} 
We know that there is a map $M \to \hat{M}_I$, so the canonical morphism
$\phi_M: M \otimes_R \hat{R}_{I} \to \hat{M}_I$ exists
(because this induces a map from $M \otimes_R \hat{R}_I$). We
need to check that it is an isomorphism. 

If there is an exact sequence $M' \to M \to M'' \to 0$, there is a commutative
diagram
\[ \xymatrix{
M' \otimes_R \hat{R}_I \ar[d]^{\phi_{M'}}  \ar[r] & M \otimes_R \hat{R}_I
\ar[d]^{\phi_M}  \ar[r] &
M'' \otimes_R \hat{R}_I \ar[d] \ar[r] &  0 \\
\hat{M'}_I \ar[r] &  \hat{M}_I \ar[r] &  \hat{M''}_I \ar[r] &  0
}.\]
Exactness of completion and right-exactness of $\otimes$ implies that this
diagram is exact. It follows that if $\phi_M, \phi_{M'}$ are isomorphisms, so
is $\phi_{M''}$. 

But any $M''$ appears at the end of such a sequence with $M', M$ are free by
the finite presentation argument above. So it suffices to prove $\phi$ an
isomorphism for finite frees, which reduces to the case of $\phi_R$ an
isomorphism. That is obvious. 
\end{proof} 

\begin{corollary} 
$\hat{R}_I$ is a flat $R$-module.
\end{corollary} 
\begin{proof} 
Indeed, tensoring with $\hat{R}_I$ is exact (because it is completion, and
completion is exact) on the category of finitely generated $R$-modules.
Exactness on the category of all $R$-modules follows by taking direct limits,
since every module is a direct limit of finitely generated modules, and
direct limits preserve exactness. 
\end{proof} 


\begin{remark} 
Warning: $\hat{M}_I$ is, in general, not $M \otimes_R \hat{R}_I$ when $M$ is
not finitely generated. One example to think about is $M  = \mathbb{Z}[t]$,
$R = \mathbb{Z}$. The
completion of $M$ at $I = (p)$ is the completion of $\mathbb{Z}[t]$ at $p
\mathbb{Z}[t]$, which contains elements like
\[ 1 + pt + p^2 t^2 + \dots,  \]
which belong to the completion but not to $\hat{R}_I \otimes M = \mathbb{Z}_p
[t]$. 
\end{remark} 

\subsection{The Krull intersection theorem}
We lied earlier. What we called the Krull intersection theorem is not actually
called the Krull theorem.

\begin{theorem}[Krull] Let $R$ be a local noetherian ring with maximal ideal
$\mathfrak{m}$.\footnote{This is a favorite time to complete $R$.} Then the map
$R \to \hat{R}_{\mathfrak{m}}$ is injective. Alternatively,
\[ \bigcap \mathfrak{m}^i = (0).  \]
\end{theorem} 

\begin{proof} 
Let $I = \ker(R \to \hat{R}_{\mathfrak{m}})$. We have $I \hookrightarrow R$;
thus there is a map
\[ \hat{I}_{\mathfrak{m}}  \hookrightarrow \hat{R}_{\mathfrak{m}}. \]
Now $\hat{I}_{\mathfrak{m}}$ is generated by $I$ as an
$R_{\mathfrak{m}}$-module. It follows that the map $\hat{I}_{\mathfrak{m}}
\hookrightarrow R_{\mathfrak{m}}$ is the zero map. 

So $\hat{I}_{\mathfrak{m}} = 0$. But this is the inverse limit of  a tower of
abelian groups $I/\mathfrak{m}^i I $ where the maps are surjections; to say
that this limit is zero is to say that $I = \mathfrak{m}I$. So $I = 0$ by
Nakayama. 
\end{proof} 

\subsection{Hensel's lemma} One thing that you might be interested in doing is solving
Diophantine equations. Say $R = \mathbb{Z}$; you want to find solutions to a
polynomial $f(X) \in \mathbb{Z}[X]$. Generally, it is very hard to find
solutions. However, there are easy tests you can do that will tell you if there
are no solutions. For instance, reduce mod a prime. One way you can prove that
there are no solutions is to show that there are no solutions mod 2. 

But there might be solutions mod 2 and yet you might not be sure about
solutions in $\mathbb{Z}$. So you might try mod 4, mod 8, and so on---you get a
whole tower of problems to consider. If you manage to solve all these equations
, you can solve the equations in the 2-adic integers $\mathbb{Z}_2 =
\hat{\mathbb{Z}}_{(2)}$.

But the Krull intersection theorem implies that $\mathbb{Z} \to \mathbb{Z}_2$
is injective. So if you expected that there was a unique solution in
$\mathbb{Z}$, you might try looking at the solutions in $\mathbb{Z}_2$ to be
the solutions in $\mathbb{Z}$.



The moral is that solving an equation over $\mathbb{Z}_2$ is intermediate in
difficulty between $\mathbb{Z}/2$ and $\mathbb{Z}$. Nonetheless, it turns out
that solving an equation mod $\mathbb{Z}/2$ is very close to solving it over
$\mathbb{Z}_2$, thanks to

\begin{theorem}[Hensel's Lemma]
Let $R$ be a noetherian ring, $I \subset R$ an ideal. Let $f(X) \in R[X]$ be a
polynomial such that the equation $f(X)=0$ has a solution $ a \in R/I$.
Suppose, moreover, that $f'(a)$ is invertible in $R/I$. 

Then $a$ lifts uniquely to a solution of the equation $f(X) = 0$ in $\hat{R}_I$.
\end{theorem} 

\begin{example} 
Let $R = \mathbb{Z}, I = (5)$. Consider the equation $f(x) = x^2 + 1 = 0$ in $R$. This
has a solution modulo five, namely $2$. Then $f'(2) = 4$ is invertible in
$\mathbb{Z}/5$. So the equation $x^2 + 1 = 0$ has a solution in $\mathbb{Z}_5$.
In other words, $\sqrt{-1} \in \mathbb{Z}_5$.
\end{example} 

Let's prove Hensel's lemma.
\begin{proof} 
Now we have $a \in R/I$ such that $f(a) = 0 \in R/I$ and $f'(a)$ is invertible. 
The claim is going to be that for each $m \geq 1$, there is a \emph{unique}
element $a_n \in R/I^n$ such that
\[ a_n \to a \ (I), \quad f(a_n)  = 0 \in R/I^n.  \]
Uniqueness implies that this sequence $(a_n)$ is compatible, and thus gives the
required element of the completion.
It will be a solution of $f(X) = 0$ since it is a solution at each element of
the tower.

Let us now prove the claim.
For $n=1$, $a_1 = a$ necessarily. 
The proof is induction on $n$. Assume that $a_n$ exists and is unique. We would like to show
that $a_{n+1}$ exists and is unique. Well, if it is going to exist, when we
reduce $a_{n+1}$ modulo $I^n$, we must get $a_n$ or uniqueness at the $n$-th
step would fail. 

So let $\overline{a}$ be any lifting of $a_n$ to $R/I^{n+1}$.  Then $a_{n+1}$
is going to be that lifting plus some $\epsilon \in I^n/I^{n+1}$. We want
\[ f(\overline{a} + \epsilon) = 0 \in R/I^{n+1}.  \]
But this is 
\[ f(\overline{a}) +  \epsilon f'(\overline{a})  \]
because $\epsilon^2 = 0 \in R/I^{n+1}$. However, this lets us solve for
$\epsilon$, because then necessarily $\epsilon =
\frac{-f(\overline{a})}{f'(\overline{a})} \in I^n$.
Note that $f'(\overline{a}) \in R/I^{n+1}$ is invertible. If you believe this
for a moment, then we have seen that $\epsilon$ exists and is unique; note
that $\epsilon \in I^n$ because $f(\overline{a}) \in I^n$. 


\begin{lemma} 
$f'(\overline{a}) \in R/I^{n+1}$ is invertible.
\end{lemma} 
\begin{proof} 
If we reduce this modulo $R/I$, we get the invertible element $f'(a) \in R/I$.
Note also that the $I/I^{n+1}$ is a nilpotent ideal in $R/I^{n+1}$. So we are
reduced to showing, more generally:

\begin{lemma} 
Let $A$ be a ring,\footnote{E.g. $R/I^{n+1}$.} $J$ a nilpotent
ideal.\footnote{E.g. $J = I/I^{n+1}$.} Then an element $x \in A$ is invertible
if and only if its reduction in $A/J$ is invertible.
\end{lemma} 
\begin{proof} 
One direction is obvious. For the converse, say $x \in A$  has an invertible
image. This implies that there is $y \in A$ such that $xy \equiv 1 \mod J$. Say
$$xy = 1+m,$$ where $m \in J$. But $1+m$ is invertible because 
\[ \frac{1}{1+m} = 1 - m + m^2 \pm \dots.  \]
The expression makes sense as the high powers of $m$ are zero. 
So this means that $y(1+m)^{-1}$ is the inverse to $x$. 
\end{proof} 
\end{proof} 
\end{proof} 

This was one of many versions of Hensel's lemma. There are many ways you can
improve on a statement. The above version says something about
``nondegenerate'' cases, where the derivative is invertible. There are better
versions which handle degenerate cases.

\begin{example} 
Consider $x^2 - 1$; let's try to solve this in $\mathbb{Z}_2$. Well,
$\mathbb{Z}_2$ is a domain, so the only solutions can be $\pm 1$. But these
have the same reduction in $\mathbb{Z}/2$. The lifting of the solution is
non-unique.

The reason why Hensel's lemma fails is that $f'(\pm 1) = \pm 2$ is not
invertible in $\mathbb{Z}/2$. But it is not far off. If you go to
$\mathbb{Z}/4$, we do get two solutions, and the derivative is at least nonzero
at those places.
\end{example} 

One possible extension of Hensel's lemma is to allow the derivative to be
noninvertible, but at least to bound the degree to which it is noninvertible.
From this you can get interesting information. 
But then you may have to look at equations $R/I^n$ instead of just $R/I$, where
$n$ depends on the level of noninvertibility.

Let us describe the multivariable Hensel lemma.

\begin{theorem} 
Let $f_1, \dots, f_n$ be polynomials in $n$ variables over the ring $R$. Let
$J$ be the Jacobian matrix $( \frac{\partial f_i}{\partial x_j})$. Suppose
$\Delta = \det J \in R[x_1, \dots, x_n]$. 

If the system $\left\{f_i(x) = 0\right\}$ has a solution $a \in (R/I)^n$ in $R/I$ for some
ideal $I$ satisfying the condition that $\Delta(a)$ is invertible, then there
is a unique solution of $\left\{f_i(x) =0\right\}$ in $\hat{R}_I^n$ which lifts $a$. 
\end{theorem} 
The proof is the same idea: successive approximation, using the invertibility
of $\Delta$. 
\lecture{10/27}

\subsection{Regular local rings}

We have been talking about the dimension theory of local noetherian rings. If
$R$ is such a ring with maximal ideal $\mathfrak{m}$, then the \emph{dimension}
of $R$ has been defined in several ways. One of these ways is that 
$\dim (R)$ is the minimum $n \in \mathbb{Z}_{\geq 0}$ such that there are $n$
elements $x_1, \dots, x_n \in \mathfrak{m}$ such that $R/(x_1, \dots, x_n)$ is
an artinian ring. If these $n$ elements were to generate $\mathfrak{m}$, then
we'd get not only an artinian ring, but in fact a field. 

Let $k = R/\mathfrak{m}$.
\begin{proposition} For any noetherian local ring $R$,
$\dim(R) \leq \dim_{k} \mathfrak{m}/\mathfrak{m}^2$.
\end{proposition} 
\begin{proof} 
Indeed, $\dim_k \mathfrak{m}/\mathfrak{m}^2$ is, by Nakayama, the smallest
number of generators for $\mathfrak{m}$. So this vector-space dimension is the
\emph{embedding dimension} defined earlier.
\end{proof} 

\begin{definition} 
$R$ is \textbf{regular} if $\dim(R) = \dim_k \mathfrak{m}/\mathfrak{m}^2$.
Alternatively, $R$ is regular if $\mathfrak{m}$ can be generated by $\dim(R)$
elements.
\end{definition} 

\subsection{A bunch of examples}
\begin{example} 
If $\dim(R)=0$, i.e. $R$ is artinian, then $R$ is regular iff the maximal ideal
is zero, i.e. if $R$ is a field.
\end{example} 

\begin{example} 
If $\dim(R) =1$, then it is regular iff $\mathfrak{m}$ is principal. In a
noetherian local ring, the maximal ideal is principal iff $R$ is a DVR.
This is \emph{likely} already proved in these notes. 
\end{example} 
We find:
\begin{proposition} 
A one-dimensional regular local ring is the same thing as a DVR.
\end{proposition} 

\newcommand{\maxspec}{\mathrm{MaxSpec}}
\begin{example} 
Let $R$ be  be the coordinate ring $ \mathbb{C}[x_1, \dots, x_n]/I$ of an algebraic
variety. Let $\mathfrak{m}$ be  a maximal ideal corresponding to the origin.
Then $\maxspec R \subset \spec R$ is a subvariety of $\mathbb{C}^n$, and $0$ is in this subvariety.

Then I claim:

\begin{proposition} 
$R_{\mathfrak{m}}$ is regular iff $\maxspec R$ is a smooth submanifold near $0$.
\end{proposition}
\begin{proof} 
We will show that regularity implies smoothness. The other direction is omitted.

We have a surjection $\mathbb{C}[x_1, \dots, x_n ] \twoheadrightarrow R$, with
kernel $I$. There is a maximal ideal $\mathfrak{m}' \subset \mathbb{C}[x_1,
\dots, x_n]$ defined as $(x_1, \dots, x_n)$. Then we have a surjection
\[ \mathfrak{m}'/\mathfrak{m}'^2 \twoheadrightarrow \mathfrak{m}/\mathfrak{m}^2  \]
whose kernel is $I + \mathfrak{m}'^2/\mathfrak{m}'^2 $. We find that
\[ \mathfrak{m}/\mathfrak{m}^2 = \mathfrak{m}'/(I + \mathfrak{m}'^2).  \]
Note that $\mathbb{C}[x_1, \dots, x_n]_{\mathfrak{m}'}$ is a regular local
ring of dimension $n$.

The first claim is that $R_{\mathfrak{m}}$ is regular if and only if, after
localizing the polynomial ring at the maximal ideal $\mathfrak{m}'$, the ideal
$I$ is generated by $n - \dim(R)$ functions having linearly independent
derivatives.	Granting this claim, say $I_{\mathfrak{m}'}$ is generated by
elements $f_1, \dots, f_m \in I$; then there is a map
\[ \mathbb{C}^n \stackrel{(f_1, \dots, f_m)}{\to} \mathbb{C}^m  \]
which is a submersion at the origin as the derivatives $\nabla f_i$ are
linearly independent at the origin. The implicit function theorem tells us that
the inverse image of zero, i.e. $\maxspec R$, is locally a submanifold. 

Now we need to verify the claim made earlier. Namely, we will show that
regularity of $R$ implies that $I_{\mathfrak{m}}$ is generated by elements
whose derivatives are linearly independent. However, we will postpone this
until next time.
\end{proof} 
\end{example} 


\subsection{Regular local rings look alike}
So, as we've seen, regularity corresponds to smoothness. Complex analytically,
all smooth points are the same though---they're locally manifolds.  We'd like
an algebraic version of this. The vague
claim is that all regular local rings of the same dimension ``look alike.''


Let $(R, \mathfrak{m})$ be a noetherian  local ring. Consider the graded ring
\[ S = R/\mathfrak{m} \oplus \mathfrak{m}/\mathfrak{m}^2 \oplus \dots.  \]
If we write $k = R/\mathfrak{m}$ be the residue field, it is easy to see that this is a finitely
generated $k$-algebra. If we choose elements $x_1, \dots, x_n \in
\mathfrak{m}/\mathfrak{m}^2$ generating this vector space, then they generate
$S$ as an algebra. 

\begin{proposition} 
$R$ is regular if and only if $S$ is isomorphic to the polynomial ring $k[x_1,
\dots, x_n]$, i.e. for every $f \in k[x_1, \dots, x_n]$, if $f$ maps to zero
in $S$, then $f=0$.
\end{proposition} 
\begin{proof} 
Suppose first that $k[x_1, \dots, x_n] \twoheadrightarrow S$ isn't injective.
Then there exists a $f \neq 0$ in this polynomial ring which maps to zero in
$S$. Then $S$ is not just a quotient of this polynomial ring, but a quotient of
$k[x_1, \dots, x_n]/(f) \twoheadrightarrow S$. As this is a map of gaded
rings, we can assume that $f$ is homogeneous. 

In particular, the Hilbert
function of $S$ is less than or equal to the Hilbert function of $k[x_1, \dots,
x_n]/(f)$. In particular, the degree of the Hilbert function of $S$, namely
the dimension of $R$, is at most
the degree of the Hilbert function of this quotient---and quotienting by $f$
will reduce the degree of the Hilbert function so that it is $<n$. So $\dim(R) <n$.

If $S$ is isomorphic to a polynomial ring, then we can just read off what the
Hilbert function of $R$ will be, and we find that its degree is $n$.
\end{proof} 

As we have seen, regularity is equivalent to a statement about the associated
graded of $R$. Now we would like to transfer this to statements about things
closer to $R$. 

\textbf{Assume now for simplicity that the residue field of $k=R/\mathfrak{m}$
maps back into $R$.} This is always true in complex algebraic geometry, as the
residue field is just $\mathbb{C}$. Choose generators $y_1, \dots, y_m \in
\mathfrak{m}$ where $n = \dim_k \mathfrak{m}/\mathfrak{m}^2$ is the embedding
dimension. We get a map in the other direction
\[ \phi:k[y_1, \dots, y_m] \to R  \]
thanks to the section $k \to R$. This map from the polynomial ring is maybe not
an isomorphism, but if we let $\mathfrak{m} \subset R$ be the maximal ideal,
and $\mathfrak{n} = (y_1, \dots, y_m)$, the maps on associated gradeds will be
the same.

We find, by the previous result:

\begin{proposition} 
$R$ is regular iff  $\phi$ induces an isomorphism on the associated graded,
i.e. if $\mathfrak{n}^t/\mathfrak{n}^{t+1} \to
\mathfrak{m}^t/\mathfrak{m}^{t+1}$ is an isomorphism.
\end{proposition} 

That is, $\phi$ induces an isomorphism
\[ k[y_1, \dots,y_m]/\mathfrak{n}^t \simeq R/\mathfrak{m}^t  \]
for all $t$, because it is an isomorphism on the associated graded level.
So this in turn is equivalent, upon taking inverse limits, to the statement that
$\phi$ induces an isomorphism
\[ k[[y_1, \dots, y_m ]] \to \hat{R} \]
at the level of completions.

We can now conclude:
\begin{theorem} 
Let $R$ be a regular local ring of dimension $m$. Suppose $R$ contains a copy
of its residue field $k$.\footnote{I.e. there is a section of the map $R
\twoheadrightarrow R/\mathfrak{m}$.} Then $\hat{R} \simeq k[[x_1, \dots, x_m]]$.
\end{theorem} 


Let us now state this informally. First, note that:
\begin{proposition} 
For any local noetherian ring $R$, we have $\dim(R) = \dim(\hat{R})$.
\end{proposition} 
\begin{proof} 
Immediate from the expression of dimension via Hilbert polynomials.
\end{proof} 

On a similar note, the \emph{embedding dimension} of $R$ is the same as that of
the completion, because $\mathfrak{m}/\mathfrak{m}^2$ is regular.
So:
\begin{proposition} 
$R$ is regular local iff $\hat{R}$ is regular local.
\end{proposition} 

Finally:
\begin{corollary} 
A complete noetherian regular local ring that contains a copy of its residue
field $k$ is a power series ring over $k$.
\end{corollary} 

It now makes sense to say:
\begin{quote}
\textbf{All \emph{complete} regular local rings of the same dimension look
alike.} (More precisely, this is true when $R$ is assumed to contain a copy of
its residue field, but this is not a strong assumption in practice. One can
show that this will be satisfied if $R$ contains \emph{any}
field.\footnote{This is not always satisfied---take the $p$-adic integers, for instance.})
\end{quote}

We won't get into the precise statement of the general structure theorem, when
the ring is not assumed to contain its residue field, but a safe
intuition to take away from this is the above bolded statement.


\subsection{Regular local rings are domains}


Here is one nice property of regular local rings.

\begin{proposition} 
If $R$ is a regular local (noetherian, as always) ring, then $R$ is a domain.
\end{proposition} 

Geometrically, this is saying that smooth points are locally irreducible.
\begin{proof} 
Say $xy=0$ in $R$. We want to prove that one of $x,y$ is zero. Let us invoke
the Krull intersection theorem, which states that $(0) = \bigcap
\mathfrak{m}^i$. Then if $x \neq 0$, $x \in \mathfrak{m}^t -
\mathfrak{m}^{t+1}$ for some $t$. Same for $y$, if it is not zero: we can
choose $y \in \mathfrak{m}^u - \mathfrak{m}^{u+1}$. Then $x,y$ correspond to
elements $\overline{x}, \overline{y}$ in the associated graded ring (in the
$t$th and $u$th pieces) which are nonzero. Their product is nonzero in the
associated graded ring because that is a polynomial ring, hence a domain. So
$\overline{x} \overline{y} \neq 0$ in $\mathfrak{m}^{s+t}/\mathfrak{m}^{s+t+1}$.

Thus $xy \neq 0$, contradiction.

\end{proof} 

Later we will prove much more. In fact, a regular local ring is a factorial
ring. This is something we're not ready to prove yet, but one consequence of
that will be the following algebro-geometric fact. Let $X = \spec
\mathbb{C}[X_1, \dots, X_n]/I$ for some ideal $I$; so $X$ is basically a subset
of $\mathbb{C}^n$ plus some nonclosed points. Then if $X$ is smooth, we find
that $\mathbb{C}[X_1, \dots, X_n]/I$ is locally factorial. Indeed, smoothness
implies regularity, hence local factoriality. The whole apparatus of Weil and
Cartier divisors now kicks in.
\lecture{11/10}


\subsection{Regularity and algebraic geometry}
We were talking about the theory of regular local rings. Recall an assertion
made last time.

Take the ring $\mathbb{C}[X_1, \dots, X_n]$, and $\mathfrak{m} = (X_1, \dots,
X_n)$ the maximal ideal at zero. Let $R = (\mathbb{C}[X_1, \dots,
X_n]_{\mathfrak{m}})/I$ for some ideal $I$. Let $\phi: \mathbb{C}[X_1, \dots,
X_n] \to R$ be the canonical map. The maximal ideal $\mathfrak{n}$ of $R$ is
generated by $\phi(\mathfrak{m})$.

Last time, we claimed:
\begin{proposition} 
$R$ is regular local iff $I$ is generated by functions $f_1, \dots, f_m$ which
have linearly independent derivatives at zero.
\end{proposition} 

\begin{proof} 
Let's first think about what the condition of having linearly independent
derivatives means. 

If we consider $\mathbb{C}[X_1, \dots, X_n]/\mathfrak{m}$,
this is isomorphic to $\mathbb{C}$, the isomorphism being given by evaluation
at zero. 
Now $\mathfrak{m}/\mathfrak{m}^2 = \mathbb{C}^n$ having a basis given
by the images of $X_1, \dots, X_n$. A more canonical way of describing this is
as the \textbf{cotangent space} of $\mathbb{C}^n$ at the origin. The idea is
that any polynomial $f$ corresponds to the 1-form $df = \sum \frac{\partial
f}{\partial X_i} dX_i$. The evaluation of this 1-form at the origin gives a
formal linear combination of the symbols $dX_i$. It is easy to see that $df|_0$
vanishes if $f$ is constant or is in $\mathfrak{m}^2$.
Restricting to $\mathfrak{m}$, we get a map
\[ \mathfrak{m}/\mathfrak{m}^2 \to \mathbb{C}^n, \quad f \to df|_0,  \]
which is obviously an isomorphism.

Consider $f_1, \dots, f_a \in \mathfrak{m}$. We have seen that \emph{the derivatives (or gradients) are
linearly independent at the origin iff the images of $f_1, \dots, f_a$ are
linearly independent in $\mathfrak{m}/\mathfrak{m}^2$. }

If we consider $\mathbb{C}[X_1, \dots,X_n]_{\mathfrak{m}}$, last time we
mentioned that it was a regular local ring. The result will now follow from
\begin{lemma} 
Let $R $ be a quotient of a regular local ring $S$, say $R = S/I$ for some
$I$. Let $\mathfrak{m} \subset S$ be the maximal ideal. Then $R$ is regular iff
$I$ is generated by elements $f_1, \dots, f_a$ which are linearly independent
in $\mathfrak{m}/\mathfrak{m}^2$.
\end{lemma} 
\begin{proof} 
First, the easy direction. Say $I = (f_1,\dots, f_a)$ where $f_1, \dots, f_a$
are linearly independent in $\mathfrak{m}/\mathfrak{m}^2$. $S$ is regular, so
the dimension is equal to the embedding dimension of $S$. We want to show the
same thing for $R$.

Now $\dim R = \dim S/(f_1, \dots, f_a)$. We would expect that the dimension
drops by $a$; we can't immediately conclude this, but at least can argue that
\[ \dim R \geq \dim S - a  \]
by the principal ideal theorem. Let now $\mathfrak{n} \subset R$ be the maximal
ideal. The embedding dimension of $R$ is the dimension of
$\mathfrak{n}/\mathfrak{n}^2 \simeq \mathfrak{m}/(I + \mathfrak{m}^2)$. This is
a quotient of $\mathfrak{m}/\mathfrak{m}^2$, so its dimension is the dimension
of $\mathfrak{m}/\mathfrak{m}^2$ minus the image of $I$ in
$\mathfrak{m}/\mathfrak{m}^2$. This is precisely the embedding dimension of $S$
minus $a$, i.e. $\dim S - a$. We learn that
\[ \dim R \geq \dim S - a = \mathrm{embedding \ dim} R,  \]
which implies that $R$ is local, as the converse implication is true in any
noetherian local ring.

Now we want to do the converse. Say that $R$ is regular of dimension $\dim S
-a$. We want to find elements $f_1, \dots, f_a$.
So far, we know that the embedding dimension of $R$ is equal to the embedding
dimension of $S$ minus $a$. In particular,
\[ \dim \mathfrak{n}/\mathfrak{n}^2 = \dim \mathfrak{m}/(\mathfrak{m}^2+I) =
\dim \mathfrak{m}/\mathfrak{m}^2 - a.  \]
We can choose $f_1, \dots, f_a \in I$ such that their images in
$\mathfrak{m}/\mathfrak{m}^2$ are a basis for  the image of $I$. 
We have maps
\[ S \twoheadrightarrow S/(f_1, \dots, f_a) \twoheadrightarrow S/I = R.  \]
What can we say about the intermediate ring $R'=S/(f_1, \dots, f_a)$? It is
obtained from a regular local ring by killing elements linearly independent in
$\mathfrak{m}/\mathfrak{m}^2$. In particular, $R'$ is regular local of
dimension $\dim (S) -a$. 

We want to prove that $I = (f_1, \dots, f_a)$, i.e. $R = R'$. Suppose not. Then
$R  = R'/J$ for some ideal $J \neq 0$. Choose any $x \in J$ which is not zero.
Then $x$ is  a nonzerodivisor on $R'$ because $R'$ is regular. In particular, $R'/(x)$ has dimension
$\dim R' -1$. Since $R$ is a quotient of this, we have that $\dim R < \dim R' =
\dim S -a$. This is a contradiction from our earlier assumptions.
\end{proof} 
\end{proof} 


The upshot of this is that in algebraic geometry, regularity has something to
do with smoothness. 

\begin{remark}[Warning] This argument proves that if $R \simeq K[x_1, \dots,
x_n]/I$ for $K$ algebraically closed, then $R_{\mathfrak{m}}$ is regular local for some maximal ideal
$\mathfrak{m}$ if the corresponding algebraic variety is smooth at the
corresponding point. We proved this in the special case $K  = \mathbb{C}$ and
$\mathfrak{m}$ the ideal of the origin.

If $K$ is not algebraically closed, we \textbf{can't assume} that any maximal
ideal corresponds to a point in the usual sense. Moreover, if $K$ is not
perfect, regularity does \textbf{not} imply smoothness. We have not quite
defined smoothness, but here's a definition: smoothness means that the local
ring you get by base-changing $K$ to the algebraic closure is regular. So what
this means is that 
regularity of affine rings over a field $K$ is not preserved under
base-change from $K$ to $\overline{K}$. 
\end{remark} 

\begin{example} Let $K$ be non-perfect of characteristic $p$. Let $a$ not have
a $p$th root.
Consider $K[x]/(x^p -a)$. This is a regular local ring of dimension zero, i.e.
is a field. If $K$ is replaced by its algebraic closure, then we get
$\overline{K}[x]/(x^p - a)$, which is $\overline{K}[x]/(x- a^{1/p})^p$. This is
still zero-dimensional but is not a field. Over the algebraic closure, the ring
fails to be regular.
\end{example} 

\subsection{Derivations and K\"ahler differentials} Let $R$ be a ring with the maximal ideal
$\mathfrak{m}$. Then there is a $R/\mathfrak{m}$-vector space
$\mathfrak{m}/\mathfrak{m}^2$. This is what we would like to think of as the
``\textbf{cotangent space}'' of $\spec R$ at $\mathfrak{m}$. Intuitively, the
cotangent space is what you get by differentiating functions which vanish at
the point, but
differentiating functions that vanish twice should give zero. This is the moral
justification.

A goal might be to generalize this. What if you wanted to think about all
points at once? We'd like to describe the ``cotangent bundle'' to $\spec R$ in
an analogous way. Let's try and describe what would be a section to this
cotangent bundle. Morally, a section of $\Omega^*_{\spec R}$ should be the same
thing as a ``1-form'' on $\spec R$. We don't know what a 1-form is yet, but at
least we can give some examples. If $f \in R$, then $f$ is a ``function'' on
$\spec R$, and its ``differential'' should be a 1-form. So there should be a
``$df$'' which should be a 1-form. 

We should expect the rules $d(finitely generated  = df+dg$ and $d(fg) = f(dg) + g(df)$ as the
usual rules of differentiation. For this to make sense, 1-forms should be an
$R$-module. 

\begin{definition} 
Let $R$ be a commutative ring, $M$ an $R$-module. A \textbf{derivation} from
$R$ to $M$ is a map $D: R \to M$ such that the two identities
\[ D(finitely generated = Df + Dg  \]
and
\[ D(fg) = f(Dg) + g(Df)  \]
hold.
\end{definition} 
These equations make sense as $M$ is an $R$-module.

Whatever a 1-form might be, there should be a derivation
\[ R \to \left\{\mathrm{1-forms}\right\}.  \]
An idea would be to \emph{define} the 1-forms or the ``cotangent bundle''
$\Omega_R$ by a
universal property. It should be universal among $R$-modules with a derivation.

To make this precise:
\begin{proposition} 
There is an $R$-module $\Omega_R$ and a derivation $d_{\mathrm{univ}} : R \to
\Omega_R$ satisfying the following universal property. For all $R$-modules
$M$, there is a canonical isomorphism 
\[ \hom_{R}(\Omega_R, M) \simeq \mathrm{Der}(R, M)  \]
given by composing the universal $d_{\mathrm{univ}}$ with a map $\Omega_R \to M$.
\end{proposition} 

That is, any derivation $d: R \to M$ factors through this universal derivation
in a unique way. Given $d: R \to M$, we can make the following diagram
commutative in a natural way:
\[ 
\xymatrix{
R \ar[r]^d \ar[d]  &  M \\
\Omega_R \ar[ru]^{d_{\mathrm{univ}}}
}
\]

\begin{definition} 
$\Omega_R$ is called the module of \textbf{K\"ahler differentials} of $R$.
\end{definition} 

Let us now verify this proposition.
\begin{proof} 
This is like the verification of the tensor product. Namely, build a free
gadget and quotient out by whatever you need.

Let $\Omega_R$ be the quotient of the free $R$-module generated by elements
$da$ for $a \in R$ by enforcing the relations
\begin{enumerate}
\item $d(a+b) =da + db$. 
\item $d(ab) = adb + bda$.
\end{enumerate}
By construction, the map $a \to da$ is a derivation $R \to \Omega_R$. 
It is easy to see that is universal. Given a derivation $d: R \to M$, we get a
map $\Omega_R \to M$ sending $da \to d(a), a \in R$.
\end{proof} 

We are going to need a slight variant.

\subsection{Relative differentials}
\begin{definition} 
Let $f: R \to R'$ be a ring-homomorphism. Let $M$ be an $R'$-module. A
derivation $d: R' \to M$ is \textbf{$R$-linear if $d(f(a)) = 0, a \in R$.}
This is equivalent to saying that $d$ is an $R$-homomorphism by the Leibnitz
rule.
\end{definition} 

\begin{proposition} 
There is a universal $R$-linear derivation $R'
\stackrel{d_{\mathrm{univ}}}{\to} \Omega_{R'/R}$.
\end{proposition} 
\begin{proof} 
Use the same construction as in the absolute case. We get a map $R' \to
\Omega_{R'}$ as before. This is not generally $R$-linear, so you have to
quotient out by the images of $d(f(b)), b \in R$.
\end{proof} 

\begin{remark} 
We see that $\Omega_{R'/R}$ as in the proposition is obtained by killing the
images of $d(f(b)), b \in R$. 
\end{remark} 

\begin{definition} 
This is called the module of \textbf{relative K\"ahler differentials.}
\end{definition} 

\begin{theorem} 
There is a canonical exact sequence of $R'$-modules
\[ R' \otimes_R \Omega_R \to \Omega_{R'} \to \Omega_{R'/R} \to 0.  \]
\end{theorem} 
This is generally not exact on the left.
\begin{proof} 
This follows from the remark. 
\end{proof} 

\subsection{Examples} Let us do some examples to make this more concrete.

\begin{example} 
Let $R' = \mathbb{C}[x_1, \dots, x_n], R = \mathbb{C}$. In this case, the claim
is that there is an isomorphism
\[ \Omega_{R'/R} \simeq R'^n.  \]
More precisely, $\Omega_{R'/R}$ is free on $dx_1, \dots,dx_n$. So the cotangent
bundle is ``free.''

\begin{proof} 
The construction $f \to \left( \frac{\partial f}{\partial x_i}  \right)$ gives
a map $R' \to R'^n$. By elementary calculus, this is a derivation, even an
$R$-linear derivation.  We get a map
\[ \phi:\Omega_{R'/R} \to R'^n  \]
by the universal property of the K\"ahler differentials. The claim is that this
map is an isomorphism. The map is characterized by sending $df$ to $\left(
\frac{\partial f}{\partial x_i}\right)$. Note that $dx_1, \dots, dx_n$ map to a
basis of $R'^n$ because differentiating $x_i$ gives 1 at $i$ and zero at $j
\neq i$. So we see that $\phi$ is surjective. 

There is a map $\psi: R'^n \to \Omega_{R'/R}$ sending $\left(a_i  \right)$ to
$\sum a_i dx_i$. It is easy to check that $\phi \circ \psi = 1$ from the
definition of $\phi$. What we still need to show is that $\psi \circ \phi =1$.
Namely, for any $f$, we want to show that $\psi \circ \phi(df) = df$ for $f \in
R'$. This is precisely the claim that $df = \sum \frac{\partial f}{\partial
x_i} dx_i$. Both sides are additive in $f$, indeed are derivations, and
coincide on monomials of degree one, so they are equal.
\end{proof} 

\end{example} 
\lecture{11/12}

\subsection{Formal properties of K\"ahler differentials}
So we were talking about K\"ahler differentials yesterday. Recall that if
$\phi: A \to B$ is a map of rings, we can define a $B$-module
\[ \Omega_{B/A} = \mathrm{generated \ by } \ dx|_{x \in
B}/\left\{d(x+y) = dx+dy, d(a)=0 \ \forall a \in A, d(xy) = xdy + ydx\right\}. \]
By construction, $\Omega_{B/A}$ is the receptacle from the universal $A$-linear
derivation into a $B$-module.

Let $A \to B \to C$ be a map of rings. There is an obvious map $dx \to dx$
\[ \Omega_{C/A} \to \Omega_{C/B}  \]
where both sides have the same generators, except with a few additional
relations on $\Omega_{C/B}$. We have to quotient by $db, b \in B$. In
particular, there is a map $\Omega_{B/A} \to \Omega_{C/A}$, $dx \to dx$, whose images
generates the kernel. This induces a map
\[ C \otimes_B \Omega_{B/A} \to \Omega_{C/A}.  \]
We have proved:
\begin{proposition} Given a sequence $A \to B \to C$ of rings, there is an exact sequence 
\[  C \otimes_B \Omega_{B/A} \to \Omega_{C/A} \to \Omega_{C/B} \to 0 .\]
\end{proposition} 
Let us list another property. Last time, we showed:
\begin{proposition} 
If $R$ is a ring, then 
\[ \Omega_{R[x_1, \dots, x_n]/R} = R[x_1, \dots,x_n]^n.  \]
\end{proposition} 

Finally, let us look at the K\"ahler differentials for quotient rings. Let $A
\to  B$ be a  homomorphism of rings and $I \subset B $ an ideal. We would like
to describe $\Omega_{B/I/A} $. There is a map
\[ \Omega_{B/A} \to \Omega_{B/I/A}  \]
sending $dx$ to $d \overline{x}$ for $\overline{x}$ the reduction of $x$ in
$B/I$. This is surjective on generators, so it is surjective. It is not
injective, though. In $\Omega_{B/I/A}$, the generators $dx, dx'$ are identified
if $x \equiv x' \mod I$.  Moreover, $\Omega_{B/I/A}$ is a 
$B/I$-module. 
This means that there will be additional relations for that. To remedy this, we
can tensor and consider the morphism
\[ \Omega_{B/A} \otimes_B B/I \to \Omega_{B/I/A} \to 0.  \]

Let us now define a map 
\[ \phi: I /I^2 \to \Omega_{B/A} \otimes_B B/I,  \]
which we claim will generate the kernel. Given $x \in I$, we define $\phi(x) =
dx$. If $x \in I^2$, then $dx \in I \Omega_{B/A}$ so $\phi$ is indeed a map of
abelian groups
$I/I^2 \to \Omega_{B/A} \otimes_B B/I$. Let us check that this is a
$B/I$-module homorphism. We would like to check that $\phi(xy) = y \phi(x)$
for $x \in I$ in
$\Omega_{B/A}/I \Omega_{B/A}$. This follows from the Leibnitz rule, $\phi(xy) =
y \phi(x) + xdy \equiv x \phi(x) \mod I \Omega_{B/A}$. So $\phi$ is also
defined. Its image is the submodule of $\Omega_{B/A}/I \Omega_{B/A}$ generated
by $dx, x \in I$. This is precisely what one has to quotient out by to get
$\Omega_{B/I/A}$. In particular:

\begin{proposition} Let $B$ be an $A$-algebra and $I \subset B$ an ideal.
There is an exact sequence
\[ I/I^2 \to \Omega_{B/A} \otimes_B B/I \to \Omega_{B/I/A} \to 0.  \]
\end{proposition} 

These results will let us compute the module of K\"ahler differentials in cases
we want.

\begin{example} 
Let $B = A[x_1, \dots, x_n]/I$ for $I$ an ideal. We will compute $\Omega_{B/A}$.

First, $\Omega_{A[x_1, \dots, x_n]/A} \otimes B \simeq B^n$ generated by
symbols $dx_i$. There is a surjection of
\[ B^n \to \Omega_{B/A} \to 0  \]
whose kernel is generated by $dx, x \in I$, by the second exact sequence above.
If $I = (f_1, \dots, f_m)$, then the kernel is generated by 
$\left\{df_i\right\}$.
It follows that $\Omega_{B/A}$ is the cokernel of the map
\[ B^m \to B^n  \]
that sends the $i$th generator of $B^m$ to $df_i$ thought of as an element in
the free $B$-module $B^n$ on generators $dx_1, \dots, dx_n$. Here, thanks to
the Leibnitz rule, $df_i$ is
given by formally differentiating the polynomial, i.e.
\[ df_i = \sum_j \frac{\partial f_i}{\partial x_j} dx_j. \] We have thus
explicitly represented $\Omega_{B/A}$ as the cokernel of the matrix $\left(
\frac{\partial f_i}{\partial x_j}\right)$.
\end{example} 

Last time, we were talking about the connection of K\"ahler differentials and
the cotangent bundle.
\begin{example} 
Let $R = \mathbb{C}[x_1, \dots, x_n]/I$ be the coordinate ring of an algebraic
variety. Let $\mathfrak{m} \subset R$ be the maximal ideal. Then 
$\Omega_{R/\mathbb{C}}$ is what you should think of as containing information
of the cotangent bundle of $\spec R$. You might ask what the fiber over a point
$\mathfrak{m} \in \spec R$ is, though. That is, we might ask what
\[ \Omega_{R/\mathbb{C}} \otimes_R R/\mathfrak{m}  \]
is. To see this, we note that there are maps
\[ \mathbb{C} \to R \to R/\mathfrak{m} \simeq \mathbb{C}.  \]
There is now an exact sequence by our general properties
\[ \mathfrak{m}/\mathfrak{m}^2 \to \Omega_{R/\mathbb{C}} \otimes_R
R/\mathfrak{m} \to \Omega_{\mathbb{R}/\mathfrak{m}/\mathbb{C}} \to 0  \]
where the last thing is zero as $R/\mathfrak{m} \simeq \mathbb{C} $ by the
Nullstellensatz.
The upshot is that $\Omega_{R/\mathbb{C}} \otimes_R R/\mathfrak{m}$ is a
quotient of $\mathfrak{m}/\mathfrak{m}^2$. Let's leave it there for now.
\end{example} 

\subsection{K\"ahler differentials for fields}

Let us start with the simplest examples---fields.

\begin{example} 
Let $k$ be a field, $k'/k$ an extension. 
\begin{question} 
What does $\Omega_{k'/k}$ look like? When does it vanish?
\end{question} 
$\Omega_{k'/k}$ is a $k'$-vector space.

\begin{proposition} 
Let $k'/k$ be a separable algebraic extension of fields. Then $\Omega_{k'/k} = 0$.
\end{proposition} 
\begin{proof} 
We will need a formal property of K\"ahler differentials that is easy to check,
namely that they are compatible with filtered colimits. If $B = \varinjlim
B_\alpha$ for $A$-algebras $B_\alpha$, then there is a canonical isomorphism
\[ \Omega_{B/A} \simeq \varinjlim \Omega_{B_{\alpha}/A}.  \]
One can check this on generators and relations, for instance.

Given this, we can reduce to the case of $k'/k$ finite and separable. 
\begin{remark} 
Given a sequence of fields and morphisms $k \to k' \to k''$, then there is an
exact sequence
\[ \Omega_{k'/k} \otimes k'' \to \Omega_{k''/k} \to \Omega_{k''/k'} \to 0.  \]
In particular, if $\Omega_{k'/k} = \Omega_{k''/k'} =0 $, then $\Omega_{k''/k} =
0$. This is a kind of d\'evissage argument.
\end{remark} 

Anyway, recall that we have a finite separable extension $k'/k$ where $k' =
k(x_1, \dots, x_n)$.\footnote{We can take $n=1$ by the primitive element
theorem, but shall not need this.} We will show that
\[ \Omega_{k(x_1, \dots, x_i)/k(x_1, \dots, x_{i-1})} =0 \quad \forall i,  \]
which will imply by the devissage argument that $\Omega_{k'/k} = 0$.
In particular, we are reduced to showing the proposition when $k'$ is generated
over $k$ by a \emph{single element} $x$. Then we have that
\[ k' \simeq k[X]/(f(X))  \]
for $f(X)$ an irreducible polynomial. Set $I = (f(X))$. We have an exact sequence
\[ I/I^2 \to \Omega_{k[X]/k} \otimes_{k[X]} k' \to \Omega_{k'/k} \to 0 \]
The middle term is a copy of $k'$ and the first term is isomorphic to $k[X]/I
\simeq k'$. So there is an exact sequence
\[ k' \to k' \to \Omega_{k'/k} \to 0.  \]
The first term is, as we have computed, multiplication by $f'(x)$; however
this is nonzero by separability. Thus we find that $\Omega_{k'/k} =0$.
\end{proof} 
\end{example} 

\begin{remark} 
The above result is \textbf{not true} for inseparable extensions in general. 
\end{remark} 
\begin{example} 
Let $k$ be an imperfect field of characteristic $p>0$. There is $x \in k$ such
that $x^{1/p} \notin k$, by definition. Let $k' = k(x^{1/p})$. As a ring, this
looks like
$k[t]/(t^p - x)$. In writing the exact sequence, we find that $\Omega_{k'/k} =
k'$ as this is the cokernel of the map $k' \to k'$ given by multiplication
$\frac{d}{dt}|_{x^{1/p}} (t^p - x)$. That polynomial has identically vanishing
derivative, though. We find that a generator of $\Omega_{k'/k}$ is $dt$ where
$t$ is a $p$th root of $x$, and $\Omega_{k'/k } \simeq k$.
\end{example} 

Now let us consider transcendental extensions. Let $k' = k(x_1, \dots, x_n)$ be
a purely transcendental extension, i.e. the field of rational functions of
$x_1, \dots, x_n$.

\begin{proposition} 
If $k' = k(x_1, \dots, x_n)$, then $\Omega_{k'/k}$ is a free $k'$-module on the
generators $dx_i$.
\end{proposition} 
\begin{proof} 
We already know this for the polynomial ring $k[x_1, \dots, x_n]$. However, the
rational function field is just a localization of the polynomial ring at the
zero ideal.  So the result will follow from:
\end{proof} 

\begin{proposition} 
Let $f: A \to B$ be a map of rings. Let $S \subset  B$ be multiplicatively
closed. Then the natural map
\[ S^{-1}\Omega_{B/A} \to \Omega_{S^{-1}B/A}  \]
is an isomorphism.
\end{proposition} 
So the formation of K\"ahler differentials commutes with localization.

\begin{proof} 
We could prove this by the calculational definition, but perhaps it is better
to prove it via the universal property. If $M$ is any $S^{-1}B$-module, then 
we can look at 
\[ \hom_{S^{-1}B}( \Omega_{S^{-1}B/A}, M)  \]
which is given by the group of $A$-linear derivations $S^{-1}B \to M$, by the
universal property. 

On the other hand, 
\[ \hom_{S^{-1}B}( S^{-1} \Omega_{B/A}, M)  \]
is the same thing as the set of $B$-linear maps $\Omega_{B/A} \to M$, i.e. the
set of $A$-linear derivations $B \to M$. 

We want to show that these two are the same thing. Given an $A$-derivation
$S^{-1}B \to M$, we get an $A$-derivation $B \to M$ by pulling back. We want to
show that any $A$-linear derivation $B \to M$ arises in this way. So we need to
show that any $A$-linear derivation $d: B \to M$ extends uniquely to an $A$-linear
$\overline{d}: S^{-1}B \to M$.
Here are two proofs:
\begin{enumerate}
\item (Lowbrow proof.) For $x/s \in S^{-1}B$, with $x \in B, s \in S$, we
define $\overline{d}(x/s) = dx/s - xds/s^2$ as in calculus. The claim is that
this works, and is the only thing that works. One should check
this---\textbf{exercise}.
\item (Highbrow proof.) We start with a digression. Let $B$ be a commutative
ring, $M$ a $B$-module. Consider $B \oplus M$, which is a  $B$-module. We can
make it into a ring (via \textbf{square zero multiplication}) by multiplying
\[ (b,x)(b',x') = (bb', bx'+b'x).  \]
This is compatible with the $B$-module structure on $M \subset B \oplus
M$. Note that $M$ is an ideal in this ring with square zero.  Then the
projection $\pi: B \oplus M \to B$ is a ring-homomorphism as well.
There is also a ring-homomorphism in the other direction $b \to (b,0)$, which
is a section of $\pi$. There may be other homomorphisms $B \to B \oplus M$.

You might ask what all the right inverses to $\pi$ are, i.e. ring-homomorphisms
$\phi:  B \to B \oplus M $ such that $\pi \circ \phi = 1_{B}$. This must be of
the form $\phi: b \to (b, db)$ where $d: B \to M$ is some map. It is easy to check
that $\phi$ is a homomorphism precisely when $d$ is a derivation.

Suppose now $A \to B$ is a morphism of rings making $B$ an $A$-algebra. Then
$B \oplus M$ is an $A$-algebra via the inclusion $a \to (a, 0)$. Then
you might ask when $\phi: b \to (b, db), B \to B \oplus M$ is an
$A$-homomorphism. The answer is clear: when $d$ is an $A$-derivation.

Recall that we were in the situation of $f: A \to B$  a morphism of rings, $S
\subset B$ a multiplicatively closed subset, and $M$ an $S^{-1}B$-module. The
claim was that any $A$-linear derivation $d: B \to M$ extends uniquely to
$\overline{d}: S^{-1} B \to M$.
We can draw a diagram
\[ \xymatrix{
& B \oplus M \ar[d] \ar[r] &  S^{-1}B \oplus M \ar[d] \\
A \ar[r] &  B \ar[r] &  S^{-1}B
}.\]
This is a cartesian diagram. So given a section of $A$-algebras $B \to B \oplus M$, we have to
construct a section of $A$-algebras $S^{-1}B \to S^{-1}B \oplus M$. We can do this by the
universal property of localization, since $S$ acts by invertible elements on
$S^{-1}B \oplus M$. (To see this, note that $S$ acts by invertible elements on
$S^{-1}B$, and $M$ is a nilpotent ideal.)
\end{enumerate}
\end{proof} 
\lecture{11/15}

\subsection{Continuation of field theory}

We have been talking about the theory of regular local rings, and more recently
about K\"ahler differentials. Last time, we showed:

\begin{proposition} 
If $L/K$ is a separable algebraic field extension, then $\Omega_{L/K} = 0$.
\end{proposition} 

Furthermore:

\begin{proposition} 
If $L/K$ is a finitely generated purely transcendental extension $K(x_1, \dots, x_n)$, then 
\[ \Omega_{L/K} = L^n = \bigoplus L dx_i.  \]
More generally, this is true for an infinitely generated transcendental
extension. In this case, $\Omega_{L/K}$ is a free vector space on a
transcendence basis.
\end{proposition} 
The only thing we did not already prove is the infinite case, which follows as
K\"ahler differentials are compatible with filtered colimits.

We can deduce from this:
\begin{corollary} 
Let $L/K$ be a field extension of fields of char 0. Then 
\[ \dim_L \Omega_{L/K} = \mathrm{trdeg}(L/K).  \]
\end{corollary} 
\begin{proof}[Partial proof] 
Put the above two facts together. Choose a transcendence basis $\{x_\alpha\}$
for $L/K$. This means that $L$ is algebraic over $K(\left\{x_\alpha\right\})$
and the $\left\{x_\alpha\right\}$ are algebraically independent.
Moreover $L/K(\left\{x_\alpha\right\})$ is \emph{separable} algebraic.  Now let
us use a few things about these cotangent complexes. There is an exact sequence:
\[ \Omega_{K(\left\{x_\alpha\right\})}
\otimes_{K(\left\{x_\alpha\right\})} L \to \Omega_{L/K} \to \Omega_{L/K(\left\{x_\alpha\right\})}  \to 0 \]
The last thing is zero, and we know what the first thing is; it's free on the
$dx_\alpha$. So we find that $\Omega_{L/K}$ is generated by
the elements $dx_\alpha$. If we knew that the $dx_\alpha$ were linearly
independent, then we would be done. But we don't, yet. 
\end{proof}

This is \textbf{not true} in characteristic $p$. If $L = K(\alpha^{1/p})$ for
$\alpha \in K$ and $\alpha^{1/p} \notin K$, then $\Omega_{L/K} \neq 0$.

\subsection{Regularity, smoothness, and K\"ahler differentials}
From this, let us revisit a statement made last time. 
Let $K$ be an algebraically closed field, let $R = k[x_1, \dots, x_n]/I$ and
let $\mathfrak{m} \subset R$ be a maximal ideal. Recall that the
Nullstellensatz implies that $R/\mathfrak{m} \simeq k$. We were studying 
\[ \Omega_{R/k}.  \]
This is an $R$-module, so $\Omega_{R/k} \otimes_R k$ makes sense. There is a
surjection
\[ \mathfrak{m}/\mathfrak{m}^2 \to \Omega_{R/k} \otimes_R k \to 0,  \]
that sends $x \to dx$.
\begin{proposition} 
This map is an isomorphism.
\end{proposition} 
\begin{proof} 
We construct a map going the other way. Call the map $\mathfrak{m}/\mathfrak{m}^2 \to
\Omega_{R/k} \otimes_R k$ as $\phi$. We want to construct
\[ \psi: \Omega_{R/k} \otimes_R k \to \mathfrak{m}/\mathfrak{m}^2.  \]
This is equivalent to giving an $R$-module map 
\[ \Omega_{R/k} \to \mathfrak{m}/\mathfrak{m}^2,  \]
that is a derivation $\partial: R \to \mathfrak{m}/\mathfrak{m}^2$. This acts
via $\partial(\lambda + x) = x$ for $\lambda \in k, x \in \mathfrak{m}$. Since
$k+\mathfrak{m} = R$, this is indeed well-defined. We must check that
$\partial$ is a derivation. That is, we have to compute
$\partial((\lambda+x)(\lambda' + x'))$.
But this is 
\[ \partial(\lambda\lambda' + (\lambda x' + \lambda' x) + xx').  \]
The definition of $\partial$ is to ignore the constant term and look at the
nonconstant term mod $\mathfrak{m}^2$. So this becomes
\[ \lambda x' + \lambda' x = (\partial (\lambda+x)) (x'+\lambda') + (\partial (\lambda'+
x')) (x+\lambda)  \]
because $xx' \in \mathfrak{m}^2$, and because $\mathfrak{m}$ acts trivially on
$\mathfrak{m}/\mathfrak{m}^2$. Thus we get the map $\psi$ in the inverse
direction, and one checks that $\phi, \psi$ are inverses. This is because
$\phi$ sends $x \to dx$ and $\psi$ sends $dx \to x$.
\end{proof} 

\begin{corollary} 
Let $R$ be as before. Then $R_{\mathfrak{m}}$ is regular iff $\dim
R_{\mathfrak{m}} = \dim_k \Omega_{R/k} \otimes_R R/\mathfrak{m}$.
\end{corollary} 
In particular, the modules of K\"ahler differentials detect regularity for
certain rings.

\begin{definition} 
Let $R$ be a noetherian ring. We say that $R$ is \textbf{regular} if
$R_{\mathfrak{m}}$ is regular for every maximal ideal $\mathfrak{m}$. (This
actually implies that $R_{\mathfrak{p}}$ is regular for all primes
$\mathfrak{p}$, though we are not ready to see this. It will follow from the
fact that the localization of a regular local ring at a prime ideal is regular.)
\end{definition} 

Let $R = k[x_1, \dots, x_n]/I$ be an affine ring over an algebraically closed
field $k$. 
Then:

\begin{proposition} 
TFAE:
\begin{enumerate}
\item $R$ is regular. 
\item ``$R$ is smooth over $k$'' (to be defined)
\item  $\Omega_{R/k}$ is  a projective module over $R$ of rank $\dim R$.
\end{enumerate}
\end{proposition} 
A finitely generated projective module is locally free. So the last statement is that
$(\Omega_{R/k})_{\mathfrak{p}}$ is free of rank $\dim R$ for each prime
$\mathfrak{p}$.

\begin{remark} 
A projective module does not necessarily have a well-defined rank as an integer. For
instance, if $R = R_1 \times R_2$ and $M = R_1 \times 0$, then $M$ is a summand
of $R$, hence is projective. But there are two candidates for what the rank
should be. The problem is that $\spec R$ is disconnected into two pieces, and
$M$ is of rank one on one piece, and of rank zero on the other.
But in this case, it does not happen.
\end{remark}

\begin{remark} 
The smoothness condition states that locally on $\spec R$, we have an isomorphism with
$k[y_1, \dots, y_n]/(f_1, \dots, f_m)$ with the gradients $\nabla f_i$ linearly
independent. Equivalently, if $R_{\mathfrak{m}}$ is the localization of $R$ at
a maximal ideal  $\mathfrak{m}$, then $R_{\mathfrak{m}}$ is a regular local
ring, as we have seen.
\end{remark} 

\begin{proof} 
We have already seen that 1 and 2 are equivalent. The new thing is that they
are equivalent to 3. First, assume 1 (or 2). 
First, note that $\Omega_{R/k}$ is a finitely generated $R$-module; that's a general
observation:

\begin{proposition} 
If $f: A \to B$ is a map of rings that makes $B$ a finitely generated $A$-algebra, then
$\Omega_{B/A}$ is a finitely generated $B$-module.
\end{proposition} 
\begin{proof} 
We've seen this is true for polynomial rings, and we can use the exact
sequence. If $B$ is a quotient of a polynomial ring, then $\Omega_{B/A}$ is a
quotient of the K\"ahler differentials of the polynomial ring.
\end{proof} 
Return to the main proof. In particular, $\Omega_{R/k}$ is projective if and
only if $(\Omega_{R/k})_{\mathfrak{m}}$ is projective for every maximal ideal
$\mathfrak{m}$.  According to the second assertion, we have that
$R_{\mathfrak{m}}$ looks like $(k[y_1, \dots, y_n]/(f_1, \dots,
f_m))_{\mathfrak{n}}$ for some maximal ideal $\mathfrak{n}$, with the
gradients $\nabla f_i$ linearly independent. Thus
$(\Omega_{R/k})_{\mathfrak{m}} = \Omega_{R_{\mathfrak{m}}/k}$ looks like the cokernel of 
\[ R_{\mathfrak{m}}^m \to R_{\mathfrak{m}}^n  \]
where the map is multiplication by the Jacobian matrix $\left(\frac{\partial
f_i}{\partial y_j}  \right)$. By assumption this matrix has full rank. We see
that there is a left inverse of the reduced  map $k^m \to k^n$. 
We can lift this to a map $R_{\mathfrak{m}}^n \to R_{\mathfrak{m}}^m$. Since
this is a left inverse mod $\mathfrak{m}$, the composite is at least an
isomorphism (looking at determinants). Anyway, we see that $\Omega_{R/k}$ is
given by the cokernel of a map of free module that splits, hence is projective.
The rank is $n-m = \dim R_{\mathfrak{m}}$.

Finally, let us prove that 3 implies 1. Suppose $\Omega_{R/k}$ is projective of
rank $\dim R$. So this means that $\Omega_{R_{\mathfrak{m}}/k}$ is free of
dimension $\dim R_{\mathfrak{m}}$. But this implies that $(\Omega_{R/k})
\otimes_R R/\mathfrak{m}$ is free of the appropriate rank, and that is---as we
have seen already---the embedding dimension $\mathfrak{m}/\mathfrak{m}^2$. So
if 3 holds, the embedding dimension equals the usual dimension, and we get
regularity.
\end{proof} 

\begin{corollary} 
Let $R = \mathbb{C}[x_1, \dots, x_n]/\mathfrak{p}$ for $\mathfrak{p}$ a prime.
Then there is a nonzero $f \in R$ such that $R[f^{-1}]$ is regular.
\end{corollary} 
Geometrically, this says the following. $\spec R$ is some algebraic variety,
and $\spec R[f^{-1}]$ is a Zariski open subset. What we are saying is that, in
characteristic zero, any algebraic variety has a nonempty open smooth locus.
The singular locus is always smaller than the entire variety.

\begin{proof} 
$\Omega_{R/\mathbb{C}}$ is a finitely generated $R$-module. Let $K(R) $ be the fraction field of $R$.
Now
\[ \Omega_{R/\mathbb{C}} \otimes_R K(R) = \Omega_{K(R)/\mathbb{C}}  \]
is a finite $K(R)$-vector space. The dimension is
$\mathrm{trdeg}(K(R)/\mathbb{C})$. That is also $d=\dim R$, as we have seen.
Choose elements $x_1, \dots, x_d \in \Omega_{R/\mathbb{C}}$ which form a basis
for $\Omega_{K(R)/\mathbb{C}}$. There is a map
\[ R^d \to \Omega_{R/\mathbb{C}}  \]
which is an isomorphism after localization at $(0)$. This implies that there is
$f \in R$ such that the map is an isomorphism after localization at
$f$.\footnote{There is an inverse defined over the fraction field, so it is
defined over some localization.} We find that $\Omega_{R[f^{-1}]/\mathbb{C}}$
is free of rank $d$ for some $f$, which is what we wanted.
\end{proof} 

This argument works over any algebraically closed field of characteristic
zero, or really any field of characteristic zero.
\begin{remark}[Warning] Over imperfect fields in characteristic $p$, two things can happen:
\begin{enumerate}
\item Varieties need not be generically smooth 
\item $\Omega_{R/k}$ can be projective with the wrong rank
\end{enumerate}
(Nothing goes wrong for \textbf{algebraically closed fields} of characteristic
$p$.)
\begin{example} 
Here is a dumb example. Say $R = k[y]/(y^p-x)$ where $x \in K$ has no $p$th
root. We know that $\Omega_{R/k}$ is free of rank one. However, the rank is
wrong: the variety has dimension zero.
\end{example} 
\end{remark} 
\lecture{11/17}

Last time, were trying to show that $\Omega_{L/K}$ is free on a transcendence
basis if $L/K$ is an extension in characteristic zero. So we had a tower of fields
\[ K \to K' \to L,  \]
where $L/K'$ was separable algebraic. 
We claim in this case that
\[ \Omega_{L/K} \simeq \Omega_{K'/K} \otimes_{K'} L.  \]
This will prove the result. But we had not done this yesterday.
\begin{proof} 
This doesn't follow directly from the previous calculations. Wlog, $L$ is
finite over $K'$, and in particular, $L = K'[x]/(f(x))$ for $f$ separable. The claim is that
\[ \Omega_{L/K} \simeq (\Omega_{K'/K}\otimes_{K'}L \oplus K' dx)/f'(x)dx + \dots  \]
When we kill the vector $f'(x) dx + \dots$, we kill the second component. 
\end{proof} 


\subsection{Basic definitions in homological algebra}

We don't have time to do all the homological algebra we need to prove results
such as the homological criterion for regularity. 

\begin{definition} 
Let $R$ be a commutative ring, $M$ an $R$-module. A \textbf{projective resolution} of
$M$ is an exact sequence of $R$-modules
\[ \dots \to P_1 \to  P_0 \to M \to 0  \]
where all the $P_i$ are projective modules.
\end{definition} 


\begin{proposition} 
These always exist.
\end{proposition} 
\begin{proof} 
If you start with $M$, choose a surjection $P_0 \twoheadrightarrow M$ for some
$P_0$ projective. E.g., $P$ free on the elements of $M$. Choose a surjection
from some projective $P_1$ onto the kernel of $P_0 \to M$. Then there is an
exact sequence
\[ P_1 \to P_0 \to M \to 0,  \]
and we can iterate this procedure to get a projective resolution.
\end{proof} 

Here is a useful observation:
\begin{proposition} 
If $R$ is noetherian, and $M$ is finitely generated, then we can choose a
projective resolution where each $P_i$ is finitely generated. 
\end{proposition} 
\begin{proof} 
To say that $M$ is finitely generated is to say that it is a quotient of a free module on
finitely many generators, so we can take $P_0$ free. The kernel of $P_0 \to M$
is finitely generated by noetherianness, and we can proceed as before, at each step
choosing a finitely generated object. 
\end{proof} 


\newcommand{\ext}{\mathrm{Ext}}
\subsection{$\ext$ functors}

Let $M, M'$ be $R$-modules. Choose a projective resolution 
\[ \dots \to P_2 \to P_1 \to P_0 \to M \to 0  \]
and consider what happens when you hom this resolution into $M$. Namely, we can
consider $\hom_R(M,N)$, which is the kernel of $\hom(P_0, M) \to \hom(P_1, M) $
by exactness of the sequence
\[ 0 \to \hom_R(M,N) \to \hom_R(P_0, N) \to \hom_R(P_1, N) . \]
You might try to continue this with the sequence
\[ 0 \to \hom_R(M,N) \to \hom_R(P_0, N) \to \hom_R(P_1, N) \to \hom_R(P_2, N)
\to \dots. \]
In general, it won't be exact, because $\hom_R$ is only left-exact. But it is a
chain complex. You can thus consider the homologies.

\begin{definition} 
The homology of the complex $\{\hom_R(P_i, N)\}$ is denoted $\ext^i_R(M,N)$. By
definition, this is $\ker(\hom(P_i,N) \to \hom(P_{i+1}, N))/\im(\hom(P_{i-1},
N) \to \hom(P_i,N))$. This is an $R$-module, and is called the $i$th ext group.
\end{definition} 



Let us list some properties:

\begin{proposition} 
$\ext_R^0(M,N) = \hom_R(M,N)$. 
\end{proposition} 
\begin{proof} 
This is obvious from the left-exactness of $\hom(-,N)$. (We discussed this.)
\end{proof} 

\begin{proposition} 
$\ext^i(M,N)$ is a functor of $N$.
\end{proposition} 
\begin{proof} 
Obvious from the definition.
\end{proof} 

Here is a harder statement.
\begin{proposition} 
$\ext^i(M,N)$ is well-defined, independent of the projective resolution $P_*
\to M$, and is in fact a contravariant additive functor of $M$.\footnote{I.e. a map $M
\to M'$ induces $\ext^i(M', N) \to \ext^i(M,N)$.}
\end{proposition} 
\begin{proof} 
Omitted. We won't really need this, though; it requires more theory about
chain complexes.
\end{proof} 


\begin{proposition} 
If $M$ is annihilated by some ideal $I \subset R$, then so is $\ext^i(M,N)$ for
each $i$.
\end{proposition} 
\begin{proof} 
This is a consequence of the functoriality in $M$. If $x \in I$, then $x: M \to
M$ is the zero map, so it induces the zero map on $\ext^i(M,N)$.
\end{proof} 

\begin{proposition} 
$\ext^i(M,N) = 0$ if $M$ projective and $i>0$.
\end{proposition} 
\begin{proof} 
In that case, one can use the projective resolution
\[ 0 \to M \to M \to 0.  \]
Computing $\ext$ via this gives the result.
\end{proof} 




\begin{proposition} 
If there is an exact sequence
\[ 0 \to N' \to N \to N'' \to 0,  \]
there is a long exact sequence of $\ext$ groups
\[ 0 \to \hom(M,N') \to \hom(M,N) \to \hom(M,N'') \to \ext^1(M,N') \to
\ext^1(M,N) \to \dots  \]
\end{proposition} 
\begin{proof} 
This proof will assume a little homological algebra. Choose a projective
resolution $P_* \to M$. (The notation $P_*$ means the chain complex $\dots \to
P_2 \to P_1 \to P_0$.) In general, homming out of $M$ is not exact, but homming
out of a projective module is exact. For each $i$, we get an exact sequence
\[ 0 \to \hom_R(P_i, N') \to \hom_R(P_i, N) \to \hom_R(P_i, N'') \to 0,  \]
which leads to an exact sequence of \emph{chain complexes}
\[ 0 \to \hom_R(P_*,N') \to   \hom_R(P_*,N) \to \hom_R(P_*,N'') \to 0 . \]
Taking the long exact sequence in homology gives the result.
\end{proof} 


Much less obvious is:

\begin{proposition} 
There is a long exact sequence in the $M$ variable. That is, a short exact
sequence
\[ 0 \to M' \to M \to M'' \to 0  \]
leads a long exact sequence
\[ 0 \to \hom_R(M'', N) \to \hom_R(M,N) \to \hom_R(M', N) \to \ext^1(M'', N)
\to \ext^1(M, N) \to \dots.  \]
\end{proposition} 
\begin{proof} 
Omitted.
\end{proof} 

We now can characterize projectivity:
\begin{corollary} 
TFAE:
\begin{enumerate}
\item $M$ is projective. 
\item $\ext^i(M,N) = 0$ for all $R$-modules $N$ and $i>0$.
\item  $\ext^1(M,N)=0$ for all $N$.
\end{enumerate}
\end{corollary} 
\begin{proof} 
We have seen that 1 implies 2 because projective modules have simple projective
resolutions. 2 obviously implies 3. Let's show that 3 implies 1. Choose a
projective module $P$ and a surjection $P \twoheadrightarrow M$ with kernel
$K$. There is a short exact sequence $0 \to K \to P \to M \to 0$. The sequence
\[ 0 \to \hom(M,K) \to \hom(P,K) \to \hom(K,K) \to \ext^1(M,K)=0  \]
shows that there is a map $P \to K$ which restricts to the identity $K \to K$.
The sequence $0 \to K \to P \to M \to 0$ thus splits, so $M$ is a direct
summand in a projective module, so is projective.
\end{proof} 

\subsection{Injective modules}

Finally, we note that there is another way of constructing $\ext$. We
constructed them by choosing a projective resolution of $M$. But you can also
do this by resolving $N$ by \emph{injective} modules. 
\begin{definition} 
An $R$-module $Q$ is \textbf{injective} if $\hom_R(-,Q)$ is an exact (or,
equivalently, right-exact) functor. That is, if $M_0 \subset M$ is an inclusion
of $R$-modules, then any map $M_0 \to Q$ can be extended to $M \to Q$.
\end{definition} 


\begin{example} 
An abelian group is injective iff it is divisible. That is, $Q$ is injective
iff $n: Q \to Q$ is surjective for each $n \in \mathbb{Z} - \left\{0\right\}$.
In particular, $\mathbb{Q}$ and $\mathbb{Q}/\mathbb{Z}$ are injective.
\end{example} 

An important fact is that:

\begin{proposition} 
If $N$ is an $R$-module, there is an injection
\[ 0 \to N \to Q,  \]
where $Q$ is injective.
\end{proposition} 
This is harder to see than the statement for projective modules. It is
generally hard to give examples of injective modules.
\begin{proof}[Idea of proof] If $N$ is injective, then we're done.

If not, there is an injection $M \hookrightarrow M_0$ and a map $f_0: M_0 \to N$
that does not extend to $M$. Let $N' = N \oplus_{M_0} M$ be the push-out, i.e.
$(N \oplus M)/M_0$ where the map $M_0 \to N \oplus M$ is by $f_0$ and the
inclusion. By construction, we have an inclusion $N \to N'$, and from the
push-out construction, the map $M_0 \to N$ extends to $M \to N'$. 

The point is that $N'$ ``looks more injective'' than $N$. Repeat this
construction \emph{many, many} times. Namely, if $N'$ is injective, you're
done; if not, there's some piece of evidence $N'$ is not injective, and that
piece of evidence lets you extend $N'$. The claim is that if you do it
carefully, you eventually end up at an injective module. 

\end{proof} 


\begin{corollary} 
Injective resolutions of any $N$ exist. For any $N$, there is an exact sequence
\[ 0 \to N \to Q^0 \to Q^1 \to \dots  \]
where all the $Q_i$ are injective.
\end{corollary} 

If we are given $M,N$, and an injective resolution $N \to Q_*$, we can look at
the chain complex $\left\{\hom(M,Q_i)\right\}$, i.e. the chain complex
\[ 0 \to \hom(M, Q^0) \to \hom(M, Q^1) \to \dots  \]
and we can consider the cohomologies.

\begin{definition} 
We call these cohomologies
\[ \ext^i_R(M,N)'  = \ker(\hom(M, Q^i) \to \hom(M, Q^{i+1}))/\im(\hom(M,
Q^{i-1}) \to \hom(M, Q^i)).  \]
\end{definition} 

This is dual to the previous definitions, and it is easy to check that the
properties that we couldn't verify for the previous $\ext$s are true for the
$\ext'$'s. 

Nonetheless:

\begin{theorem} 
There are canonical isomorphisms:
\[ \ext^i(M,N)' \simeq \ext^i(M,N).  \]
\end{theorem} 

In particular, to compute $\ext$ groups, you are free either to take a
projective resolution of $M$, or an injective resolution of $N$. 

\begin{proof}[Idea of proof]
In general, it might be a good idea to construct a third more complex
construction that resembles both. Given $M,N$ construct a projective resolution
$P_* \to M$ and an injective resolution $N \to Q^*$. Having made these choices,
we get a \emph{double complex}
\[ \hom_R(P_i, Q^j)  \]
of a whole lot of $R$-modules. The claim is that in such a situation, where
you have a double complex $C_{ij}$, you can
form an ordinary chain complex $C'$
by adding along the diagonals. Namely, the $n$th term 
is $C'_n = \bigoplus_{i+j=n} C_{ij}$. This \emph{total complex} will receive a
map from the chain complex used to compute the $\ext$ groups and a chain
complex used to compute the $\ext'$ groups. There are maps on cohomology,
\[ \ext^i(M,N) \to H^i(C'_*), \quad \ext^i(M,N)' \to H^i(C'_*).  \]
The claim is that isomorphisms on
cohomology will be induced in each case. That will prove the result, but we
shall not prove the claim.
\end{proof} 
\lecture{11/19}

Last time we were talking about $\ext$ groups over commutative rings. For $R$ a
commutative ring and $M,N$ $R$-modules, we defined an $R$-module $\ext^i(M,N)$ for
each $i$, and proved various properties. We forgot to mention one.

\begin{proposition} 
If $R$ noetherian, and $M,N$ are finitely generated, $\ext^i(M,N)$ is also finitely generated
\end{proposition} 
\begin{proof} 
We can take a projective resolution $P_*$ of $M$ by finitely generated free modules, $R$ being
noetherian. Consequently the complex $\hom(P_*, N)$ consists of finitely
generated modules. Thus the cohomology is finitely generated, and this cohomology
consists of the $\ext$ groups.
\end{proof} 


\subsection{Depth} Let $(R, \mathfrak{m})$ be  a noetherian
local ring. Let $k = R/\mathfrak{m}$. 

Let $M \neq 0$ be a finitely generated $R$-module. 

\newcommand{\depth}{\mathrm{depth}}
\begin{definition} 
The \textbf{depth} of $M$ is equal to the smallest integer $i$ such that
$\ext^i(k,M) \neq 0$.
\end{definition} 

We'll give another characterization of this in just a minute. Note that
contained in this definition is an assertion: that there is such an $i$.

\begin{example} 
Depth zero is equivalent to saying that $\ext^0(k,M) \neq 0$, i.e. there is a
nontrivial morphism
\[ k \to M.  \]
As $k = R/\mathfrak{m}$, the existence of such a map is equivalent to the existence of a nonzero $x$
such that $\ann(x) = \mathfrak{m}$, i.e. $\mathfrak{m} \in \ass(M)$. So depth
zero is equivalent to having $\mathfrak{m} \in \ass(M)$.
\end{example} 

Suppose now that $\depth(M) \neq 0$. In particular, $\mathfrak{m} \notin
\ass(M)$. Since $\ass(M)$ is finite, prime avoidance that $\mathfrak{m}
\not\subset \bigcup_{\mathfrak{p} \in \ass(M)} \mathfrak{p}$. Thus
$\mathfrak{m}$ contains an element which is a nonzerodivisor on $M$.  So we find:

\begin{proposition} 
$M$ has depth zero iff every element in $\mathfrak{m}$ is a zerodivisor on $M$.
\end{proposition} 

Now suppose $\depth M \neq 0$. There is $a \in \mathfrak{m}$ which is a
nonzerodivisor on $M$, i.e.  such that there is
an exact sequence
\[ 0 \to M \stackrel{a}{\to} M \to M/aM \to 0.  \]
There is a long exact sequence in $\ext$ groups:
\[\ext^{i-1}(k,M) \to \ext^i(k,M) \stackrel{a}{\to} \ext^i(k,M) \to \ext^i(k,
M/aM) \to \ext^{i+1}(k,M)  .\]
However, the map $a: \ext^i(k,M) \to \ext^i(k,M)$ as multiplication by $a$
kills $k$. (As we said last time, if $a$ kills a module $N$, then it kills
$\ext^*(N,M)$ for all $M$.) We see from this that
\[ \ext^i(k,M) \hookrightarrow \ext^i(k,M/aM)  \]
is injective, and 
\[ \ext^{i-1}(k, M/aM) \twoheadrightarrow \ext^i(k,M)  \]
is surjective.

\begin{corollary} 
If $a \in \mathfrak{m}$ is a nonzerodivisor on $M$, then 
\[ \depth(M/aM) = \depth M -1.  \]
\end{corollary} 
\begin{proof} 
When $\depth M = \infty$, this is easy (left to the reader) from the exact
sequence. Suppose $\depth(M) = n$. We would like to see that $\depth M/aM =
n-1$. That is, we want to see that $\ext^{n-1}(k,M/aM) \neq 0$, but
$\ext^i(k,M/aM) =
0$ for $i < n-1$. This is direct from the injectivity and surjectivity above. 

In fact surjectivity of $\ext^{n-1}(k,M/aM) \to \ext^n(k,M)$ shows that
$\ext^{n-1}(k,M/aM) \neq 0$. Now let $i < n-1$. Then the exact sequence
\[ \ext^i(k,M) \to \ext^i(k,M/aM) \to \ext^{i+1}(k,M)  \]
shows that $\ext^i(k, M/aM)$.
\end{proof} 

When you mod out by a nonzerodivisor, the depth drops by one.

\begin{corollary} 
The depth of $M$ is well-defined. In fact, 
\[ \depth M \leq \dim \supp M.  \]
\end{corollary} 
\begin{proof} 
If $\depth M = 0$, then we're done.

In general, we induct on $\dim \supp M$, which we know is finite. Otherwise,
there is $ a \in \mathfrak{m}$ which is a nonzerodivisor on $M$. We know that
\[ \depth M/aM = \depth M -1  \]
and
\[ \dim \supp M/aM = \dim \supp M -1.  \]
By induction, we have that $\depth M/aM \leq \dim \supp M/aM$. From this the
induction step is clear.
\end{proof} 

Generally, the depth is not the dimension.
\begin{example} 
Given any $M$, if you add $k$ to it, then you make the depth zero: $M \oplus k$
has $\mathfrak{m}$ as an associated prime. But the dimension generally does not
jump to zero.
\end{example}

In fact, we have described a recursive algorithm for computing $\depth(M)$.
\begin{enumerate}
\item If $\mathfrak{m}  \in \ass(M)$, output zero.
\item If $\mathfrak{m} \notin \ass(M)$, choose an element $a \in \mathfrak{m}$
which is a nonzerodivisor on $M$. Output $\depth(M/aM) +1$.
\end{enumerate}


If you were to apply this in practice, you would start by looking for a
nonzerodivisor $a_1 \in \mathfrak{m}$ on $M$, then looking for one on $M/a_1
M$, etc.
From this we make:

\begin{definition} 
Let $(R, \mathfrak{m})$ be a local noetherian ring, $M$ a finite $R$-module. A
sequence $a_1, \dots, a_n \in \mathfrak{m}$ is said to be \textbf{$M$-regular} iff:
\begin{enumerate}
\item $a_1$ is a nonzerodivisor on $M$ 
\item $a_2$ is a nonzerodivisor on $M/a_1 M$
\item  $\dots$
\item  $a_i$ is a nonzerodivisor on $M/(a_1, \dots, a_{i-1})M$ for all $i$.
\end{enumerate}
A regular sequence $a_1, \dots, a_n$ is \textbf{maximal } if it can be extended
no further, i.e. there is no $a_{n+1}$ such that $a_1, \dots, a_{n+1}$ is
$M$-regular.
\end{definition} 

\begin{corollary} 
$\depth(M)$ is the length of every maximal $M$-regular sequence. In particular,
all $M$-regular sequences have the same length. 
\end{corollary} 

\begin{proof} 
If $a_1, \dots, a_n$ is $M$-regular, then
\[ \depth M/(a_1, \dots, a_i)M = \depth M -i  \]
for each $i$, by an easy induction on $i$ and the definition. Finally, if the sequence is maximal,
then $\mathfrak{m} \in \ass(M/(a_1, \dots, a_n)M)$ so $\depth M/(a_1, \dots,
a_n) M = 0$.
\end{proof} 

\begin{remark} 
We could define the depth via the length of a maximal $M$-regular sequence. 
\end{remark} 


\subsection{Cohen-Macaulayness}

\begin{definition} 
Let $(R, \mathfrak{m})$ be a noetherian local ring. Then 
we set $\depth R$ to be the its depth as an $R$-module.
\end{definition} 




\begin{example} 
If $R$ is regular, then $\depth R = \dim R$.
\end{example} 
\begin{proof} 
Induction on $\dim R$. If $\dim R=0$, then this is obvious by the inequality
$\leq $ which is always true.

Suppose $\dim R = 0$. Then $\mathfrak{m} \neq 0$ and in particular
$\mathfrak{m}/\mathfrak{m}^2 \neq 0$. Choose $x \in \mathfrak{m} -
\mathfrak{m}^2$. Let $R'=R/(x)$. We know that $\dim R' = \dim R-1$ as $x$ is a
nonzerodivisor (by regularity). On the other hand, the embedding dimension of $R'$ also drops
by one, as we have divided out by something in $\mathfrak{m} - \mathfrak{m}^2$.
In particular, $R'$ is regular local too. So the inductive hypothesis states
that
\[\depth R-1 =  \depth R' = \dim R' = \dim R -1.   \]

Differently phrased, we could choose $x_1, \dots, x_n \in
\mathfrak{m}$ which forms a basis for $\mathfrak{m}/\mathfrak{m}^2$; this is a
\emph{regular sequence} (that is, an $R$-regular sequence) by this argument. It
is maximal as $x_1, \dots, x_n$ generate $\mathfrak{m}$ and $R/(x_1, \dots,
x_n)$ clearly has depth zero.
\end{proof} 

More generally:
\begin{definition} 
A noetherian local ring $(R, \mathfrak{m})$ is called \textbf{Cohen-Macaulay}
if $\dim R = \depth R$. A general noetherian ring $R$ is \textbf{Cohen-Macaulay} if
$R_{\mathfrak{p}}$ is Cohen-Macaulay for all $\mathfrak{p} \in \spec R$.
\end{definition} 
For instance, any regular local ring is Cohen-Macaulay, as is any local
artinian ring (because the dimension is zero for an artinian ring).

We shall eventually prove:

\begin{proposition} 
Let $R = \mathbb{C}[X_1, \dots, X_n]/\mathfrak{p}$ for $\mathfrak{p}$ prime.
Choose an injective map $\mathbb{C}[y_1, \dots, y_n] \hookrightarrow R$ making $R$ a
finite module. Then $R$ is Cohen-Macaulay iff $R$ is projective as a module
over $\mathbb{C}[y_1, \dots, y_n]$.\footnote{In fact, this is equivalent to
freeness, although we will not prove it. Any projective finite module over a
polynomial ring over a field is free, though this is a hard theorem.}
\end{proposition} 

The picture is that the inclusion $\mathbb{C}[y_1, \dots, y_m ] \hookrightarrow
\mathbb{C}[x_1, \dots, x_n]/\mathfrak{p}$ corresponds to a map 
\[ X \to \mathbb{C}^m  \]
for $X = V(\mathfrak{p}) \subset \mathbb{C}^n$. This statement of freeness is a
statement about how the fibers of this finite map stay similar in some sense.

\begin{example} 
Consider $\mathbb{C}[x,y]/(xy)$, the coordinate ring of the union of two axes
intersecting at the origin. This is Cohen-Macaulay (but not regular, as it
is not a domain). Indeed, we can project the associated variety $X = V(xy)$
onto the affine line by adding the coordinates. This corresponds to the map
\[ \mathbb{C}[z] \to \mathbb{C}[x,y]/(xy)  \]
sending $z \to x+y$. This makes $\mathbb{C}[x,y]/(xy)$ into a free
$\mathbb{C}[z]$-module of rank two (with generators $1, x$), as one can check.
So by the previous result (strictly speaking, its extension to non-domains),
the ring in question is Cohen-Macaulay.
\end{example} 

\begin{example} 
$R=\mathbb{C}[x,y,z]/(xy, xz)$ is not Cohen-Macaulay (at the origin). The associated variety looks
geometrically like the union of the plane $x=0$ and the line $y=z=0$ in affine
3-space. Here there are two components of different dimensions intersecting. 
Let's choose a regular sequence (that is, regular after localization at the
origin). The dimension at the origin is clearly two because of the plane.
First, we need a nonzerodivisor in this ring, which vanishes at the origin, say
$ x+y+z$. (\textbf{Exercise:} Check this.) When we quotient by this, we get
\[ S=\mathbb{C}[x,y,z]/(xy,xz, x+y+z)  = \mathbb{C}[y,z]/( (y+z)y, (y+z)z).  \]

The claim is that $S$ localized at the ideal corresponding to $(0,0)$ has depth
zero. We have $y+z \neq 0$, which is killed by both $y,z$, and hence by the
maximal ideal at zero. In particular the maximal ideal at zero is an associated
prime, which implies the claim about the depth.
\end{example} 

As it happens, a Cohen-Macaulay variety is always equidimensional. The rough
reason is that each irreducible piece puts an upper bound on the depth given by
the dimension of the piece. If any piece is too small, the total depth will be
too small. 

Anyway, we shall not say much more about Cohen-Macaulayness, but instead focus
on understanding regular local rings. We want, for next time, to understand the relationship
between depth and lengths of projective resolutions.
We will prove:

\begin{theorem}[Auslander-Buchsbaum formula] Let  $(R, \mathfrak{m})$ be a
noetherian local ring and $M$ a finite $R$-module. Suppose $M$ has a finite
projective resolution of length $d$, where $d$ is minimal. 

Then
\[ d = \depth(R) - \depth(M).  \]
\end{theorem} 
So in a sense, depth measures how far $M$ is from being a free module. If the
depth is large, then you need a lot of projective modules to resolve $M$. 
\lecture{11/22}

Last time we were talking about depth. Let's use this to reformulate a few
definitions made earlier. 

\subsection{Reduced rings}
Recall that a noetherian ring is \textbf{reduced} iff:
\begin{enumerate}
\item For any minimal prime $\mathfrak{p}  \subset R$, $R_{\mathfrak{p}}$ is a
field.
\item Every associated prime of $R$ is minimal.
\end{enumerate}

Condition 1 can be reduced as follows. To say that $\mathfrak{p} \subset R$ is
minimal is to say that it is zero-dimensional, and that is regular iff it is a
field. So the first condition is that \emph{for every height zero prime,
$R_{\mathfrak{p}}$ is regular.}  For the second condition, $\mathfrak{p} \in
\ass(R)$ iff $\mathfrak{p} \in \ass(R_{\mathfrak{p}})$, which is equivalent to
$\depth R_{\mathfrak{p}} = 0$. 

Namely, the two conditions are:
\begin{enumerate}
\item For every height zero prime $\mathfrak{p} $, $R_{\mathfrak{p}}$ is
regular.
\item For every prime $\mathfrak{p}$ of height $>0$, $\depth R_{\mathfrak{p}} >
0$.
\end{enumerate}

Condition two is always satisfied in a Cohen-Macaulay ring. 

\subsection{Serre's criterion again}

Recall that
\begin{definition} 
A noetherian ring is \textbf{normal} iff it is a finite direct product of
integrally closed domains.
\end{definition} 

In the homework, we showed:
\begin{proposition} 
A reduced ring $R$ is normal iff 
\begin{enumerate}
\item For every height one prime $\mathfrak{p}  \in \spec R$,
$R_{\mathfrak{p}}$ is a DVR (i.e. regular).
\item For every nonzerodivisor $x \in R$, every associated prime of $R/x$ is
minimal.
\end{enumerate}
\end{proposition} 
(We had proved this for \emph{domains} earlier.)
These conditions are equivalent to:
\begin{enumerate}
\item For every prime $\mathfrak{p}$ of height $\leq 1$, $R_{\mathfrak{p}} $ is regular.
\item For every prime $\mathfrak{p}$ of height $\geq 1$, $\depth
R_{\mathfrak{p}} \geq 1$ (necessary for reducedness)
\item  $\depth R_{\mathfrak{p}} \geq 2$ for $\mathfrak{p}$ not minimal over any
principal ideal $(x)$ for $x$ a nonzerodivisor. Condition three is the last
condition of the proposition as quotienting out by $x$ drops the depth by one.
\end{enumerate}

The first and third conditions imply the second. In particular, we find:

\begin{theorem}[Serre's criterion] A noetherian ring is normal iff:
\begin{enumerate}
\item For every prime $\mathfrak{p}$ of height $\leq 1$, $R_{\mathfrak{p}} $ is regular.
\item  $\depth R_{\mathfrak{p}} \geq 2$ for $\mathfrak{p}$ not minimal over any
principal ideal $(x)$ for $x$ a nonzerodivisor. \end{enumerate}
\end{theorem} 
For a Cohen-Macaulay ring, the last condition is automatic, as the depth is the
codimension.

\subsection{Projective dimension}

\newcommand{\pr}{\mathrm{pd}}
Let $R$ be a commutative ring, $M$ an $R$-module. 

\begin{definition} 
The \textbf{projective dimension} of $M$ is the largest integer $n$ such that
there exists  a module $N$ with
\[ \ext^n(M,N) \neq 0.  \]
(If no such $n,N$ exist, then we say that the projective dimension is $\infty$.)
We write $\pr(M)$ for the projective dimension.
\end{definition} 

\begin{remark} 
$\pr(M) = 0$ iff $M$ is projective. Indeed, we have seen that the $\ext$ groups
$\ext^i(M,N), i >0$
vanish always.
\end{remark} 

If you wanted to compute the projective dimension, you could go as follows.
Take any $M$. Choose a surjection $P \twoheadrightarrow M$ with $P$ projective;
call the kernel $K$ and draw a short exact sequence
\[ 0 \to K \to P \to M \to 0.  \]
For any $R$-module $N$, we have a long exact sequence
\[ \ext^{i-1}(P,N) \to \ext^{i-1}(K,N) \to \ext^i(M,N) \to \ext^i(P, N).   \]
If $i >0$, the right end vanishes; if $i >1$, the left end vanishes. So if $i
>1$, this map $\ext^{i-1}(K,N) \to \ext^i(M,N)$ is an \emph{isomorphism}.

Suppose that $\pr(K) = d \geq 0$. We find that $\ext^{i-1}(K,N)=0$ for $i-1
> d$.  
This implies that $\ext^i(M,N) = 0$ for such $i > d+1$. In particular, $\pr(M)
\leq d+1$.
This argument is completely reversible if $d >0$.
Then we see from these isomorphisms that
\[ \boxed{\pr(M) = \pr(K)+1}, \quad \mathrm{unless} \ \pr(M)=0  \]
If $M$ is projective, the sequence $0 \to K \to P \to M \to 0$ splits, and
$\pr(K)=0$ too.

The upshot is that \textbf{we can compute projective dimension by choosing a
projective resolution.}
\begin{proposition} 
Let $M$ be an $R$-module. Then $\pr(M) \leq n$ iff there exists a finite
projective resolution of $M$ having $n+1$ terms, 
\[ 0 \to P_n \to \dots \to P_1 \to P_0 \to M \to 0.  \]
\end{proposition} 
\begin{proof} 
Induction on $n$. When $n = 0$, $M$ is projective, and we can use the
resolution $0 \to M \to M \to 0$.

Suppose $\pr(M) \leq n$, where $n >0$. We can get a short exact sequence
\[ 0 \to K \to P_0 \to M \to 0  \]
with $P_0$ projective, so $\pr(K) \leq n-1$. The inductive hypothesis implies
that there is a projective resolution of $K$ of length $\leq n-1$. We can
splice this in with the short exact sequence to get a projective resolution of
$M$ of length $n$.

The argument is reversible. Choose any projective resolution
\[  0 \to P_n \to \dots \to P_1 \to P_0 \to M \to 0 \]
and split into short exact sequences, and argue inductively.
\end{proof} 


Let $\pr(M) = n$. Choose any projective resolution $\dots \to P_2 \to P_1 \to
P_0 \to M$. Choose $K_i = \ker(P_i \to P_{i-1})$ for each $i$. 
Then there is a short exact sequence $0 \to K_0 \to P_0 \to M \to 0$. Moreover,
there are exact sequences
\[ 0 \to K_i \to P_i \to K_{i-1} \to 0  \]
for each $i$. From these, we see that the projective dimensions of the $K_i$
drop by one as $i$ increments. So $K_{n-1}$ is projective if $\pr(M) = n$ as
$\pr(K_{n-1})=0$. In particular, we can get a projective resolution
\[ 0 \to K_{n-1} \to P_{n-1} \to \dots \to P_0 \to M \to 0  \]
which is of length $n$. 
In particular, if you ever start trying to write a projective resolution of
$M$, you can stop after going out $n$ terms, because the kernels will become
projective.


\subsection{Minimal projective resolutions}
Usually projective resolutions are non-unique. But sometimes they kind of are.
Let $(R, \mathfrak{m})$ be a local noetherian ring, $M$ a finitely generated $R$-module. 

\begin{definition} 
A projective resolution $P_* \to M$ of finitely generated modules is \textbf{minimal} if for each $i$, the
induced map $P_i \otimes R/\mathfrak{m} \to P_{i-1} \otimes R/\mathfrak{m}$ is
zero, and same for $P_0 \otimes R/\mathfrak{m} \to M/\mathfrak{m}M$.
\end{definition} 

This is equivalent to saying that for each $i$, the map $P_i \to \ker(P_{i-1}
\to P_{i-2})$ is an isomorphism modulo $\mathfrak{m}$.

\begin{proposition} 
Every $M$ (over a local noetherian ring) has a minimal projective resolution.
\end{proposition} 
\begin{proof} 
Start with a module $M$. Then $M/\mathfrak{m}M$ is a finite-dimensional vector
space over $R/\mathfrak{m}$, of dimension say $d_0$. We can choose a basis for that vector space, which
we can lift to $M$. That determines a map of free modules
\[ R^{d_0} \to M,  \]
which is a  surjection by Nakayama's lemma. It is by construction an
isomorphism modulo $\mathfrak{m}$. Then define $K = \ker(R^{d_0} \to M)$; this
is finitely generated by noetherianness, and we
can do the same thing for $K$, and repeat to get a map $R^{d_1}
\twoheadrightarrow K$ which is an isomorphism modulo $\mathfrak{m}$. Then 
\[ R^{d_1} \to R^{d_0} \to M \to 0  \]
is exact, and minimal; we can continue this by the same procedure.
\end{proof}


\begin{proposition} 
Minimal projective resolutions are unique up to isomorphism.
\end{proposition} 
\begin{proof} 
Suppose we have one minimal projective resolution:
\[ \dots \to P_2 \to P_1 \to P_0 \to M \to 0  \]
and another:
\[ \dots \to Q_2 \to Q _1 \to Q_0 \to M \to 0  .\]
There is always a map of projective resolutions $P_* \to Q_*$ by general
homological algebra. There is, equivalently,  a commutative diagram
\[\xymatrix{ \dots \ar[d]  \ar[r] &   P_2\ar[d]  \ar[r] &  P_1 \ar[d]  \ar[r]
&  P_0 \ar[d]  \ar[r] &   M \ar[d]^{\mathrm{id}}  \ar[r] &   0  \\ 
 \dots  \ar[r] &   Q_2  \ar[r] &  Q_1   \ar[r]
&  Q_0   \ar[r] &   M  \ar[r] &   0 } \]
If both resolutions are minimal, the claim is that this map is an isomorphism.
That is, $\phi_i: P_i \to Q_i$ is an isomorphism, for each $i$.

To see this, note that $P_i, Q_i$ are finite free $R$-modules.\footnote{We are
using the fact that a finite projective module over a local ring is
\emph{free}.} So $\phi_i$ is an isomorphism iff $\phi_i$ is an isomorphism
modulo the maximal ideal, i.e. if 
\[ P_i/\mathfrak{m}P_i \to Q_i/\mathfrak{m}Q_i  \]
is an isomorphism. Indeed, if $\phi_i$ is an isomorphism, then its tensor
product with $R/\mathfrak{m}$ obviously is an isomorphism.  Conversely suppose
that the reductions mod $\mathfrak{m}$ make an isomorphism. Then the ranks of
$P_i, Q_i$ are the same, and $\phi_i$ is an $n$-by-$n$ matrix whose determinant
is not in the maximal ideal, so is invertible. This means that $\phi_i$ is invertible by the
usual formula for the inverse matrix. 

So we are to check that $P_i / \mathfrak{m}P_i \to Q_i / \mathfrak{m}Q_i$ is an
isomorphism for each $i$. This is equivalent to the assertion that
\[ (Q_i/\mathfrak{m}Q_i)^{\vee} \to  (P_i/\mathfrak{m}P_i)^{\vee} \]
is an isomorphism. But this is the map
\[ \hom_R(Q_i, R/\mathfrak{m}) \to \hom_R(P_i, R/\mathfrak{m}).  \]
If we look at the chain complexes $\hom(P_*, R/\mathfrak{m}), \hom(Q_*,
R/\mathfrak{m})$, the cohomologies
compute the $\ext$ groups of $(M, R/\mathfrak{m})$. But all the maps in this
chain complex are zero because the resolution is minimal, and we have that the
image of $P_i$ is contained in $\mathfrak{m}P_{i-1}$ (ditto for $Q_i$). So the
cohomologies are just the individual terms, and the maps 
$ \hom_R(Q_i, R/\mathfrak{m}) \to \hom_R(P_i, R/\mathfrak{m})$ correspond to
the identities on $\ext^i(M, R/\mathfrak{m})$. So these are
isomorphisms.\footnote{We are sweeping under the rug the statement that $\ext$
can be computed via \emph{any} projective resolution. More precisely, if you
take any two projective resolutions, and take the induced maps between the
projective resolutions, hom them into $R/\mathfrak{m}$, then the maps on
cohomology are isomorphisms.}
\end{proof} 


\begin{corollary} 
If $\dots \to P_2 \to P_1 \to P_0 \to M$ is a minimal projective resolution of
$M$, then the ranks $\mathrm{rank}(P_i)$ are well-defined (i.e. don't depend
on the choice of the minimal resolution).
\end{corollary} 
\begin{proof} 
Immediate from the proposition. In fact, the ranks are the dimensions (as
$R/\mathfrak{m}$-vector spaces) of $\ext^i(M, R/\mathfrak{m})$.
\end{proof} 

Let us advertise the goal for next time. We would like to prove Serre's
criterion for regularity.

\begin{theorem} 
Let $(R, \mathfrak{m})$ be a local noetherian ring. Then $R$ is regular iff
$R/\mathfrak{m}$ has finite projective dimension. In this case,
$\pr(R/\mathfrak{m}) = \dim R$.
\end{theorem} 
\lecture{11/24}

\subsection{The Auslander-Buchsbaum formula}

Today, we shall start by proving:

\begin{theorem}[Auslander-Buschsbaum formula]
Let $R$ be a  local noetherian ring, $M$ a f.g. $R$-module of finite
projective dimension. If $\pr(R) <
\infty$, then $\pr(M) = \depth(R) - \depth(M)$.
\end{theorem} 

\begin{proof} 
Induction on $\pr(M)$. When $\pr(M)=0$, then $M$ is projective, so isomorphic
to $R^n$ for some $n$. Thus $\depth(M) = \depth(R)$. 

Assume $\pr(M) > 0$.
Choose a surjection $P \twoheadrightarrow M$ and write an exact sequence
\[ 0 \to K \to P \to M \to 0,  \]
where $\pr(K) = \pr(M)-1$. We also know by induction that
\[ \pr(K) = \depth R - \depth(K).  \]
What we want to prove is that 
\[ \depth R - \depth M = \pr(M) = \pr(K)+1.  \]
This is equivalent to wanting know that $\depth(K) = \depth (M) +1$.
In general, this may not be true, though, but we will prove it under
minimality hypotheses.

Without loss of generality, we can choose that $P$ is \emph{minimal}, i.e.
becomes an isomorphism modulo the maximal ideal $\mathfrak{m}$. This means
that the rank of $P$ is $\dim M/\mathfrak{m}M$.
So $K = 0$ iff $P \to M$ is an isomorphism; we've assumed that $M$ is not
free, so $K \neq 0$.

Recall that the depth of $M$ is the smallest value $i$ such that
$\ext^i(R/\mathfrak{m}, M) \neq 0$. So we should look at the long exact
sequence from the above short exact sequence:
\[ \ext^i(R/\mathfrak{m}, P) \to  \ext^i(R/\mathfrak{m},M)  \to
\ext^{i+1}(R/\mathfrak{m}, K)  \to \ext^{i+1}(R/\mathfrak{m}, P).\]
Now $P$ is just a direct sum of copies of $R$, so $\ext^i(R/\mathfrak{m}, P)$
and $\ext^{i+1}(R/\mathfrak{m}, P)$ are zero if $i+1< \depth R$. In
particular, if $i+1< \depth R$, then the map $ \ext^i(R/\mathfrak{m},M)  \to
\ext^{i+1}(R/\mathfrak{m}, K) $ is an isomorphism.
So we find that $\depth M + 1 = \depth K$ in this case.

We have seen that \emph{if $\depth K < \depth R$, then } by taking $i$ over
all integers $< \depth K$, we find that
\[ \ext^{i}(R/\mathfrak{m}, M) = \begin{cases} 
0 & \mathrm{if \ } i+1 < \depth K \\
\ext^{i+1}(R/\mathfrak{m},K) & \mathrm{if \ } i+1 = \depth K \end{cases}. \]
In particular, we are \textbf{done} unless $\depth K \geq \depth R$. 
By the inductive hypothesis, this is equivalent to saying that $K$ is
projective. 

So let us consider the case where $K$ is projective, i.e. $\pr(M)=1$.
We want to show that $\depth M = d-1$ if $d = \depth R$.
We need a
slightly different argument in this case. Let $d = \depth(R) = \depth (P) =
\depth(K)$ since $P,K$ are free. We have a short exact sequence
\[ 0 \to K \to P \to M \to 0  \]
and a long exact sequence of $\ext$ groups:
\[  0 \to \ext^{d-1}(R/\mathfrak{m}, M) \to \ext^d(R/\mathfrak{m}, K) \to  \ext^d(R/\mathfrak{m}, P) .\]
We know that $\ext^d(R/\mathfrak{m}, K)$ is nonzero as $K$ is free and $R$ has
depth $d$. However, $\ext^i(R/\mathfrak{m}, K) = \ext^i(R/\mathfrak{m}, P)=0$
for $i<d$.  This implies that $\ext^{i-1}(R/\mathfrak{m}, M)=0$ for $i<d$. 

We will show:
\begin{quote}
The map $\ext^d(R/\mathfrak{m}, K) \to \ext^{d}(R/\mathfrak{m}, P)$ is zero.
\end{quote}
This will imply that the depth of $M$ is \emph{precisely} $d-1$.

This is because the matrix $K \to P$ is given by multiplication by a matrix
with coefficients in $\mathfrak{m}$ as $K/\mathfrak{m}K \to P/\mathfrak{m}P$
is zero.  In particular, the map on the $\ext$ groups is zero, because it is
annihilated by $\mathfrak{m}$.
\end{proof} 

\begin{example} 
Let $R = \mathbb{C}[x_1, \dots, x_n]/\mathfrak{p}$ for $\mathfrak{p}$ prime.
Choose an injection $R' \to R$ where $R' = \mathbb{C}[y_1, \dots, y_m]$ and
$R$ is a f.g. $R'$-module. This exists by the Noether normalization lemma. 

We wanted to show:

\begin{theorem} 
$R$ is Cohen-Macaulay\footnote{That is, its localizations at any prime---or,
though we haven't proved yet, at any maximal ideal---are.} iff $R$ is a
projective $R'$-module.
\end{theorem} 

We shall use the fact that projectiveness can be tested locally at every
maximal ideal.

\begin{proof} 
Choose a maximal ideal $\mathfrak{m} \subset R'$. We will show that
$R_{\mathfrak{m}}$ is a free $R'_{\mathfrak{m}}$-module via the injection of
rings $R'_{\mathfrak{m}} \hookrightarrow R_{\mathfrak{m}}$ (where
$R_{\mathfrak{m}}$ is defined as $R$ localized at the multiplicative subset
of elements of $R' - \mathfrak{m}$) at each $\mathfrak{m}$ iff
Cohen-Macaulayness holds.

Now $R'_{\mathfrak{m}}$ is a regular local ring, so its depth is $m$. By the
Auslander-Buchsbaum formula, $R_{\mathfrak{m}}$ is projective as an
$R'_{\mathfrak{m}}$-module iff 
\[ \depth_{R'_{\mathfrak{m}}} R_{\mathfrak{m}} = m.  \]
Now $R$ is a projective module iff the above condition holds for all maximal
ideals $\mathfrak{m} \subset R'$. The claim is that this is equivalent to
saying that $\depth R_{\mathfrak{n}} = m = \dim R_{\mathfrak{n}}$
for every maximal ideal $\mathfrak{n} \subset R$ (depth over $R$!).

These two statements are almost the same, but one is about the depth of $R$ as
an $R$-module, and another as an $R'$-module. 

\begin{quote}
Issue: There may be several maximal ideals of $R$ lying over the maximal ideal
$\mathfrak{m} \subset R'$.
\end{quote}

The problem is that $R_{\mathfrak{m}}$ is not generally local, and not
generally equal to $R_{\mathfrak{n}}$ if $\mathfrak{n}$ lies over
$\mathfrak{m}$. Fortunately, depth makes sense even over semi-local rings
(rings with finitely many maximal ideals). 

Let us just assume that this does not occur, though. Let us assume that
$R_{\mathfrak{m}}$ is a local ring for every maximal ideal $\mathfrak{m}
\subset R$. Then we are reduced to showing that if $S = R_{\mathfrak{m}}$,
then the depth of $S$ as an $R'_{\mathfrak{m}}$-module is the same as the
depth as an $R_{\mathfrak{m}}$-module. That is, the depth doesn't depend too
much on the ring, since $R'_{\mathfrak{m}}, R_{\mathfrak{m}}$ are ``pretty
close.'' If you believe this, then you believe the theorem, by the first
paragraph.


Let's prove this claim in a more general form:

\begin{proposition} 
Let $\phi: S' \to S$ be a local\footnote{I.e. $\phi$ sends non-units into
non-units.} map of local noetherian rings such that $S$ is a f.g.
$S'$-module. Then, for any finitely generated $S$-module $M$, 
\[ \depth_S M = \depth_{S'} M.  \]
\end{proposition} 
With this, the theorem will be proved.

\begin{remark} 
This result generealizes to the semi-local case, which is how one side-steps
the issue above.
\end{remark} 

\begin{proof} 
By induction on $\depth_{S'} M$. There are two cases. 

Let $\mathfrak{m}', \mathfrak{m}$ be the maximal ideals of $S', S$.
If $\depth_{S'}(M) >0$, then there is an element $a$ in $\mathfrak{m}'$ such
that 
\[ M \stackrel{\phi(a)}{\to} M \]
is injective. Now $\phi(a) \in \mathfrak{m}$. So $\phi(a)$ is a
nonzerodivisor, and we have an exact sequence
\[ 0 \to M \stackrel{\phi(a)}{\to} M \to M/\phi(a) M \to 0.  \]
Thus we find
\[ \depth_{S} M > 0 . \]
Moreover, we find that $\depth_S M = \depth_S (M/\phi(a) M) +1$ and
$\depth_{S'} M = \depth_{S'}(M/\phi(a) M))+1$. The inductive hypothesis now
tells us that
\[ \depth_S M = \depth_{S'}M.  \]

The hard case is where $\depth_{S'} M = 0$. We need to show that this is
equivalent to $\depth_{S} M = 0$. So we know at first that $\mathfrak{m}' \in
\ass(M)$. That is, there is an element $x \in M$ such that $\ann_{S'}(x) =
\mathfrak{m}'$.
Now $\ann_S(x) \subsetneq S$ and contains $\mathfrak{m}' S$.

$Sx \subset M$ is a submodule, surjected onto by $S$ by the map $a \to ax$.
This map actually, as we have seen, factors through $S/\mathfrak{m}' S$. Here
$S$ is a finite $S'$-module, so $S/\mathfrak{m}'S$ is a finite
$S'/\mathfrak{m}'$-module. In particular, it is a finite-dimensional vector space
over a field. It is thus a local artinian ring. But $Sx$ is a module over this
local artinian ring. It must have an associated prime, which is a maximal
ideal in $S/\mathfrak{m}'S$. The only maximal ideal can be
$\mathfrak{m}/\mathfrak{m}'S$.  It follows that $\mathfrak{m} \in \ass(Sx)
\subset \ass(M)$.

In particular, $\depth_S M = 0$ too, and we are done.
\end{proof} 

\end{proof} 
\end{example} 
