\chapter{Dedekind domains}

\section{Dedekind rings}


\begin{example} 
Let $R$ be a noetherian local domain whose prime ideals are $(0)$ and the maximal
ideal 
$\mathfrak{m} \neq 0$. In this condition, I claim:
\begin{proposition} 
TFAE:
\begin{enumerate}
\item $R$ is factorial.
\item $\mathfrak{m}$ is principal.
\item  $R$ is integrally closed.
\item $R$ is a valuation ring with value group $\mathbb{Z}$. 
\end{enumerate}
\end{proposition} 
\begin{definition} 
A ring satisfying these conditions is called a \textbf{discrete valuation
ring} (\textbf{DVR}).
A discrete valuation ring necessarily has only two prime ideals. In fact, a
valuation ring with value group $\mathbb{Z}$ satisfies all the above conditions. 
\end{definition} 
\begin{proof} 
Suppose $R$ is factorial. Then every prime ideal of height one is principal.
But $\mathfrak{m}$ is the only prime that can be height one (it's minimal over
any nonzero nonunit of $R$. Thus 1 implies 2, and similarly 2 implies 1.

1 implies 3 is true for any $R$: factorialness implies integrally closedness.
This is either either homework on the problem set or an easy exercise one can
do for yourself. 

4 implies 2 because one chooses an element $x \in R$ such that the valuation of
$x$ is one. Then, it is easy to see that $x$ generates $\mathfrak{m}$: if $y
\in \mathfrak{m}$, then the valuation of $y$ is at least one, so $y/x \in R$
and $y = (y/x)x \in (x)$. 

The implication 2 implies 4 was essentially done last time. Suppose
$\mathfrak{m}$ is principal, generated by $t$. Last time, we saw that
\emph{all} nonzero ideals of $R$ have the form $(t^n)$ for some $n>0$.  If $x
\in R$, we define the valuation of $x$ to be $n$ if $(x) = (t^n)$. One can
easily check that this is a valuation on $R$ which extends to the quotient
field by additivity.

The interesting part of the argument is the claim that 3
implies 2. Suppose $R$ is integrally closed; I claim that $\mathfrak{m}$ is
principal. Choose $x \in \mathfrak{m} - \left\{0\right\}$. If $(x) =
\mathfrak{m}$, we're done. Otherwise, we can look at $\mathfrak{m}/(x) \neq
0$.  We have a finitely generated module over a noetherian ring which is
nonzero, so it has an associated prime. That associated prime is either zero or
$\mathfrak{m}$. But $0$ is not an associated prime because every element in the
module is killed by $x$. So $\mathfrak{m}$ is an associated prime.

Thus, there is $y \in \mathfrak{m}$ such that $y \notin (x)$ and $\mathfrak{m}y
\subset (x)$. In particular, $y/x \in K(R) - R$ but
\[ (y/x) \mathfrak{m} \subset R.  \]
There are two cases:
\begin{enumerate}
\item Suppose $(y/x) \mathfrak{m}  = R$. Then we can write $\mathfrak{m} =
R(x/y)$. So $\mathfrak{m}$ is principal. (This argument shows that $x/y \in R$.)	
\item The other possibility is that $y/x \mathfrak{m} \subsetneq R$. In this
case, this is an ideal, so 
\[ (y/x) \mathfrak{m} \subset \mathfrak{m}.  \]
In particular, multiplication by $y/x$ carries $\mathfrak{m}$ to itself.  So
multiplication by $y/x$ stabilizes the finitely generated module
$\mathfrak{m}$. By the usual characteristic polynomial argument, we see that
$y/x$ is integral over $R$. In particular, $y/x \in R$, as $R$
was integrally closed, a contradiction as $y \notin (x)$. 
\end{enumerate}
\end{proof} 

We now introduce a closely related notion.  
\begin{definition} 
A \textbf{Dedekind ring} is a noetherian domain $R$ such that 
\begin{enumerate}
\item $R$ is integrally closed.
\item Every nonzero prime ideal of $R$ is maximal. 
\end{enumerate}
\end{definition} 
\end{example} 


\begin{remark} 
If $R$ is Dedekind, then any nonzero element is height one. This is evident
since every nonzero prime is maximal. 

If $R$ is Dedekind, then $R$ is locally factorial. In fact, the localization of
$R$ at a nonzero prime $\mathfrak{p}$ is a DVR.
\begin{proof} 
$R_{\mathfrak{p}}$ has precisely two prime ideals: $(0)$ and
$\mathfrak{p}R_{\mathfrak{p}}$. As a localization of an integrally closed
domain, it is integrally closed. So $R_{\mathfrak{p}}$ is a DVR by the above
result (hence
factorial).
\end{proof} 
\end{remark} 


Assume $R$ is Dedekind now.
We have an exact sequence
\[ 0 \to R^* \to K(R)^* \to \cart(R) \to \pic(R) \to 0.  \]
Here $\cart(R) \simeq \weil(R)$. But $\weil(R)$ is free on the nonzero
primes, or equivalently maximal ideals, $R$ being Dedekind. 
In fact, however, $\cart(R)$ has a simpler description.

\begin{proposition} 
Suppose $R$ is Dedekind. Then $\cart(R)$ consists of all nonzero finitely generated
submodules of $K(R)$ (i.e. \textbf{fractional ideals}). 
\end{proposition} 

This is the same thing as saying as every nonzero finitely generated submodule of $K(R)$ is
invertible.
\begin{proof} 
Suppose $M \subset K(R)$ is nonzero and finitely generated It suffices to check that $M$ is
invertible after localizing at every prime, i.e. that $M_{\mathfrak{p}}$ is
an invertible---or equivalently, trivial, $R_{\mathfrak{p}}$-module. At the
zero prime, there is nothing to check. We might as well assume that
$\mathfrak{p}$ is maximal. Then $R_{\mathfrak{p}}$ is a DVR and
$M_{\mathfrak{p}}$ is a finitely generated submodule of $K(R_{\mathfrak{p}}) = K(R)$. 

Let $S$ be the set of integers $n$ such that there exists $ x \in
M_{\mathfrak{p}}$ with $v(x) = n$, for $v$ the valuation of $R_{\mathfrak{p}}$.
By finite generation of $M$, $S$ is bounded below. Thus $S$ has a least element
$k$. There is an element of $M_{\mathfrak{p}}$, call it $x$, with valuation $k$.

It is easy to check that $M_{\mathfrak{p}}$ is generated by $x$, and is in fact free with
generator $x$. The reason is simply that $x$ has the smallest valuation of
anything in $M_{\mathfrak{p}}$.
\end{proof} 

What's the upshot of this?

\begin{theorem}
If $R$ is a Dedekind ring, then any nonzero ideal $I \subset R$ is invertible,
and therefore uniquely described as a product of powers of (nonzero) prime ideals, $I =
\prod \mathfrak{p}_i^{n_i}$.
\end{theorem} 
\begin{proof} 
This is simply because $I$ is in $\cart(R) = \weil(R)$ by the above result. 
\end{proof} 

This is Dedekind's generalization of unique factorization.

We now give the standard examples:
\begin{example} 
\begin{enumerate}
\item Any PID is Dedekind.  
\item If $K$ is a finite extension of $\mathbb{Q}$, and set $R $ to be the
integral closure of $\mathbb{Z}$ in $K$, then $R$ is a Dedekind ring. The ring
of integers in any number field is a Dedekind ring. 
\item If $R$ is the coordinate ring of an algebraic variety which is smooth and
irreducible of dimension one, then $R$ is Dedekind. 
\item  Let $X$ be a compact Riemann surface, and let $S \subset X$ be a
nonempty finite subset. Then the ring of meromorphic functions on $X$ with
poles only in $S$ is
Dedekind. The maximal ideals in this ring are precisely those corresponding to
points of $X-S$. 
\end{enumerate}
\end{example} 


\section{A criterion for DVRs}


A much more interesting (and nontrivial) result is the following:
\begin{theorem} \label{niupmeansdvr} If the domain $R$ is Noetherian, integrally closed, and has a unique nonzero prime ideal $\mathfrak{m}$, then $R$ is a DVR.  Conversely, any DVR has those properties.
\end{theorem}
This is equivalent to the fact that Dedekind domains have unique factorization of ideals, as we'll see eventually.  In particular, it will give a correspondence with the notions of prime ideal and discrete valuation (for Dedekind domains).

\begin{proof}
First, let's do the last part. 
We already know the part about DVRs being PIDs, which are Noetherian; integrally closedness is true for any UFD (and thus for any PID).  The  ideals of a DVR are generated by powers of the uniformizing element, so the ideal $\mathfrak{m}$ of non-units is the only prime ideal. 

The converse is much harder.  Let $R$ be a ring satisfying the three conditions of the theorem.

We will show that $\mathfrak{m}$ is principal, by showing it is \emph{invertible} (as will be seen below).   We divide the proof into steps:

\subsection{Step one}
For an ideal $I \subset R$, let $I^{-1} := \{ x \in F: xI \subset R \}$, where $F$ is the quotient field of $R$.  Then clearly $I^{-1} \supset R$ and $I^{-1}$ is an $R$-module, but it isn't clear that $I^{-1} \neq R$.  

Nevertheless, I claim that  \[ \boxed{\mathfrak{m}^{-1} \neq R.}\]

The proof runs across a familiar line---show that any maximal element in the set of ideals $I$ with $I^{-1} \neq R$ is prime. 
The set of such ideals is nonempty: it contains   any $(a)$ for $a \in \mathfrak{m}$ (in which case $(a)^{-1} = Ra^{-1} \neq R$).  
There must be a maximal element in this set of ideals by noetherianness, which is prime; thus,  that maximal element must be $\mathfrak{m}$, which proves our claim.

So to fill in the missing link, we must prove:
\begin{lemma} If $S$ is a Noetherian domain, any maximal element in the set of ideals $I \subset S$ with $I^{-1} \neq S$ is prime.
\end{lemma}

\begin{proof}
Let $J$ be a maximal element, and suppose $ab \in J$, with  $a,b \notin J$.  I claim that if $z \in J^{-1} - S$, then $za, zb \in J^{-1} - S$.  The $J^{-1}$ part follows since $J^{-1}$ is a $S$-module.

By symmetry it's enough to prove the other half for $a$, namely $za \notin S$; but then if $za \in S$, we'd have $z( (a) + J ) \subset S$, which implies $ ( (a) + J)^{-1} \neq S$, contradiction, for $J$ was maximal.

Then it follows that $z(ab) = (za) b \in J^{-1} - S$, by applying the claim I just made twice.  But $ab \in J$, so $z(ab) \in S$, contradiction.
\end{proof}



\subsection{Step two}

I now claim $\mathfrak{m}\mathfrak{m}^{-1} = R$.  Well, we know that $\mathfrak{m}\mathfrak{m}^{-1} \subset R$ by definition of inverses. and $\mathfrak{m} \subset \mathfrak{m}\mathfrak{m}^{-1}$ too.  So $\mathfrak{m}\mathfrak{m}^{-1}$ is an ideal sandwiched between $\mathfrak{m}$ and $R$.  
Thus we only need to prove that $\mathfrak{m} \mathfrak{m}^{-1} = \mathfrak{m}$ is impossible.  To do this, choose some $a \in \mathfrak{m}^{-1} - R$ which must satisfy $a \mathfrak{m} \subset \mathfrak{m}$.  Now by the next lemma, $a$ is integral over $R$.

\begin{lemma} If $N \subset F$ is a finitely generated $R$-module satisfying $b  N \subset N$ for some $b \in F$, then $b$ is integral over $R$.
\end{lemma}
\begin{proof}

This follows by the Cayley-Hamilton theorem, and is a standard criterion for
integrality.  (It can even be generalized to faithful finitely generated
$R$-modules.)  Cf. \cite{La02}.
\end{proof}

So returning back above, $a \notin R$ is integral over $R$, a contradiction by integrally closedness.

\subsection{Step three}

Now I claim $\mathfrak{m}$ is principal, which by yesterday proves the claim.  Indeed, since $\mathfrak{m} \mathfrak{m}^{-1} = R$, write
\[ 1 = \sum m_i n_i, \quad m_i \in \mathfrak{m}, \ n_i \in \mathfrak{m}^{-1}.\]
At least one $m_j n_j$ is invertible, since $R$ is local.  Then I claim $\mathfrak{m} = (m_j)$.  Indeed, we need only prove $\mathfrak{m} \subset (m_j)$.  For this, if $x \in \mathfrak{m}$, then $xn_j \in R$ by definition of $\mathfrak{m}^{-1}$, so  \[ x = m_j (xn_j) (m_jn_j)^{-1} \in ( m_j).\]
\end{proof}

So we're done.  Taking stock, we have an effective way to say whether a ring is a DVR.  These three conditions are much easier to check in practice (noetherianness is usually easy, integral closure is usually automatic, and the last one is not too hard either for reasons that will follow) than the existence of an absolute value.

\section{Dedekind domains}


Dedekind domains come up  when you take the ring of algebraic integers in any finite extension of $\mathbb{Q}$ (i.e. number fields).  In these, you don't necessarily have unique factorization.  But you do have something close---namely, unique factorization of \emph{ideals}---which makes these crucial.
\subsection{Basics}
\begin{definition} A \textbf{Dedekind domain} is a Noetherian integral domain $A$ that is  integrally closed, and of Krull dimension one---that is, each nonzero prime ideal is maximal.
\end{definition}

A DVR is a Dedekind domain, and the localization of a Dedekind domain at a nonzero prime is a DVR by Theorem~\ref{niupmeansdvr}.  Another example (Serre) is to take  a nonsingular affine  variety $V$ of dimension 1 and consider the ring of globally regular functions $k[V]$; the localizations at closed points (or equivalently, nonzero prime ideals) are DVRs, and it quickly follows that $k[V]$ is Dedekind.

In particular, we can encapsulate what has already been proved as:
\begin{theorem} Let $A$ be a Dedekind domain with quotient field $K$. Then there is a bijection between the discrete valuations of $K$ that assign nonnegative orders to elements of $A$ and the nonzero prime ideals of $A$.
\end{theorem}
\begin{proof} Indeed, every valuation gives a prime ideal of elements of positive order; every prime ideal $\mathfrak{p}$ gives a discrete valuation on $A_{\mathfrak{p}}$, hence on $K$. \end{proof}


This result, however trivial to prove, is the main reason we can work essentially interchangeably with prime ideals in Dedekind domains and discrete valuations.

\subsection{Factorization of ideals}
Now assume  $A$ is Dedekind. A f.g. $A$-submodule of the quotient field $F$ is called a \textbf{fractional ideal}; by multiplying by some element of $A$, we can always pull a fractional ideal into $A$, when it becomes an ordinary ideal.  The sum and product of two fractional ideals are fractional ideals.

\begin{theorem}[Invertibility]  If $I$ is a nonzero fractional ideal and $ I^{-1} := \{ x \in F: xI \subset A \}$, then $I^{-1}$ is a fractional ideal and $I I^{-1} = A$.
\end{theorem}

Thus, the nonzero fractional ideals are an \emph{abelian group} under multiplication.

\begin{proof}
To see this, note that invertibility is preserved under localization: for a multiplicative set $S$, we have $S^{-1} ( I^{-1} ) = (S^{-1} I)^{-1}$, where the second ideal inverse is with respect to $S^{-1}A$; this follows from the fact that $I$ is finitely generated.  Note also that invertibility is true for discrete valuation rings: this is because the only ideals are principal, and principal ideals (in any integral domain) are obviously invertible.

So for all primes $\mathfrak{p}$, we have $(I I^{-1})_{\mathfrak{p}} = A_{\mathfrak{p}}$, which means the inclusion of $A$-modules $I I^{-1} \to A$ is an isomorphism at each localization.  Therefore it is an isomorphism, by general algebra.
\end{proof} 

The next result says we have unique factorization of \textbf{ideals}:
\begin{theorem}[Factorization] Each ideal $I \subset A$ can be written uniquely as a product of powers of prime ideals.
\end{theorem}
\begin{proof}
Let's use the pseudo-inductive argument to obtain existence of a prime factorization.  Let $I$ be the maximal ideal which can't be written in such a manner, which exists since $A$ is Noetherian.  Then $I$ isn't prime (evidently), so it's contained in some prime $\mathfrak{p}$.  But $I = (I\mathfrak{p}^{-1})\mathfrak{p}$, and $I\mathfrak{p}^{-1} \neq I$ can be written as a product of primes, by the inductive assumption. Whence so can $I$, contradiction.

Uniqueness of factorization follows by localizing at each prime.
\end{proof}

\begin{definition} Let $P$ be the subgroup of nonzero principal ideals in the group $I$ of nonzero ideals.  The quotient $I/P$ is called the \textbf{ideal class group}.
\end{definition}

The ideal class group of the integers, for instance (or any principal ideal domain) is clearly trivial.  In general, this is not the case, because Dedekind domains do not generally admit unique factorization.
\begin{proposition} Let $A$ be a Dedekind domain. Then $A$ is a UFD if and only if its ideal class group is trivial.
\end{proposition}
\begin{proof} If the ideal class group is trivial, then $A$ is a principal ideal domain, hence a UFD by elementary algebra.  Conversely, suppose $A$ admits unique factorization.  
Then, by the following lemma, every prime ideal is principal.  Hence every ideal is principal, in view of the unique factorization of ideals.
\end{proof}
\begin{lemma} Let $R$ be a UFD, and let $\mathfrak{p}$ be a prime ideal which contains no proper prime subideal except for $0$.  Then $\mathfrak{p}$ is principal.
\end{lemma}
The converse holds as well; a domain is a UFD if and only if every prime ideal
of height one is principal.  Cf. \cite{Ei95}.
\begin{proof}
First, $\mathfrak{p}$ contains an element $x \neq 0$, which we factor into irreducibles $\pi_1 \dots \pi_k$.  One of these, say $\pi_j$, belongs to $\mathfrak{p}$, so $\mathfrak{p} \supset (\pi_j)$. Since $\mathfrak{p}$ is minimal among nonzero prime ideals, we have $\mathfrak{p} = (\pi_j)$.  (Note that $(\pi_j)$ is prime by unique factorization.)
\end{proof}

\section{Extensions}

We will show that one can always   valuations to bigger fields.  
\subsection{Integral closure in a finite separable extension}

One of the reasons Dedekind domains are so important is
\begin{theorem} \label{intclosdedekind} Let $A$ be a Dedekind domain with quotient field $K$, $L$ a finite separable extension of $K$, and $B$ the integral closure of $A$ in $L$.  Then $B$ is Dedekind.
\end{theorem}

This can be generalized to the Krull-Azizuki theorem, cf. \cite{Bo68}.

\begin{proof}  We need to check that $B$ is Noetherian, integrally, closed, and of dimension 1.

\begin{itemize}
\item Noetherian.  Indeed, I claim that $B$ is a finitely generated $A$-module, which obviously implies Noetherianness.  The $K$-linear map $(.,.): L \times L \to K$, $a,b \to \mathrm{Tr}(ab)$ is nondegenerate since $L$ is separable over $K$.  Let $F \subset B$ be a free module spanned by a $K$-basis for $L$.  Then since traces preserve integrality and $A$ is integrally closed, we have $B \subset F^*$, where $F^* := \{ x \in K: (x,F) \subset A \}$.  Now $F^*$ is $A$-free on the dual basis of $F$ though, so $B$ is a submodule of a f.g. $A$ module, hence a f.g. $A$-module.
\item Integrally closed.  It is an integral closure, and integrality is transitive.
\item Dimension 1.  Indeed, if $A \subset B$ is an integral extension of
domains, then $\dim A = \dim B$. This follows essentially from the theorems of
``lying over'' and ``going up.'' Cf. \cite{Ei95}.
\end{itemize}

So, consequently the ring of algebraic integers (integral over $\mathbb{Z}$) in a number field (finite extension of $\mathbb{Q}$) is Dedekind.
\end{proof}

Note that the above proof actually implied (by the argument about traces) the following useful fact:
\begin{proposition} Let $A$ be a noetherian integrally domain with quotient field $K$.  Let $L$ be a finite separable extension and $B$ the ring of integers. Then $B$ is a finitely generated $A$-module.
\end{proposition}

We shall give another, more explicit proof whose technique will be useful in the sequel.
Let $\alpha  \in B$ be a generator of $L/K$.  Let $n=[L:K]$ and $\sigma_1, \dots, \sigma_n$ the distinct embeddings of $L$ into the algebraic closure of $K$.
Define the \textbf{discriminant} of $\alpha$ to be
\[ D(\alpha) = \left(\det \begin{bmatrix} 
1 & \sigma_1\alpha & (\sigma_1 \alpha)^2 & \dots \\
1 & \sigma_2\alpha & (\sigma_2 \alpha)^2 & \dots \\
\vdots & \vdots & \vdots & \ddots \end{bmatrix}\right)^2 .\]
This maps to the same element under each $\sigma_i$, so is in $K^*$ (and even $A^*$ by integrality);it is nonzero by basic facts about vanderMonde determinants.  The  next lemma clearly implies that $B$ is contained in a finitely generated $A$-module, hence is finitely generated (since $A$ is noetherian).
\begin{lemma} We have $B \subset D(\alpha)^{-1} A[\alpha]$. 
\end{lemma}
\begin{proof}
Indeed, suppose $x \in B$.  We can write $x = c_0 (1) + c_1 (\alpha) + \dots c_{n-1}(\alpha^{n-1})$ where each $c_i \in K$.  We will show that in fact, each $c_i \in D(\alpha)^{-1}A$, which will prove the lemma.  Applying each $\sigma_i$, we have for each $i$, $\sigma_i x = c_0 (1) + c_1 (\sigma_i \alpha) + \dots + c_{n-1} ( \sigma_i \alpha^{n-1})$.
Now by Cramer's lemma, each $c_i$ can be written as a quotient of determinants of matrices involving $\sigma_jx $ and the $\alpha^{j}$.  The denominator determinant is in fact $D(\alpha)$.  The numerator is in $K$ and must be integral, hence is in $A$.  This proves the claim and the lemma.
\end{proof}

\begin{example} Let $p^i$ be a power of a prime $p$ and consider the extension
$\mathbb{Q}(\zeta_{p^i})/\mathbb{Q}$ for $\zeta_{p^i}$ a primitive $p^i$-th
root of unity.  This is a special case of a cyclotomic extension, an important
example in the subject.  I claim that the ring of integers (integral over
$\mathbb{Z}$!)
in $\mathbb{Q}(\zeta_{p^i})$ is precisely $\mathbb{Q}[\zeta_{p^i}]$.  This is true in fact for all cyclotomic extensions, but we will not be able to prove it here.

First of all, $\zeta_{p^i}$ satisfies the equation $X^{p^{i-1}(p-1)} +
X^{p^{i-1}(p-2)} + \dots + 1 = 0$.  This is because if $\zeta_p$ is a $p$-th
root of unity, $(\zeta_p-1)(1+\zeta_p + \dots + \zeta_p^{p-1}) = \zeta_p^p - 1 =
0$.  In particular, $X - \zeta_{p^i} \mid X^{p^{i-1}(p-1)} +
X^{p^{i-1}(p-2)} + \dots + 1 $, and consequently (taking $X=1$), we find that
$1 - \zeta_{p^i}$ divides $p$ in the ring of integers in
$\mathbb{Q}(\zeta_{p^i})/\mathbb{Q}$.  This is true for \emph{any} primitive
$p^i$-th root of unity for \emph{any} $p^i$.  Thus the norm to $\mathbb{Q}$ of $1 - \zeta_{p^i}^j$ for any $j$ is a power of $p$.

I claim that this implies that the discriminant $D(\zeta_{p^i})$ is a power of
$p$, up to sign. But by the vanderMonde formula, this discriminant is a
product of terms of the form $\prod (1 - \zeta_{p^i}^{j})$ up to roots of
unity.  The norm to $\mathbb{Q}$ of each factor is thus a power of $p$, and the discriminant itself plus or minus a power of $p$.

By the lemma, it follows that the ring of integers is contained in
$\mathbb{Z}[p^{-1}, \zeta_{p^i}]$. 
\end{example}


\subsection{Extensions of discrete valuations}

The real result we care about is:

\begin{theorem} 
Let $K$ be a field, $L$ a finite separable extension.  Then a discrete valuation on $K$ can be extended to one on $L$.
\end{theorem}

\begin{proof}
Indeed, let $R \subset K$ be the ring of integers.  Then $R$ is a DVR, hence Dedekind, so the integral closure $S \subset L$ is Dedekind too (though in general it is not   a DVR---it may have several non-zero prime ideals) by Theorem~\ref{intclosdedekind}.  Now as above, $S$ is a finitely generated $R$-module, so if $\mathfrak{m} \subset R$ is the maximal ideal, then 
\[ \mathfrak{m} S \neq S \]
by Nakayama's lemma (cf. for instance \cite{Ei95}).  So $\mathfrak{m} S$ is contained in a maximal ideal $\mathfrak{M}$ of $S$ with, therefore, $\mathfrak{M} \cap R = \mathfrak{m}$.  (This is indeed the basic argument behind lying over, which I could have just invoked.) Now $S_{\mathfrak{M}} \supset R_{\mathfrak{m}}$ is a DVR as it is the localization of a Dedekind domain at a prime ideal, and one can appeal to Theorem~\ref{niupmeansdvr}.  So there is a discrete valuation on $S_{\mathfrak{M}}$.  Restricted to $R$, it will be a power of the given $R$-valuation, because its value on a uniformizer $\pi$ is $<1$.  However, a power of a discrete valuation is a discrete valuation too.  So we can adjust the discrete valuation on $S_{\mathfrak{M}}$ if necessary to make it an extension.

This completes the proof.  
\end{proof}

Note that there is a one-to-one correspondence between extensions of the valuation on $K$ and primes of $S$ lying above $\mathfrak{m}$.   Indeed, the above proof indicated a way of getting valuations on $L$ from primes of $S$.  For an extension of the valuation on $K$ to $L$, let $\mathfrak{M} := \{ x \in S: \left| x \right| < 1\}$.
\section{Action of the Galois group}

This section will basically be commutative algebra.  Suppose we have an integral domain (we don't even have to assume it Dedekind) $A$ with quotient field $K$, a finite Galois extension $L/K$, with $B$ the integral closure in $L$.  Then the Galois group $G = G(L/K)$ acts on $B$; it preserves $B$ because it preserves equations in $A[X]$.
In particular, if $\mathfrak{P} \subset B$ is a prime ideal, so is $\sigma \mathfrak{P}$, and the set $\spec B$ of prime ideals in $B$ becomes a $G$-set.

\subsection{The orbits of the Galois group} It is of interest to determine the orbits; this question has  a very clean answer.

\begin{proposition} The orbits of $G$ on the prime ideals of $B$ are in bijection with the primes of $A$, where a prime ideal $\mathfrak{p} \subset A$ corresponds to the set of primes of $B$ lying over $A$.\footnote{It is useful to note here that the lying over theorem works for arbitrary integral extensions.}  Alternatively, any two primes $\mathfrak{P}, \mathfrak{Q} \subset B$ lying over $A$ are conjugate by some element of $G$.
\end{proposition}

In other words, under the natural map $\spec B \to \spec A =\spec B^G$, the latter space is the quotient under the action of $G$, while $A=B^G$ is the ring of invariants in $B$.\footnote{The reader who does not know about the $\spec$ of a ring can disregard these remarks.}

\begin{proof} 
We need only prove the second statement. 
Let $S$ be the multiplicative set $A - \mathfrak{p}$.  Then $S^{-1}B $ is the integral closure of $S^{-1}A$, and in $S^{-1}A = A_{\mathfrak{p}}$, the ideal $\mathfrak{p}$ is maximal. 
Let $\mathfrak{Q}, \mathfrak{P}$ lie over $\mathfrak{p}$; then $S^{-1}\mathfrak{Q},S^{-1} \mathfrak{P}$  lie over $S^{-1}\mathfrak{p}$ and are maximal (to be added).  If we prove that $S^{-1} \mathfrak{Q}, S^{-1} \mathfrak{P}$ are conjugate under the Galois group, then $\mathfrak{Q}, \mathfrak{P}$ must also be conjugate by the properties of localization.  \emph{In particular, we can reduce to the case of $\mathfrak{p}, \mathfrak{Q}, \mathfrak{P}$ all maximal.}

The rest of the proof is now an application of the Chinese remainder theorem.  Suppose that, for all $\sigma \in G$, we have $\sigma \mathfrak{P} \neq \mathfrak{Q}$.  Then the ideals $\sigma \mathfrak{P}, \mathfrak{Q}$ are distinct maximal ideals, so by the remainder theorem, we can find $x \equiv 1 \mod \sigma \mathfrak{P}$ for all $\sigma \in G$ and $x \equiv  0 \mod \mathfrak{Q}$.
Now, consider the norm $N^L_K(x)$; the first condition implies that it is congruent to 1 modulo $\mathfrak{p}$.  But the second implies that  the norm is in $\mathfrak{Q} \cap K = \mathfrak{p}$, contradiction.
\end{proof}

\newcommand{\ol}[1]{\overline{#1}}
\subsection{The decomposition and inertia groups}
Now, let's zoom in on a given prime $\mathfrak{p} \subset A$.  We know that $G$ acts transitively on the set $\mathfrak{P}_1, \dots, \mathfrak{P}_g$ of primes lying above $\mathfrak{p}$; in particular, there are at most $[L:K]$ of them.  

\begin{definition} If $\mathfrak{P}$ is any one of the $\mathfrak{P}_i$, then the stabilizer in $G$ of this prime ideal is called the \textbf{decomposition group} $G_{\mathfrak{P}}$. \end{definition}
We have, clearly, $(G: G_{\mathfrak{P}}) = g$.

Now if $ \sigma \in G_{\mathfrak{P}}$, then $\sigma$ acts on the residue field $B/\mathfrak{P}$ while fixing the subfield $A/\mathfrak{p}$.  In this way, we get a homomorphism $\sigma \to \ol{\sigma}$ from $G$ into the automorphism group of $B/\mathfrak{P}$ over $A/\mathfrak{p})$ (we don't call it a Galois group because we don't yet know whether the extension is Galois).

The following result will be crucial in constructing the so-called ``Frobenius elements'' of crucial use in class field theory.

\begin{proposition} Suppose $A/\mathfrak{p}$ is perfect. Then $B/\mathfrak{P}$ is Galois over $A/\mathfrak{p}$, and the homomorphism $\sigma \to \ol{\sigma}$ is surjective from $G_{\mathfrak{P}} \to G(B/\mathfrak{P}/A/\mathfrak{p})$.
\end{proposition}
\begin{proof}
In this case, the extension $B/\mathfrak{P}/A/\mathfrak{p}$ is separable, and we can choose $\ol{x} \in B/\mathfrak{P}$ generating it by the primitive element theorem.  We will show that $\ol{x}$ satisfies a polynomial equation  $\ol{P}(X) \in A/\mathfrak{p}[X]$ all of whose roots lie in $B/\mathfrak{P}$, which will prove that the residue field extension is Galois.  Moreover, we will show that all the nonzero roots of $\ol{P}$ in $B/\mathfrak{P}$ are conjugates of $\ol{x}$ under elements of $G_{\mathfrak{P}}$.  This latter will imply surjectivity of the homomorphism $\sigma \to \ol{\sigma}$, because it shows that any conjugate of $\ol{x}$ under $G(B/\mathfrak{P}/A/\mathfrak{p})$ is a conjugate under $G_{\mathfrak{P}}$.

We now construct the aforementioned polynomial.   Let $x \in B$ lift $\ol{x}$.  Choose $y \in B$ such that $y \equiv x \mod \mathfrak{P}$ but $y \equiv 0 \mod \mathfrak{Q}$ for the other primes $\mathfrak{Q}$ lying over $\mathfrak{p}$.  We take $P(X) = \prod_{\sigma \in G} (X - \sigma(y)) \in A[X]$. Then the reduction $\ol{P}$ satisfies $\ol{P}(\ol{x})= \ol{P}(\ol{y}) = 0$, and $\ol{P}$ factors completely (via $\prod_{\sigma} (X - \ol{\sigma(t)})$) in $B/\mathfrak{P}[X]$.  This implies that the residue field extension is Galois, as already stated. 
But it is also clear that the polynomial $\ol{P}(X)$ has roots of zero and $\sigma(\ol{y}) = \sigma(\ol{x})$ for $\sigma \in G_{\mathfrak{P}}$.  This completes the proof of the other assertion, and hence the proposition.
\end{proof}

\begin{definition} 
The kernel of the map $\sigma \to \ol{\sigma}$ is called the \textbf{inertia
group} $T_{\mathfrak{P}}$.  Its fixed field is called the \textbf{inertia
field}.
\end{definition}

These groups will resurface significantly in the future.

\begin{remark} Although we shall never need this in the future, it is of
interest to see what happens when the extension $L/K$ is \emph{purely
inseparable}.\footnote{Cf. \cite{La02}, for instance.}  Suppose $A$ is integrally closed in $K$, and $B$ is the integral closure in $L$.  Let the characteristic be $p$, and the degree $[L:K] = p^i$.
In this case, $x \in B$  if and only if $x^{p^i} \in A$. Indeed, it is clear that the condition mentioned implies integrality.  Conversely, if $x$ is integral, then so is $x^{p^i}$, which belongs to $K$ (by basic facts about purely inseparable extensions).  Since $A$ is integrally closed, it follows that $x^{p^i} \in A$.

Let now $\mathfrak{p} \subset A$ be a prime ideal.  I claim that there is precisely one prime ideal $\mathfrak{P}$ of $B$ lying above $A$, and $\mathfrak{P}^{p^i} = \mathfrak{p}$.  Namely, this ideal consists of $x \in B$ with $x^{p^i} \in \mathfrak{p}$!  The proof is straightforward; if $\mathfrak{P}$ is \emph{any} prime ideal lying over $\mathfrak{p}$, then $x \in \mathfrak{P}$ iff $x^{p^i} \in L \cap \mathfrak{P} = \mathfrak{p}$.   In a terminology to be explained later, $\mathfrak{p}$ is \emph{totally ramified.}
\end{remark}


