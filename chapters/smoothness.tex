\chapter{Differentials and smoothness}


In this chapter, we shall introduce two notions. First, we shall discuss
\emph{regular} local rings. On varieties over an algebraically closed field,
regularity corresponds to nonsingularity of the variety at that point.
(Over non-algebraically closed fields, the connection is more subtle.) This
will be a continuation of the local algebra done earlier in the chapter \cref{}
on dimension theory.
We shall next introduce the module of \emph{K\"ahler differentials} of a
morphism of rings $A \to B$, which itself can measure smoothness (though this
connection will not be elucidated until a later chapter).

\section{Regular local rings}
We shall start by introducing the concept of a \emph{regular local} ring, which
is one where the embedding dimension and Krull dimension coincide.
\subsection{Regular local rings}

Let $A$ be a local noetherian ring with maximal ideal $\mathfrak{m} \subset A$
and residue field $k = A/\mathfrak{m}$.
Endow $A$ with the $\mathfrak{m}$-adic topology, so that there is a natural
$k$-algebra $\gr(A) = \bigoplus \mathfrak{m}^i/\mathfrak{m}^{i+1}$.
This is a finitely generated $k$-algebra; indeed, a system of generators for
the ideal $\mathfrak{m}$ generates $\gr(A)$ over $k$.
As a result, we have a natural surjective map of $k$-algebras.
\begin{equation} \label{reglocringmap} \Sym_k \mathfrak{m}/\mathfrak{m}^2 \to
\gr(A).  \end{equation}
Here $\Sym$ denotes the \emph{symmetric algebra.}
\begin{definition} A local ring is called \textbf{regular} if the above map is
an isomorphism, or equivalently if the embedding dimension of $A$ is equal to
the Krull dimension.
\end{definition}

We want to show the ``equivalently'' in the definition is justified.
One direction is easy: if \eqref{reglocringmap} is an isomorphism, then
$\gr(A)$ is a polynomial ring with $\dim_k \mathfrak{m}/\mathfrak{m}^2$
generators. But the dimension of $A$ was defined in terms of the growth of
$\dim_k \mathfrak{m}^i/\mathfrak{m}^{i+1}  = (\gr A)_i$. 
For a polynomial ring on $k$ generators, however, the $i$th graded piece has
dimension a degree-$k$ polynomial in $i$ (easy verification). 
As a result, we get the claim.

However, we still have to show that if the embedding dimension equals the Krull
dimension, then \eqref{reglocringmap} is an isomorphism. This will follow from
the next lemma.

\begin{lemma} If the inequality \[\dim(A) \leq \dim_{A/m}(\mathfrak{m}/\mathfrak{m}^2)\]
is an equality, then \eqref{reglocringmap} is an isomorphism. 
\end{lemma}
\begin{proof}
Suppose \eqref{reglocringmap} is not an isomorphism. 
Then there is an element $f \in \Sym_k \mathfrak{m}/\mathfrak{m}^2$ which is
not zero and which maps to zero in $\gr(A)$; we can assume $f$ homogeneous,
since the map of graded rings is graded.

Now the claim is that if $k[x_1, \dots, x_n]$ is a polynomial ring and $f \neq
0$ a homogeneous element, then the Hilbert polynomial of $k[x_1, \dots,
x_n]/(f)$ is less than $n$. This will easily imply the lemma, since
\eqref{reglocringmap} is always a surjection. 
Now if $\deg f = d$, then the dimension of $(k[x_1, \dots, x_n]/f)_i$ (where
$i$ is a degree) is $\dim (k[x_1, \dots, x_n])_i = \dim (k[x_1, \dots,
x_n])_{i-d}$. It follows that if $P$ is the Hilbert polynomial of the
polynomial ring, that of the quotient is $P(\cdot) - P(\cdot - d)$, which has a
strictly smaller degree. 
\end{proof}

\begin{remark} Let $A$ be a local ring and $\hat{A}$ its completion. Then $\dim(A)=\dim(\hat{A})$, because $A/\mathfrak{m}^n=\hat{A}/\hat{\mathfrak{m}}^n$, so the Hilbert functions are the same. Similarly, $\gr(A)=\gr(\hat{A})$. However, by  $\hat{A}$ is also a local ring. So applying the above lemma, we see  $A$ is regular if and only if $\hat{A}$ is regular.
\end{remark}


\begin{lemma} A regular local ring is a domain.
\label{reg loc means domain}
\end{lemma}
This is a formal consequence of the fact that $\gr(A)$ is a domain and the
filtration on $A$ is complete.
\begin{proof} Let $a,b \neq 0$. Note that $\bigcap \mathfrak{m}^n=0$ by the
Krull intersection theorem (\cref{krullint}), so there are $k_1$ and $k_2$ such that 
$a \in \mathfrak{m}^{k_1} - \mathfrak{m}^{k_1 + 1}$ and $b \in
\mathfrak{m}^{k_2} - \mathfrak{m}^{k_2 + 1}$.
Let $\overline{a}, \overline{b}$ be the images of $a,b$ in $\gr(A)$ (in
degrees $k_1, k_2$); neither is
zero.
But then $\bar{a}\bar{b} \neq 0 \in \gr(A)$, because $\gr(A)=\Sym(\mathfrak{m}/\mathfrak{m}^2)$ is a domain. So $ab \neq 0$, as desired.
\end{proof}


We now study quotients of regular local rings. 
\begin{lemma}
If $A$ is a regular local ring, and $f \in \mathfrak{m}$ is such that $f \in
\mathfrak{m}- \mathfrak{m}^2$. Then $A'=A/fA$ is also regular of dimension $\dim(A)-1$.
\label{reg loc mod f still reg loc}
\end{lemma}
\begin{proof} First let us show the dimension part of the statement. We know from \ref{local dim drop} that the dimension has to drop. On the other hand if the images of $\rad(f_1, \ldots f_n)=\mathfrak{m}/(f)$ in $A/fA$, then $\rad(f,f_1, \ldots f_n)=\mathfrak{m}$ in $A$, giving us the other direction.

Now we want to show that it is regular. This amounts to showing that $\dim_{A'/\mathfrak{m}_{A'}}(\mathfrak{m}_{A'}/\mathfrak{m}_{A'}^2)=\dim(A')$, or in other words that \[\dim_{A'/\mathfrak{m}_{A'}}(\mathfrak{m}_{A'}/\mathfrak{m}_{A'}^2) \leq \dim_{A/\mathfrak{m}_A}(\mathfrak{m}_{A}/\mathfrak{m}_A^2)-1.\]
But note that we have a surjection
\[A \twoheadrightarrow A'=A/fA\]
and $\mathfrak{m}_{A'}=\mathfrak{m}_A/f$, so we also have a surjection
\[\mathfrak{m}_A \twoheadrightarrow \mathfrak{m}_{A'}\]
and since we have
\[\mathfrak{m}_A^2 \to \mathfrak{m}_{A'}^2\]
the map factors as
\[\alpha: \mathfrak{m}_A/\mathfrak{m}_A^2 \twoheadrightarrow \mathfrak{m}_{A'}/\mathfrak{m}_{A'}^2.\]
However, all of these maps are maps of $A$ modules, so this last map is a map of $A/\mathfrak{m}_A$ vector spaces (note that $A/\mathfrak{m}_A=A'/\mathfrak{m}_{A'}$ because $f$ is in $\mathfrak{m}_A$).

Also note that $f \neq 0 \in \mathfrak{m}_A/\mathfrak{m}_A^2$, but $\alpha$ maps the image of $f$ to 0, so $\alpha$ is not injective as a map of vector spaces. It is however, surjective, so the dimension must drop, as desired.
\end{proof}



\begin{corollary}  Consider elements $f_1, \ldots f_m$ in $\mathfrak{m}$ such that $\bar{f_1}, \ldots \bar{f_m} \in \mathfrak{m}/\mathfrak{m}^2$ are independent. Then $A/(f_1, \ldots f_m)$ is regular with $\dim(A/(f_1, \ldots f_m))=\dim(A)-m$
\label{reg local mod fs still reg loc}
\end{corollary}
\begin{proof} This follows from Lemma \ref{reg loc mod f still reg loc} by induction. One just needs to check that in $A_1=A/(f_1)$, $\mathfrak{m}_1=\mathfrak{m}/(f_1)$, we have that $f_2, \ldots f_m$ are still linearly independent in $\mathfrak{m}_1/\mathfrak{m}_1^2$. This is easy to check.
\end{proof}



\begin{theorem} Let $A_0$ be a regular local ring of dimension $n$, and consider a short exact sequence
\[0 \to I \to A_0 \to A \to 0\]
where $A$ is a ring. Note that $\spec(A)$ is a closed subset of $\spec(A_0)$ so $A$ is also local. Then the following are equivalent
\begin{enumerate}
\item $A$ is regular
\item There are elements $f_1, \ldots f_m \in I$ such that $\bar{f_1}, \ldots \bar{f_m}$ are linearly independent in $\mathfrak{m}_{A_0}/\mathfrak{m}_{A_0}^2$ where $m=n-\dim(A)$ such that $(f_1, \ldots f_m)=I$.
\end{enumerate}
\label{reg loc main thm}
\end{theorem}
\begin{proof} \textbf{(2) $\Rightarrow$ (1)} This is exactly the statement of Corollary \ref{reg local mod fs still reg loc}

\noindent \textbf{(1) $\Rightarrow$ (2)} Just as in the proof of Lemma \ref{reg loc mod f still reg loc}, i.e, using Problems 2a and 5a in Problem Set 12, we see that there is exact sequence
\[I \otimes_{A_0} A_0/\mathfrak{m}_{A_0} \to \mathfrak{m}_{A_0}/\mathfrak{m}_{A_0}^2 \to \mathfrak{m}_{A}/\mathfrak{m}_{A}^2  \to 0.\]
When we proved this in Lemma \ref{reg loc mod f still reg loc}, we used $f \in \mathfrak{m}_A$, but that still works because $I \subset \mathfrak{m}_{A_0}$ because $A_0$ is local with maximal ideal $\mathfrak{m}_{A_0}$ so all ideals are in $\mathfrak{m}_{A_0}$.

By assumption $A_0$ and $A$ are regular local, and we know $A_0/\mathfrak{m}_{A_0}=A/\mathfrak{m}_A$, because $A=A_0/I$, $\mathfrak{m}_A=\mathfrak{m}_{A_0}/I$ so
\[\dim_{A_0/\mathfrak{m}_{A_0}}(\mathfrak{m}_{A_0}/\mathfrak{m}_{A_0}^2)=\dim(A_0)=n\]
and
\[\dim_{A_0/\mathfrak{m}_{A_0}}(\mathfrak{m}_{A}/\mathfrak{m}_{A}^2)=\dim(A)\]
so the image of $I_{A_0}\otimes A_0/\mathfrak{m}_{A_0}$ in $\mathfrak{m}_{A_0}/\mathfrak{m}_{A_0}^2$ has dimension $m=n-\dim(A)$. Let $\bar{f}_1, \ldots \bar{f}_m$ be a set of linearly independent generators of $\mathfrak{m}_{A_0}/\mathfrak{m}_{A_0}^2$, and let $f_1, \ldots f_m$ be liftings to $I$.

Let $I'$ be the ideal generated by $f_1, \ldots f_m$ and consider $A'=A_0/I'$. Then by Corollary \ref{reg local mod fs still reg loc}, we know that $A'$ is a regular local ring with dimension $n-m=\dim(A)$. Also $I' \subset I$ so we have
\[0 \to J \to A' \to A \to 0\]
But Lemma \ref{reg loc means domain}, this means that it is a domain with the same dimension as $A$. But we know from Lemma \ref{local dim drop} that if we mod a domain out by a nonzero ideal, the dimension strictly drops, so since the dimensions are the same, $J=0$, so $I$ is generated by $f_1, \ldots f_m$, as desired.

\end{proof}

\subsection{Examples of regular local rings}
We now give several examples.
\begin{example} 
If $\dim(R)=0$, i.e. $R$ is artinian, then $R$ is regular iff the maximal ideal
is zero, i.e. if $R$ is a field.
\end{example} 

\begin{example} 
If $\dim(R) =1$, then it is regular iff $\mathfrak{m}$ is principal. In a
noetherian local ring, the maximal ideal is principal iff $R$ is a DVR.
This is \emph{likely} already proved in these notes. 
\end{example} 
We find:
\begin{proposition} 
A one-dimensional regular local ring is the same thing as a DVR.
\end{proposition} 

\newcommand{\maxspec}{\mathrm{MaxSpec}}
\begin{example} 
Let $R$ be  be the coordinate ring $ \mathbb{C}[x_1, \dots, x_n]/I$ of an algebraic
variety. Let $\mathfrak{m}$ be  a maximal ideal corresponding to the origin.
Then $\maxspec R \subset \spec R$ is a subvariety of $\mathbb{C}^n$, and $0$ is in this subvariety.

Then I claim:

\begin{proposition} 
$R_{\mathfrak{m}}$ is regular iff $\maxspec R$ is a smooth submanifold near $0$.
\end{proposition}
\begin{proof} 
We will show that regularity implies smoothness. The other direction is omitted.

We have a surjection $\mathbb{C}[x_1, \dots, x_n ] \twoheadrightarrow R$, with
kernel $I$. There is a maximal ideal $\mathfrak{m}' \subset \mathbb{C}[x_1,
\dots, x_n]$ defined as $(x_1, \dots, x_n)$. Then we have a surjection
\[ \mathfrak{m}'/\mathfrak{m}'^2 \twoheadrightarrow \mathfrak{m}/\mathfrak{m}^2  \]
whose kernel is $I + \mathfrak{m}'^2/\mathfrak{m}'^2 $. We find that
\[ \mathfrak{m}/\mathfrak{m}^2 = \mathfrak{m}'/(I + \mathfrak{m}'^2).  \]
Note that $\mathbb{C}[x_1, \dots, x_n]_{\mathfrak{m}'}$ is a regular local
ring of dimension $n$.

The first claim is that $R_{\mathfrak{m}}$ is regular if and only if, after
localizing the polynomial ring at the maximal ideal $\mathfrak{m}'$, the ideal
$I$ is generated by $n - \dim(R)$ functions having linearly independent
derivatives.	Granting this claim, say $I_{\mathfrak{m}'}$ is generated by
elements $f_1, \dots, f_m \in I$; then there is a map
\[ \mathbb{C}^n \stackrel{(f_1, \dots, f_m)}{\to} \mathbb{C}^m  \]
which is a submersion at the origin as the derivatives $\nabla f_i$ are
linearly independent at the origin. The implicit function theorem tells us that
the inverse image of zero, i.e. $\maxspec R$, is locally a submanifold. 

Now we need to verify the claim made earlier. Namely, we will show that
regularity of $R$ implies that $I_{\mathfrak{m}}$ is generated by elements
whose derivatives are linearly independent. However, we will postpone this
until next time.
\end{proof} 
\end{example} 


\subsection{Regular local rings look alike}
So, as we've seen, regularity corresponds to smoothness. Complex analytically,
all smooth points are the same though---they're locally manifolds.  We'd like
an algebraic version of this. The vague
claim is that all regular local rings of the same dimension ``look alike.''


Let $(R, \mathfrak{m})$ be a noetherian  local ring. Consider the graded ring
\[ S = R/\mathfrak{m} \oplus \mathfrak{m}/\mathfrak{m}^2 \oplus \dots.  \]
If we write $k = R/\mathfrak{m}$ be the residue field, it is easy to see that this is a finitely
generated $k$-algebra. If we choose elements $x_1, \dots, x_n \in
\mathfrak{m}/\mathfrak{m}^2$ generating this vector space, then they generate
$S$ as an algebra. 

\begin{proposition} 
$R$ is regular if and only if $S$ is isomorphic to the polynomial ring $k[x_1,
\dots, x_n]$, i.e. for every $f \in k[x_1, \dots, x_n]$, if $f$ maps to zero
in $S$, then $f=0$.
\end{proposition} 
\begin{proof} 
Suppose first that $k[x_1, \dots, x_n] \twoheadrightarrow S$ isn't injective.
Then there exists a $f \neq 0$ in this polynomial ring which maps to zero in
$S$. Then $S$ is not just a quotient of this polynomial ring, but a quotient of
$k[x_1, \dots, x_n]/(f) \twoheadrightarrow S$. As this is a map of graded
rings, we can assume that $f$ is homogeneous. 

In particular, the Hilbert
function of $S$ is less than or equal to the Hilbert function of $k[x_1, \dots,
x_n]/(f)$. In particular, the degree of the Hilbert function of $S$, namely
the dimension of $R$, is at most
the degree of the Hilbert function of this quotient---and quotienting by $f$
will reduce the degree of the Hilbert function so that it is $<n$. So $\dim(R) <n$.

If $S$ is isomorphic to a polynomial ring, then we can just read off what the
Hilbert function of $R$ will be, and we find that its degree is $n$.
\end{proof} 

As we have seen, regularity is equivalent to a statement about the associated
graded of $R$. Now we would like to transfer this to statements about things
closer to $R$. 

\textbf{Assume now for simplicity that the residue field of $k=R/\mathfrak{m}$
maps back into $R$.} This is always true in complex algebraic geometry, as the
residue field is just $\mathbb{C}$. Choose generators $y_1, \dots, y_m \in
\mathfrak{m}$ where $n = \dim_k \mathfrak{m}/\mathfrak{m}^2$ is the embedding
dimension. We get a map in the other direction
\[ \phi:k[y_1, \dots, y_m] \to R  \]
thanks to the section $k \to R$. This map from the polynomial ring is maybe not
an isomorphism, but if we let $\mathfrak{m} \subset R$ be the maximal ideal,
and $\mathfrak{n} = (y_1, \dots, y_m)$, the maps on associated gradeds will be
the same.

We find, by the previous result:

\begin{proposition} 
$R$ is regular iff  $\phi$ induces an isomorphism on the associated graded,
i.e. if $\mathfrak{n}^t/\mathfrak{n}^{t+1} \to
\mathfrak{m}^t/\mathfrak{m}^{t+1}$ is an isomorphism.
\end{proposition} 

That is, $\phi$ induces an isomorphism
\[ k[y_1, \dots,y_m]/\mathfrak{n}^t \simeq R/\mathfrak{m}^t  \]
for all $t$, because it is an isomorphism on the associated graded level.
So this in turn is equivalent, upon taking inverse limits, to the statement that
$\phi$ induces an isomorphism
\[ k[[y_1, \dots, y_m ]] \to \hat{R} \]
at the level of completions.

We can now conclude:
\begin{theorem} 
Let $R$ be a regular local ring of dimension $m$. Suppose $R$ contains a copy
of its residue field $k$.\footnote{I.e. there is a section of the map $R
\twoheadrightarrow R/\mathfrak{m}$.} Then $\hat{R} \simeq k[[x_1, \dots, x_m]]$.
\end{theorem} 


Let us now state this informally. First, note that:
\begin{proposition} 
For any local noetherian ring $R$, we have $\dim(R) = \dim(\hat{R})$.
\end{proposition} 
\begin{proof} 
Immediate from the expression of dimension via Hilbert polynomials.
\end{proof} 

On a similar note, the \emph{embedding dimension} of $R$ is the same as that of
the completion, because $\mathfrak{m}/\mathfrak{m}^2$ is regular.
So:
\begin{proposition} 
$R$ is regular local iff $\hat{R}$ is regular local.
\end{proposition} 

Finally:
\begin{corollary} 
A complete noetherian regular local ring that contains a copy of its residue
field $k$ is a power series ring over $k$.
\end{corollary} 

It now makes sense to say:
\begin{quote}
\textbf{All \emph{complete} regular local rings of the same dimension look
alike.} (More precisely, this is true when $R$ is assumed to contain a copy of
its residue field, but this is not a strong assumption in practice. One can
show that this will be satisfied if $R$ contains \emph{any}
field.\footnote{This is not always satisfied---take the $p$-adic integers, for instance.})
\end{quote}

We won't get into the precise statement of the general structure theorem, when
the ring is not assumed to contain its residue field, but a safe
intuition to take away from this is the above bolded statement.


\subsection{Regular local rings are domains}


Here is one nice property of regular local rings.

\begin{proposition} 
If $R$ is a regular local (noetherian, as always) ring, then $R$ is a domain.
\end{proposition} 

Geometrically, this is saying that smooth points are locally irreducible.
\begin{proof} 
Say $xy=0$ in $R$. We want to prove that one of $x,y$ is zero. Let us invoke
the Krull intersection theorem, which states that $(0) = \bigcap
\mathfrak{m}^i$. Then if $x \neq 0$, $x \in \mathfrak{m}^t -
\mathfrak{m}^{t+1}$ for some $t$. Same for $y$, if it is not zero: we can
choose $y \in \mathfrak{m}^u - \mathfrak{m}^{u+1}$. Then $x,y$ correspond to
elements $\overline{x}, \overline{y}$ in the associated graded ring (in the
$t$th and $u$th pieces) which are nonzero. Their product is nonzero in the
associated graded ring because that is a polynomial ring, hence a domain. So
$\overline{x} \overline{y} \neq 0$ in $\mathfrak{m}^{s+t}/\mathfrak{m}^{s+t+1}$.

Thus $xy \neq 0$, contradiction.

\end{proof} 

Later we will prove much more. In fact, a regular local ring is a factorial
ring. This is something we're not ready to prove yet, but one consequence of
that will be the following algebro-geometric fact. Let $X = \spec
\mathbb{C}[X_1, \dots, X_n]/I$ for some ideal $I$; so $X$ is basically a subset
of $\mathbb{C}^n$ plus some nonclosed points. Then if $X$ is smooth, we find
that $\mathbb{C}[X_1, \dots, X_n]/I$ is locally factorial. Indeed, smoothness
implies regularity, hence local factoriality. The whole apparatus of Weil and
Cartier divisors now kicks in.
\lecture{11/10}


\subsection{Regularity and algebraic geometry}
We were talking about the theory of regular local rings. Recall an assertion
made last time.

Take the ring $\mathbb{C}[X_1, \dots, X_n]$, and $\mathfrak{m} = (X_1, \dots,
X_n)$ the maximal ideal at zero. Let $R = (\mathbb{C}[X_1, \dots,
X_n]_{\mathfrak{m}})/I$ for some ideal $I$. Let $\phi: \mathbb{C}[X_1, \dots,
X_n] \to R$ be the canonical map. The maximal ideal $\mathfrak{n}$ of $R$ is
generated by $\phi(\mathfrak{m})$.

Last time, we claimed:
\begin{proposition} 
$R$ is regular local iff $I$ is generated by functions $f_1, \dots, f_m$ which
have linearly independent derivatives at zero.
\end{proposition} 

\begin{proof} 
Let's first think about what the condition of having linearly independent
derivatives means. 

If we consider $\mathbb{C}[X_1, \dots, X_n]/\mathfrak{m}$,
this is isomorphic to $\mathbb{C}$, the isomorphism being given by evaluation
at zero. 
Now $\mathfrak{m}/\mathfrak{m}^2 = \mathbb{C}^n$ having a basis given
by the images of $X_1, \dots, X_n$. A more canonical way of describing this is
as the \textbf{cotangent space} of $\mathbb{C}^n$ at the origin. The idea is
that any polynomial $f$ corresponds to the 1-form $df = \sum \frac{\partial
f}{\partial X_i} dX_i$. The evaluation of this 1-form at the origin gives a
formal linear combination of the symbols $dX_i$. It is easy to see that $df|_0$
vanishes if $f$ is constant or is in $\mathfrak{m}^2$.
Restricting to $\mathfrak{m}$, we get a map
\[ \mathfrak{m}/\mathfrak{m}^2 \to \mathbb{C}^n, \quad f \to df|_0,  \]
which is obviously an isomorphism.

Consider $f_1, \dots, f_a \in \mathfrak{m}$. We have seen that \emph{the derivatives (or gradients) are
linearly independent at the origin iff the images of $f_1, \dots, f_a$ are
linearly independent in $\mathfrak{m}/\mathfrak{m}^2$. }

If we consider $\mathbb{C}[X_1, \dots,X_n]_{\mathfrak{m}}$, last time we
mentioned that it was a regular local ring. The result will now follow from
\begin{lemma} 
Let $R $ be a quotient of a regular local ring $S$, say $R = S/I$ for some
$I$. Let $\mathfrak{m} \subset S$ be the maximal ideal. Then $R$ is regular iff
$I$ is generated by elements $f_1, \dots, f_a$ which are linearly independent
in $\mathfrak{m}/\mathfrak{m}^2$.
\end{lemma} 
\begin{proof} 
First, the easy direction. Say $I = (f_1,\dots, f_a)$ where $f_1, \dots, f_a$
are linearly independent in $\mathfrak{m}/\mathfrak{m}^2$. $S$ is regular, so
the dimension is equal to the embedding dimension of $S$. We want to show the
same thing for $R$.

Now $\dim R = \dim S/(f_1, \dots, f_a)$. We would expect that the dimension
drops by $a$; we can't immediately conclude this, but at least can argue that
\[ \dim R \geq \dim S - a  \]
by the principal ideal theorem. Let now $\mathfrak{n} \subset R$ be the maximal
ideal. The embedding dimension of $R$ is the dimension of
$\mathfrak{n}/\mathfrak{n}^2 \simeq \mathfrak{m}/(I + \mathfrak{m}^2)$. This is
a quotient of $\mathfrak{m}/\mathfrak{m}^2$, so its dimension is the dimension
of $\mathfrak{m}/\mathfrak{m}^2$ minus the image of $I$ in
$\mathfrak{m}/\mathfrak{m}^2$. This is precisely the embedding dimension of $S$
minus $a$, i.e. $\dim S - a$. We learn that
\[ \dim R \geq \dim S - a = \mathrm{embedding \ dim} R,  \]
which implies that $R$ is local, as the converse implication is true in any
noetherian local ring.

Now we want to do the converse. Say that $R$ is regular of dimension $\dim S
-a$. We want to find elements $f_1, \dots, f_a$.
So far, we know that the embedding dimension of $R$ is equal to the embedding
dimension of $S$ minus $a$. In particular,
\[ \dim \mathfrak{n}/\mathfrak{n}^2 = \dim \mathfrak{m}/(\mathfrak{m}^2+I) =
\dim \mathfrak{m}/\mathfrak{m}^2 - a.  \]
We can choose $f_1, \dots, f_a \in I$ such that their images in
$\mathfrak{m}/\mathfrak{m}^2$ are a basis for  the image of $I$. 
We have maps
\[ S \twoheadrightarrow S/(f_1, \dots, f_a) \twoheadrightarrow S/I = R.  \]
What can we say about the intermediate ring $R'=S/(f_1, \dots, f_a)$? It is
obtained from a regular local ring by killing elements linearly independent in
$\mathfrak{m}/\mathfrak{m}^2$. In particular, $R'$ is regular local of
dimension $\dim (S) -a$. 

We want to prove that $I = (f_1, \dots, f_a)$, i.e. $R = R'$. Suppose not. Then
$R  = R'/J$ for some ideal $J \neq 0$. Choose any $x \in J$ which is not zero.
Then $x$ is  a nonzerodivisor on $R'$ because $R'$ is regular. In particular, $R'/(x)$ has dimension
$\dim R' -1$. Since $R$ is a quotient of this, we have that $\dim R < \dim R' =
\dim S -a$. This is a contradiction from our earlier assumptions.
\end{proof} 
\end{proof} 


The upshot of this is that in algebraic geometry, regularity has something to
do with smoothness. 

\begin{remark}[Warning] This argument proves that if $R \simeq K[x_1, \dots,
x_n]/I$ for $K$ algebraically closed, then $R_{\mathfrak{m}}$ is regular local for some maximal ideal
$\mathfrak{m}$ if the corresponding algebraic variety is smooth at the
corresponding point. We proved this in the special case $K  = \mathbb{C}$ and
$\mathfrak{m}$ the ideal of the origin.

If $K$ is not algebraically closed, we \textbf{can't assume} that any maximal
ideal corresponds to a point in the usual sense. Moreover, if $K$ is not
perfect, regularity does \textbf{not} imply smoothness. We have not quite
defined smoothness, but here's a definition: smoothness means that the local
ring you get by base-changing $K$ to the algebraic closure is regular. So what
this means is that 
regularity of affine rings over a field $K$ is not preserved under
base-change from $K$ to $\overline{K}$. 
\end{remark} 

\begin{example} Let $K$ be non-perfect of characteristic $p$. Let $a$ not have
a $p$th root.
Consider $K[x]/(x^p -a)$. This is a regular local ring of dimension zero, i.e.
is a field. If $K$ is replaced by its algebraic closure, then we get
$\overline{K}[x]/(x^p - a)$, which is $\overline{K}[x]/(x- a^{1/p})^p$. This is
still zero-dimensional but is not a field. Over the algebraic closure, the ring
fails to be regular.
\end{example} 




\section{K\"ahler differentials}
\subsection{Derivations and K\"ahler differentials} Let $R$ be a ring with the maximal ideal
$\mathfrak{m}$. Then there is a $R/\mathfrak{m}$-vector space
$\mathfrak{m}/\mathfrak{m}^2$. This is what we would like to think of as the
``\textbf{cotangent space}'' of $\spec R$ at $\mathfrak{m}$. Intuitively, the
cotangent space is what you get by differentiating functions which vanish at
the point, but
differentiating functions that vanish twice should give zero. This is the moral
justification.

A goal might be to generalize this. What if you wanted to think about all
points at once? We'd like to describe the ``cotangent bundle'' to $\spec R$ in
an analogous way. Let's try and describe what would be a section to this
cotangent bundle. Morally, a section of $\Omega^*_{\spec R}$ should be the same
thing as a ``1-form'' on $\spec R$. We don't know what a 1-form is yet, but at
least we can give some examples. If $f \in R$, then $f$ is a ``function'' on
$\spec R$, and its ``differential'' should be a 1-form. So there should be a
``$df$'' which should be a 1-form. 

We should expect the rules $d(fg)= df+dg$ and $d(fg) = f(dg) + g(df)$ as the
usual rules of differentiation. For this to make sense, 1-forms should be an
$R$-module. 

\begin{definition} 
Let $R$ be a commutative ring, $M$ an $R$-module. A \textbf{derivation} from
$R$ to $M$ is a map $D: R \to M$ such that the two identities
\[ D(fg)= Df + Dg  \]
and
\[ D(fg) = f(Dg) + g(Df)  \]
hold.
\end{definition} 
These equations make sense as $M$ is an $R$-module.

Whatever a 1-form might be, there should be a derivation
\[ R \to \left\{\mathrm{1-forms}\right\}.  \]
An idea would be to \emph{define} the 1-forms or the ``cotangent bundle''
$\Omega_R$ by a
universal property. It should be universal among $R$-modules with a derivation.

To make this precise:
\begin{proposition} 
There is an $R$-module $\Omega_R$ and a derivation $d_{\mathrm{univ}} : R \to
\Omega_R$ satisfying the following universal property. For all $R$-modules
$M$, there is a canonical isomorphism 
\[ \hom_{R}(\Omega_R, M) \simeq \mathrm{Der}(R, M)  \]
given by composing the universal $d_{\mathrm{univ}}$ with a map $\Omega_R \to M$.
\end{proposition} 

That is, any derivation $d: R \to M$ factors through this universal derivation
in a unique way. Given $d: R \to M$, we can make the following diagram
commutative in a natural way:
\[ 
\xymatrix{
R \ar[r]^d \ar[d]  &  M \\
\Omega_R \ar[ru]^{d_{\mathrm{univ}}}
}
\]

\begin{definition} 
$\Omega_R$ is called the module of \textbf{K\"ahler differentials} of $R$.
\end{definition} 

Let us now verify this proposition.
\begin{proof} 
This is like the verification of the tensor product. Namely, build a free
gadget and quotient out by whatever you need.

Let $\Omega_R$ be the quotient of the free $R$-module generated by elements
$da$ for $a \in R$ by enforcing the relations
\begin{enumerate}
\item $d(a+b) =da + db$. 
\item $d(ab) = adb + bda$.
\end{enumerate}
By construction, the map $a \to da$ is a derivation $R \to \Omega_R$. 
It is easy to see that is universal. Given a derivation $d: R \to M$, we get a
map $\Omega_R \to M$ sending $da \to d(a), a \in R$.
\end{proof} 

We are going to need a slight variant.

\subsection{Relative differentials}
\begin{definition} 
Let $f: R \to R'$ be a ring-homomorphism. Let $M$ be an $R'$-module. A
derivation $d: R' \to M$ is \textbf{$R$-linear if $d(f(a)) = 0, a \in R$.}
This is equivalent to saying that $d$ is an $R$-homomorphism by the Leibnitz
rule.
\end{definition} 

\begin{proposition} 
There is a universal $R$-linear derivation $R'
\stackrel{d_{\mathrm{univ}}}{\to} \Omega_{R'/R}$.
\end{proposition} 
\begin{proof} 
Use the same construction as in the absolute case. We get a map $R' \to
\Omega_{R'}$ as before. This is not generally $R$-linear, so you have to
quotient out by the images of $d(f(b)), b \in R$.
\end{proof} 

\begin{remark} 
We see that $\Omega_{R'/R}$ as in the proposition is obtained by killing the
images of $d(f(b)), b \in R$. 
\end{remark} 

\begin{definition} 
This is called the module of \textbf{relative K\"ahler differentials.}
\end{definition} 

\begin{theorem} 
There is a canonical exact sequence of $R'$-modules
\[ R' \otimes_R \Omega_R \to \Omega_{R'} \to \Omega_{R'/R} \to 0.  \]
\end{theorem} 
This is generally not exact on the left.
\begin{proof} 
This follows from the remark. 
\end{proof} 

\subsection{Examples} Let us do some examples to make this more concrete.

\begin{example} 
Let $R' = \mathbb{C}[x_1, \dots, x_n], R = \mathbb{C}$. In this case, the claim
is that there is an isomorphism
\[ \Omega_{R'/R} \simeq R'^n.  \]
More precisely, $\Omega_{R'/R}$ is free on $dx_1, \dots,dx_n$. So the cotangent
bundle is ``free.''

\begin{proof} 
The construction $f \to \left( \frac{\partial f}{\partial x_i}  \right)$ gives
a map $R' \to R'^n$. By elementary calculus, this is a derivation, even an
$R$-linear derivation.  We get a map
\[ \phi:\Omega_{R'/R} \to R'^n  \]
by the universal property of the K\"ahler differentials. The claim is that this
map is an isomorphism. The map is characterized by sending $df$ to $\left(
\frac{\partial f}{\partial x_i}\right)$. Note that $dx_1, \dots, dx_n$ map to a
basis of $R'^n$ because differentiating $x_i$ gives 1 at $i$ and zero at $j
\neq i$. So we see that $\phi$ is surjective. 

There is a map $\psi: R'^n \to \Omega_{R'/R}$ sending $\left(a_i  \right)$ to
$\sum a_i dx_i$. It is easy to check that $\phi \circ \psi = 1$ from the
definition of $\phi$. What we still need to show is that $\psi \circ \phi =1$.
Namely, for any $f$, we want to show that $\psi \circ \phi(df) = df$ for $f \in
R'$. This is precisely the claim that $df = \sum \frac{\partial f}{\partial
x_i} dx_i$. Both sides are additive in $f$, indeed are derivations, and
coincide on monomials of degree one, so they are equal.
\end{proof} 

\end{example} 
\lecture{11/12}

\subsection{Formal properties of K\"ahler differentials}
So we were talking about K\"ahler differentials yesterday. Recall that if
$\phi: A \to B$ is a map of rings, we can define a $B$-module
\[ \Omega_{B/A} = \mathrm{generated \ by } \ dx|_{x \in
B}/\left\{d(x+y) = dx+dy, d(a)=0 \ \forall a \in A, d(xy) = xdy + ydx\right\}. \]
By construction, $\Omega_{B/A}$ is the receptacle from the universal $A$-linear
derivation into a $B$-module.

Let $A \to B \to C$ be a map of rings. There is an obvious map $dx \to dx$
\[ \Omega_{C/A} \to \Omega_{C/B}  \]
where both sides have the same generators, except with a few additional
relations on $\Omega_{C/B}$. We have to quotient by $db, b \in B$. In
particular, there is a map $\Omega_{B/A} \to \Omega_{C/A}$, $dx \to dx$, whose images
generates the kernel. This induces a map
\[ C \otimes_B \Omega_{B/A} \to \Omega_{C/A}.  \]
We have proved:
\begin{proposition} Given a sequence $A \to B \to C$ of rings, there is an exact sequence 
\[  C \otimes_B \Omega_{B/A} \to \Omega_{C/A} \to \Omega_{C/B} \to 0 .\]
\end{proposition} 
Let us list another property. Last time, we showed:
\begin{proposition} 
If $R$ is a ring, then 
\[ \Omega_{R[x_1, \dots, x_n]/R} = R[x_1, \dots,x_n]^n.  \]
\end{proposition} 

Finally, let us look at the K\"ahler differentials for quotient rings. Let $A
\to  B$ be a  homomorphism of rings and $I \subset B $ an ideal. We would like
to describe $\Omega_{B/I/A} $. There is a map
\[ \Omega_{B/A} \to \Omega_{B/I/A}  \]
sending $dx$ to $d \overline{x}$ for $\overline{x}$ the reduction of $x$ in
$B/I$. This is surjective on generators, so it is surjective. It is not
injective, though. In $\Omega_{B/I/A}$, the generators $dx, dx'$ are identified
if $x \equiv x' \mod I$.  Moreover, $\Omega_{B/I/A}$ is a 
$B/I$-module. 
This means that there will be additional relations for that. To remedy this, we
can tensor and consider the morphism
\[ \Omega_{B/A} \otimes_B B/I \to \Omega_{B/I/A} \to 0.  \]

Let us now define a map 
\[ \phi: I /I^2 \to \Omega_{B/A} \otimes_B B/I,  \]
which we claim will generate the kernel. Given $x \in I$, we define $\phi(x) =
dx$. If $x \in I^2$, then $dx \in I \Omega_{B/A}$ so $\phi$ is indeed a map of
abelian groups
$I/I^2 \to \Omega_{B/A} \otimes_B B/I$. Let us check that this is a
$B/I$-module homorphism. We would like to check that $\phi(xy) = y \phi(x)$
for $x \in I$ in
$\Omega_{B/A}/I \Omega_{B/A}$. This follows from the Leibnitz rule, $\phi(xy) =
y \phi(x) + xdy \equiv x \phi(x) \mod I \Omega_{B/A}$. So $\phi$ is also
defined. Its image is the submodule of $\Omega_{B/A}/I \Omega_{B/A}$ generated
by $dx, x \in I$. This is precisely what one has to quotient out by to get
$\Omega_{B/I/A}$. In particular:

\begin{proposition} Let $B$ be an $A$-algebra and $I \subset B$ an ideal.
There is an exact sequence
\[ I/I^2 \to \Omega_{B/A} \otimes_B B/I \to \Omega_{B/I/A} \to 0.  \]
\end{proposition} 

These results will let us compute the module of K\"ahler differentials in cases
we want.

\begin{example} 
Let $B = A[x_1, \dots, x_n]/I$ for $I$ an ideal. We will compute $\Omega_{B/A}$.

First, $\Omega_{A[x_1, \dots, x_n]/A} \otimes B \simeq B^n$ generated by
symbols $dx_i$. There is a surjection of
\[ B^n \to \Omega_{B/A} \to 0  \]
whose kernel is generated by $dx, x \in I$, by the second exact sequence above.
If $I = (f_1, \dots, f_m)$, then the kernel is generated by 
$\left\{df_i\right\}$.
It follows that $\Omega_{B/A}$ is the cokernel of the map
\[ B^m \to B^n  \]
that sends the $i$th generator of $B^m$ to $df_i$ thought of as an element in
the free $B$-module $B^n$ on generators $dx_1, \dots, dx_n$. Here, thanks to
the Leibnitz rule, $df_i$ is
given by formally differentiating the polynomial, i.e.
\[ df_i = \sum_j \frac{\partial f_i}{\partial x_j} dx_j. \] We have thus
explicitly represented $\Omega_{B/A}$ as the cokernel of the matrix $\left(
\frac{\partial f_i}{\partial x_j}\right)$.
\end{example} 

Last time, we were talking about the connection of K\"ahler differentials and
the cotangent bundle.
\begin{example} 
Let $R = \mathbb{C}[x_1, \dots, x_n]/I$ be the coordinate ring of an algebraic
variety. Let $\mathfrak{m} \subset R$ be the maximal ideal. Then 
$\Omega_{R/\mathbb{C}}$ is what you should think of as containing information
of the cotangent bundle of $\spec R$. You might ask what the fiber over a point
$\mathfrak{m} \in \spec R$ is, though. That is, we might ask what
\[ \Omega_{R/\mathbb{C}} \otimes_R R/\mathfrak{m}  \]
is. To see this, we note that there are maps
\[ \mathbb{C} \to R \to R/\mathfrak{m} \simeq \mathbb{C}.  \]
There is now an exact sequence by our general properties
\[ \mathfrak{m}/\mathfrak{m}^2 \to \Omega_{R/\mathbb{C}} \otimes_R
R/\mathfrak{m} \to \Omega_{\mathbb{R}/\mathfrak{m}/\mathbb{C}} \to 0  \]
where the last thing is zero as $R/\mathfrak{m} \simeq \mathbb{C} $ by the
Nullstellensatz.
The upshot is that $\Omega_{R/\mathbb{C}} \otimes_R R/\mathfrak{m}$ is a
quotient of $\mathfrak{m}/\mathfrak{m}^2$. Let's leave it there for now.
\end{example} 

\subsection{K\"ahler differentials for fields}

Let us start with the simplest examples---fields.

\begin{example} 
Let $k$ be a field, $k'/k$ an extension. 
\begin{question} 
What does $\Omega_{k'/k}$ look like? When does it vanish?
\end{question} 
$\Omega_{k'/k}$ is a $k'$-vector space.

\begin{proposition} 
Let $k'/k$ be a separable algebraic extension of fields. Then $\Omega_{k'/k} = 0$.
\end{proposition} 
\begin{proof} 
We will need a formal property of K\"ahler differentials that is easy to check,
namely that they are compatible with filtered colimits. If $B = \varinjlim
B_\alpha$ for $A$-algebras $B_\alpha$, then there is a canonical isomorphism
\[ \Omega_{B/A} \simeq \varinjlim \Omega_{B_{\alpha}/A}.  \]
One can check this on generators and relations, for instance.

Given this, we can reduce to the case of $k'/k$ finite and separable. 
\begin{remark} 
Given a sequence of fields and morphisms $k \to k' \to k''$, then there is an
exact sequence
\[ \Omega_{k'/k} \otimes k'' \to \Omega_{k''/k} \to \Omega_{k''/k'} \to 0.  \]
In particular, if $\Omega_{k'/k} = \Omega_{k''/k'} =0 $, then $\Omega_{k''/k} =
0$. This is a kind of d\'evissage argument.
\end{remark} 

Anyway, recall that we have a finite separable extension $k'/k$ where $k' =
k(x_1, \dots, x_n)$.\footnote{We can take $n=1$ by the primitive element
theorem, but shall not need this.} We will show that
\[ \Omega_{k(x_1, \dots, x_i)/k(x_1, \dots, x_{i-1})} =0 \quad \forall i,  \]
which will imply by the devissage argument that $\Omega_{k'/k} = 0$.
In particular, we are reduced to showing the proposition when $k'$ is generated
over $k$ by a \emph{single element} $x$. Then we have that
\[ k' \simeq k[X]/(f(X))  \]
for $f(X)$ an irreducible polynomial. Set $I = (f(X))$. We have an exact sequence
\[ I/I^2 \to \Omega_{k[X]/k} \otimes_{k[X]} k' \to \Omega_{k'/k} \to 0 \]
The middle term is a copy of $k'$ and the first term is isomorphic to $k[X]/I
\simeq k'$. So there is an exact sequence
\[ k' \to k' \to \Omega_{k'/k} \to 0.  \]
The first term is, as we have computed, multiplication by $f'(x)$; however
this is nonzero by separability. Thus we find that $\Omega_{k'/k} =0$.
\end{proof} 
\end{example} 

\begin{remark} 
The above result is \textbf{not true} for inseparable extensions in general. 
\end{remark} 
\begin{example} 
Let $k$ be an imperfect field of characteristic $p>0$. There is $x \in k$ such
that $x^{1/p} \notin k$, by definition. Let $k' = k(x^{1/p})$. As a ring, this
looks like
$k[t]/(t^p - x)$. In writing the exact sequence, we find that $\Omega_{k'/k} =
k'$ as this is the cokernel of the map $k' \to k'$ given by multiplication
$\frac{d}{dt}|_{x^{1/p}} (t^p - x)$. That polynomial has identically vanishing
derivative, though. We find that a generator of $\Omega_{k'/k}$ is $dt$ where
$t$ is a $p$th root of $x$, and $\Omega_{k'/k } \simeq k$.
\end{example} 

Now let us consider transcendental extensions. Let $k' = k(x_1, \dots, x_n)$ be
a purely transcendental extension, i.e. the field of rational functions of
$x_1, \dots, x_n$.

\begin{proposition} 
If $k' = k(x_1, \dots, x_n)$, then $\Omega_{k'/k}$ is a free $k'$-module on the
generators $dx_i$.
\end{proposition} 
\begin{proof} 
We already know this for the polynomial ring $k[x_1, \dots, x_n]$. However, the
rational function field is just a localization of the polynomial ring at the
zero ideal.  So the result will follow from:
\end{proof} 

\begin{proposition} 
Let $f: A \to B$ be a map of rings. Let $S \subset  B$ be multiplicatively
closed. Then the natural map
\[ S^{-1}\Omega_{B/A} \to \Omega_{S^{-1}B/A}  \]
is an isomorphism.
\end{proposition} 
So the formation of K\"ahler differentials commutes with localization.

\begin{proof} 
We could prove this by the calculational definition, but perhaps it is better
to prove it via the universal property. If $M$ is any $S^{-1}B$-module, then 
we can look at 
\[ \hom_{S^{-1}B}( \Omega_{S^{-1}B/A}, M)  \]
which is given by the group of $A$-linear derivations $S^{-1}B \to M$, by the
universal property. 

On the other hand, 
\[ \hom_{S^{-1}B}( S^{-1} \Omega_{B/A}, M)  \]
is the same thing as the set of $B$-linear maps $\Omega_{B/A} \to M$, i.e. the
set of $A$-linear derivations $B \to M$. 

We want to show that these two are the same thing. Given an $A$-derivation
$S^{-1}B \to M$, we get an $A$-derivation $B \to M$ by pulling back. We want to
show that any $A$-linear derivation $B \to M$ arises in this way. So we need to
show that any $A$-linear derivation $d: B \to M$ extends uniquely to an $A$-linear
$\overline{d}: S^{-1}B \to M$.
Here are two proofs:
\begin{enumerate}
\item (Lowbrow proof.) For $x/s \in S^{-1}B$, with $x \in B, s \in S$, we
define $\overline{d}(x/s) = dx/s - xds/s^2$ as in calculus. The claim is that
this works, and is the only thing that works. One should check
this---\textbf{exercise}.
\item (Highbrow proof.) We start with a digression. Let $B$ be a commutative
ring, $M$ a $B$-module. Consider $B \oplus M$, which is a  $B$-module. We can
make it into a ring (via \textbf{square zero multiplication}) by multiplying
\[ (b,x)(b',x') = (bb', bx'+b'x).  \]
This is compatible with the $B$-module structure on $M \subset B \oplus
M$. Note that $M$ is an ideal in this ring with square zero.  Then the
projection $\pi: B \oplus M \to B$ is a ring-homomorphism as well.
There is also a ring-homomorphism in the other direction $b \to (b,0)$, which
is a section of $\pi$. There may be other homomorphisms $B \to B \oplus M$.

You might ask what all the right inverses to $\pi$ are, i.e. ring-homomorphisms
$\phi:  B \to B \oplus M $ such that $\pi \circ \phi = 1_{B}$. This must be of
the form $\phi: b \to (b, db)$ where $d: B \to M$ is some map. It is easy to check
that $\phi$ is a homomorphism precisely when $d$ is a derivation.

Suppose now $A \to B$ is a morphism of rings making $B$ an $A$-algebra. Then
$B \oplus M$ is an $A$-algebra via the inclusion $a \to (a, 0)$. Then
you might ask when $\phi: b \to (b, db), B \to B \oplus M$ is an
$A$-homomorphism. The answer is clear: when $d$ is an $A$-derivation.

Recall that we were in the situation of $f: A \to B$  a morphism of rings, $S
\subset B$ a multiplicatively closed subset, and $M$ an $S^{-1}B$-module. The
claim was that any $A$-linear derivation $d: B \to M$ extends uniquely to
$\overline{d}: S^{-1} B \to M$.
We can draw a diagram
\[ \xymatrix{
& B \oplus M \ar[d] \ar[r] &  S^{-1}B \oplus M \ar[d] \\
A \ar[r] &  B \ar[r] &  S^{-1}B
}.\]
This is a cartesian diagram. So given a section of $A$-algebras $B \to B \oplus M$, we have to
construct a section of $A$-algebras $S^{-1}B \to S^{-1}B \oplus M$. We can do this by the
universal property of localization, since $S$ acts by invertible elements on
$S^{-1}B \oplus M$. (To see this, note that $S$ acts by invertible elements on
$S^{-1}B$, and $M$ is a nilpotent ideal.)
\end{enumerate}
\end{proof} 
\lecture{11/15}

\subsection{Continuation of field theory}

We have been talking about the theory of regular local rings, and more recently
about K\"ahler differentials. Last time, we showed:

\begin{proposition} 
If $L/K$ is a separable algebraic field extension, then $\Omega_{L/K} = 0$.
\end{proposition} 

Furthermore:

\begin{proposition} 
If $L/K$ is a finitely generated purely transcendental extension $K(x_1, \dots, x_n)$, then 
\[ \Omega_{L/K} = L^n = \bigoplus L dx_i.  \]
More generally, this is true for an infinitely generated transcendental
extension. In this case, $\Omega_{L/K}$ is a free vector space on a
transcendence basis.
\end{proposition} 
The only thing we did not already prove is the infinite case, which follows as
K\"ahler differentials are compatible with filtered colimits.

We can deduce from this:
\begin{corollary} 
Let $L/K$ be a field extension of fields of char 0. Then 
\[ \dim_L \Omega_{L/K} = \mathrm{trdeg}(L/K).  \]
\end{corollary} 
\begin{proof}[Partial proof] 
Put the above two facts together. Choose a transcendence basis $\{x_\alpha\}$
for $L/K$. This means that $L$ is algebraic over $K(\left\{x_\alpha\right\})$
and the $\left\{x_\alpha\right\}$ are algebraically independent.
Moreover $L/K(\left\{x_\alpha\right\})$ is \emph{separable} algebraic.  Now let
us use a few things about these cotangent complexes. There is an exact sequence:
\[ \Omega_{K(\left\{x_\alpha\right\})}
\otimes_{K(\left\{x_\alpha\right\})} L \to \Omega_{L/K} \to \Omega_{L/K(\left\{x_\alpha\right\})}  \to 0 \]
The last thing is zero, and we know what the first thing is; it's free on the
$dx_\alpha$. So we find that $\Omega_{L/K}$ is generated by
the elements $dx_\alpha$. If we knew that the $dx_\alpha$ were linearly
independent, then we would be done. But we don't, yet. 
\end{proof}

This is \textbf{not true} in characteristic $p$. If $L = K(\alpha^{1/p})$ for
$\alpha \in K$ and $\alpha^{1/p} \notin K$, then $\Omega_{L/K} \neq 0$.

\subsection{Regularity, smoothness, and K\"ahler differentials}
From this, let us revisit a statement made last time. 
Let $K$ be an algebraically closed field, let $R = k[x_1, \dots, x_n]/I$ and
let $\mathfrak{m} \subset R$ be a maximal ideal. Recall that the
Nullstellensatz implies that $R/\mathfrak{m} \simeq k$. We were studying 
\[ \Omega_{R/k}.  \]
This is an $R$-module, so $\Omega_{R/k} \otimes_R k$ makes sense. There is a
surjection
\[ \mathfrak{m}/\mathfrak{m}^2 \to \Omega_{R/k} \otimes_R k \to 0,  \]
that sends $x \to dx$.
\begin{proposition} 
This map is an isomorphism.
\end{proposition} 
\begin{proof} 
We construct a map going the other way. Call the map $\mathfrak{m}/\mathfrak{m}^2 \to
\Omega_{R/k} \otimes_R k$ as $\phi$. We want to construct
\[ \psi: \Omega_{R/k} \otimes_R k \to \mathfrak{m}/\mathfrak{m}^2.  \]
This is equivalent to giving an $R$-module map 
\[ \Omega_{R/k} \to \mathfrak{m}/\mathfrak{m}^2,  \]
that is a derivation $\partial: R \to \mathfrak{m}/\mathfrak{m}^2$. This acts
via $\partial(\lambda + x) = x$ for $\lambda \in k, x \in \mathfrak{m}$. Since
$k+\mathfrak{m} = R$, this is indeed well-defined. We must check that
$\partial$ is a derivation. That is, we have to compute
$\partial((\lambda+x)(\lambda' + x'))$.
But this is 
\[ \partial(\lambda\lambda' + (\lambda x' + \lambda' x) + xx').  \]
The definition of $\partial$ is to ignore the constant term and look at the
nonconstant term mod $\mathfrak{m}^2$. So this becomes
\[ \lambda x' + \lambda' x = (\partial (\lambda+x)) (x'+\lambda') + (\partial (\lambda'+
x')) (x+\lambda)  \]
because $xx' \in \mathfrak{m}^2$, and because $\mathfrak{m}$ acts trivially on
$\mathfrak{m}/\mathfrak{m}^2$. Thus we get the map $\psi$ in the inverse
direction, and one checks that $\phi, \psi$ are inverses. This is because
$\phi$ sends $x \to dx$ and $\psi$ sends $dx \to x$.
\end{proof} 

\begin{corollary} 
Let $R$ be as before. Then $R_{\mathfrak{m}}$ is regular iff $\dim
R_{\mathfrak{m}} = \dim_k \Omega_{R/k} \otimes_R R/\mathfrak{m}$.
\end{corollary} 
In particular, the modules of K\"ahler differentials detect regularity for
certain rings.

\begin{definition} 
Let $R$ be a noetherian ring. We say that $R$ is \textbf{regular} if
$R_{\mathfrak{m}}$ is regular for every maximal ideal $\mathfrak{m}$. (This
actually implies that $R_{\mathfrak{p}}$ is regular for all primes
$\mathfrak{p}$, though we are not ready to see this. It will follow from the
fact that the localization of a regular local ring at a prime ideal is regular.)
\end{definition} 

Let $R = k[x_1, \dots, x_n]/I$ be an affine ring over an algebraically closed
field $k$. 
Then:

\begin{proposition} 
TFAE:
\begin{enumerate}
\item $R$ is regular. 
\item ``$R$ is smooth over $k$'' (to be defined)
\item  $\Omega_{R/k}$ is  a projective module over $R$ of rank $\dim R$.
\end{enumerate}
\end{proposition} 
A finitely generated projective module is locally free. So the last statement is that
$(\Omega_{R/k})_{\mathfrak{p}}$ is free of rank $\dim R$ for each prime
$\mathfrak{p}$.

\begin{remark} 
A projective module does not necessarily have a well-defined rank as an integer. For
instance, if $R = R_1 \times R_2$ and $M = R_1 \times 0$, then $M$ is a summand
of $R$, hence is projective. But there are two candidates for what the rank
should be. The problem is that $\spec R$ is disconnected into two pieces, and
$M$ is of rank one on one piece, and of rank zero on the other.
But in this case, it does not happen.
\end{remark}

\begin{remark} 
The smoothness condition states that locally on $\spec R$, we have an isomorphism with
$k[y_1, \dots, y_n]/(f_1, \dots, f_m)$ with the gradients $\nabla f_i$ linearly
independent. Equivalently, if $R_{\mathfrak{m}}$ is the localization of $R$ at
a maximal ideal  $\mathfrak{m}$, then $R_{\mathfrak{m}}$ is a regular local
ring, as we have seen.
\end{remark} 

\begin{proof} 
We have already seen that 1 and 2 are equivalent. The new thing is that they
are equivalent to 3. First, assume 1 (or 2). 
First, note that $\Omega_{R/k}$ is a finitely generated $R$-module; that's a general
observation:

\begin{proposition} 
If $f: A \to B$ is a map of rings that makes $B$ a finitely generated $A$-algebra, then
$\Omega_{B/A}$ is a finitely generated $B$-module.
\end{proposition} 
\begin{proof} 
We've seen this is true for polynomial rings, and we can use the exact
sequence. If $B$ is a quotient of a polynomial ring, then $\Omega_{B/A}$ is a
quotient of the K\"ahler differentials of the polynomial ring.
\end{proof} 
Return to the main proof. In particular, $\Omega_{R/k}$ is projective if and
only if $(\Omega_{R/k})_{\mathfrak{m}}$ is projective for every maximal ideal
$\mathfrak{m}$.  According to the second assertion, we have that
$R_{\mathfrak{m}}$ looks like $(k[y_1, \dots, y_n]/(f_1, \dots,
f_m))_{\mathfrak{n}}$ for some maximal ideal $\mathfrak{n}$, with the
gradients $\nabla f_i$ linearly independent. Thus
$(\Omega_{R/k})_{\mathfrak{m}} = \Omega_{R_{\mathfrak{m}}/k}$ looks like the cokernel of 
\[ R_{\mathfrak{m}}^m \to R_{\mathfrak{m}}^n  \]
where the map is multiplication by the Jacobian matrix $\left(\frac{\partial
f_i}{\partial y_j}  \right)$. By assumption this matrix has full rank. We see
that there is a left inverse of the reduced  map $k^m \to k^n$. 
We can lift this to a map $R_{\mathfrak{m}}^n \to R_{\mathfrak{m}}^m$. Since
this is a left inverse mod $\mathfrak{m}$, the composite is at least an
isomorphism (looking at determinants). Anyway, we see that $\Omega_{R/k}$ is
given by the cokernel of a map of free module that splits, hence is projective.
The rank is $n-m = \dim R_{\mathfrak{m}}$.

Finally, let us prove that 3 implies 1. Suppose $\Omega_{R/k}$ is projective of
rank $\dim R$. So this means that $\Omega_{R_{\mathfrak{m}}/k}$ is free of
dimension $\dim R_{\mathfrak{m}}$. But this implies that $(\Omega_{R/k})
\otimes_R R/\mathfrak{m}$ is free of the appropriate rank, and that is---as we
have seen already---the embedding dimension $\mathfrak{m}/\mathfrak{m}^2$. So
if 3 holds, the embedding dimension equals the usual dimension, and we get
regularity.
\end{proof} 

\begin{corollary} 
Let $R = \mathbb{C}[x_1, \dots, x_n]/\mathfrak{p}$ for $\mathfrak{p}$ a prime.
Then there is a nonzero $f \in R$ such that $R[f^{-1}]$ is regular.
\end{corollary} 
Geometrically, this says the following. $\spec R$ is some algebraic variety,
and $\spec R[f^{-1}]$ is a Zariski open subset. What we are saying is that, in
characteristic zero, any algebraic variety has a nonempty open smooth locus.
The singular locus is always smaller than the entire variety.

\begin{proof} 
$\Omega_{R/\mathbb{C}}$ is a finitely generated $R$-module. Let $K(R) $ be the fraction field of $R$.
Now
\[ \Omega_{R/\mathbb{C}} \otimes_R K(R) = \Omega_{K(R)/\mathbb{C}}  \]
is a finite $K(R)$-vector space. The dimension is
$\mathrm{trdeg}(K(R)/\mathbb{C})$. That is also $d=\dim R$, as we have seen.
Choose elements $x_1, \dots, x_d \in \Omega_{R/\mathbb{C}}$ which form a basis
for $\Omega_{K(R)/\mathbb{C}}$. There is a map
\[ R^d \to \Omega_{R/\mathbb{C}}  \]
which is an isomorphism after localization at $(0)$. This implies that there is
$f \in R$ such that the map is an isomorphism after localization at
$f$.\footnote{There is an inverse defined over the fraction field, so it is
defined over some localization.} We find that $\Omega_{R[f^{-1}]/\mathbb{C}}$
is free of rank $d$ for some $f$, which is what we wanted.
\end{proof} 

This argument works over any algebraically closed field of characteristic
zero, or really any field of characteristic zero.
\begin{remark}[Warning] Over imperfect fields in characteristic $p$, two things can happen:
\begin{enumerate}
\item Varieties need not be generically smooth 
\item $\Omega_{R/k}$ can be projective with the wrong rank
\end{enumerate}
(Nothing goes wrong for \textbf{algebraically closed fields} of characteristic
$p$.)
\begin{example} 
Here is a dumb example. Say $R = k[y]/(y^p-x)$ where $x \in K$ has no $p$th
root. We know that $\Omega_{R/k}$ is free of rank one. However, the rank is
wrong: the variety has dimension zero.
\end{example} 
\end{remark} 
\lecture{11/17}

Last time, were trying to show that $\Omega_{L/K}$ is free on a transcendence
basis if $L/K$ is an extension in characteristic zero. So we had a tower of fields
\[ K \to K' \to L,  \]
where $L/K'$ was separable algebraic. 
We claim in this case that
\[ \Omega_{L/K} \simeq \Omega_{K'/K} \otimes_{K'} L.  \]
This will prove the result. But we had not done this yesterday.
\begin{proof} 
This doesn't follow directly from the previous calculations. Without loss of generality, $L$ is
finite over $K'$, and in particular, $L = K'[x]/(f(x))$ for $f$ separable. The claim is that
\[ \Omega_{L/K} \simeq (\Omega_{K'/K}\otimes_{K'}L \oplus K' dx)/f'(x)dx + \dots  \]
When we kill the vector $f'(x) dx + \dots$, we kill the second component. 
\end{proof} 



