\chapter{Flatness revisited}

In the past, we have already encountered the notion of \emph{flatness}. We
shall now study it in more detail.
We shall start by introducing the notion of \emph{faithful} flatness and
introduce the idea of ``descent.'' Later, we shall consider other criteria for
(normal) flatness that we have not yet explored.

We recall (\cref{flatdefn}) that a module $M$ over a commutative ring $R$ is
\emph{flat} if the functor $N \mapsto N \otimes_R M$ is an exact functor. An
$R$-algebra is flat if it is flat as a module. For instance, we have seen that
any localization of $R$ is a flat algebra, because localization is an exact
functor.

\textbf{All this has not been added yet!}

\section{Faithful flatness}



\subsection{Faithfully flat modules}
Let $R$ be a commutative ring.

\begin{definition} 
The $R$-module $M$ is \textbf{faithfully flat} if  any complex $N' \to N
\to N''$ of $R$-modules is exact if and only if the tensored sequence $N'
\otimes_R M \to N \otimes_R M \to N'' \otimes_R M$ is exact.
\end{definition} 

Clearly, a faithfully flat module is flat.


\begin{example} 
The direct sum of faithfully flat modules is faithfully flat.
\end{example} 
\begin{example} 
A (nonzero)  free module is faithfully flat, because $R$ itself is flat
(tensoring with $R$ is the identity functor).
\end{example} 

We shall now prove several useful criteria about faithfully flat modules.

\begin{proposition}  \label{easyffcriterion}
An $R$-module $M$ is faithfully flat if and only if it is flat and if $M
\otimes_R N = 0$ implies $N=0$ for any $N$.
\end{proposition} 
\begin{proof} Suppose $M$ f.f.
Then $M$ is flat, clearly. In addition, if $N$ is any $R$-module, consider the
sequence
\[ 0 \to N \to 0;  \]
it is exact if and only if
\[ 0 \to M \otimes_R N \to 0  \]
is exact. Thus $N=0$ if and only if $M \otimes_R N = 0$.

Conversely, suppose $M$ is flat and satisfies the additional condition. We
need to show that if $N'
\otimes_R M \to N \otimes_R M \to N'' \otimes_R M$ is exact, so is $N' \to N
\to N''$. Since $M$ is flat, taking homology commutes with tensoring with $M$.
In particular, if $H$ is the homology of $N' \to N \to N''$, then $H \otimes_R
M$ is the homology of 
$N'
\otimes_R M \to N \otimes_R M \to N'' \otimes_R M$. It follows that $H
\otimes_R M = 0$, so $H=0$, and the initial complex is exact.
\end{proof} 

\begin{example} 
Another illustration of the above technique is the following observation: if
$M$ is faithfully flat and $N \to N'$ is any morphism, then $N \to N'$ is an
isomorphism if and only if $M \otimes N' \to M \otimes N$ is an isomorphism.
This follows because the condition that a map be an isomorphism can be phrased
as the exactness of a certain (uninteresting) complex.
\end{example} 
\begin{exercise} 
The direct sum of a flat module and a faithfully flat module is faithfully flat.
\end{exercise} 


From the above result, we can get an important example of a faithfully flat
algebra over a ring.
\begin{example} 
Let $R$ be a commutative ring, and $\left\{f_i\right\}$ a finite set of
elements that generate the unit ideal in $R$ (or equivalently, the basic open
sets $D(f_i) = \spec R_{f_i}$ form a covering of $\spec R$). 
Then the algebra $\prod R_{f_i}$ is faithfully flat over $R$ (i.e., is so as a
module). Indeed, as a
product of localizations, it is certainly flat.

So by \cref{easyffcriterion}, we are left with showing that if $M$ is any
$R$-module and $M_{f_i} =0 $ for all $i$, then $M = 0$. 
Fix $m \in M$, and consider the ideal $\ann(m)$ of elements annihilating $m$.
Since $m$ maps to zero in each localization $M_{f_i}$, there is a power of
$f_i$ in $\ann(m)$ for each $i$. 
This easily implies that $\ann(m) = R$, so $m=0$. (We used the fact that if the
$\left\{f_i\right\}$ generate the unit ideal, so do $\left\{f_i^N\right\}$ for
any $N \in \mathbb{Z}_{\geq 0}$.)
\end{example} 

A functor $F$ between two categories is said to be \textbf{faithful} if the
induced map on the hom-sets $\hom(x,y) \to \hom(Fx, Fy)$ is always injective.
The following result explains the use of the term ``faithful.''

\begin{proposition} 
A module $M$ is f.f. if and only if it is flat and the functor $N \to N
\otimes_R M$ is faithful.
\end{proposition} 
\begin{proof} Let $M$ be flat.
We need to check that $M$ is f.f. if and only if the natural map
\[ \hom_R(N, N') \to \hom_R(N \otimes_R M, N' \otimes_R M)  \]
is injective.
Suppose first $M$ is faithfully flat and $f: N \to N'$ goes to zero $f \otimes
1_M: N \otimes_R M \to  N' \otimes_R M$. We know by flatness that
\[ \im(f) \otimes_R M = \im(f \otimes 1_M)  \]
so that if $f \otimes 1_M = 0$, then $\im(f) \otimes M = 0$. Thus by faithful
flatness, $\im(f) = 0$ by \rref{easyffcriterion}.

Conversely, let us suppose $M$ flat and the functor $N \to N \otimes_R M$
faithful. Let $N \neq 0$; then $1_N \neq 0$ as maps $N \to N$. 
It follows that $1_N \otimes 1_M$ and $0 \otimes 1_M = 0$ are different as
endomorphisms of $M \otimes_R N$. Thus $M \otimes_R N \neq 0$. By
\rref{easyffcriterion}, we are done again.
\end{proof} 


Finally, we prove one last criterion:

\begin{proposition} \label{ffmaximal} 
$M$ is f.f. if and only if $M$ is flat and $\mathfrak{m}M \neq M$ for all
maximal ideals $\mathfrak{m} \subset R$.
\end{proposition} 
\begin{proof} 
If $M$ is f.f., then $M$ is flat, and $M \otimes_R R/\mathfrak{m} =
M/\mathfrak{m}M \neq 0$ for all $\mathfrak{m}$ as $R/\mathfrak{m} \neq 0$, by
\rref{easyffcriterion}. So we get one direction.

Alternatively, suppose $M$ is flat and $M \otimes_R R/\mathfrak{m} \neq 0$ for
all maximal $\mathfrak{m}$. Since every proper ideal is contained in a maximal
ideal, it follows that $M \otimes_R R/I \neq 0$ for all proper ideals $I$. We
shall use this and \rref{easyffcriterion} to prove that $M$ is f.f.

Let $N$ now be any nonzero module. Then $N$ contains a \emph{cyclic} submodule, i.e.
one isomorphic to $R/I$ for some proper $I$. The injection
\[ R/I \hookrightarrow N  \]
becomes an injection
\[ R/I \otimes_R M \hookrightarrow N \otimes_R M,  \]
and since $R/I \otimes_R M \neq 0$, we find that $N \otimes_R M \neq 0$. By
\rref{easyffcriterion}, it follows that $M$ is f.f.
\end{proof} 

\begin{corollary} 
A nonzero finitely generated flat module over a \emph{local} ring is faithfully flat.
\end{corollary} 
\begin{proof} 
This follows from \cref{ffmaximal} and Nakayama's lemma. 
\end{proof} 

A \emph{finitely presented} flat module over a local ring is in fact free, but we do not prove
this (except when the ring is noetherian, see \cref{}).
\begin{proof} 
Indeed, let $R$ be a local ring with maximal ideal $\mathfrak{m}$, and $M$ a
finitely generated flat $R$-module. Then by Nakayama's lemma, $M/\mathfrak{m}M
\neq 0$, so that $M$ must be faithfully flat.
\end{proof} 

\begin{proposition} 
Faithfully flat modules are closed under direct sums and tensor products.
\end{proposition} 

\begin{proof} 
Exercise.
\end{proof} 




\subsection{Faithfully flat algebras}

Let $\phi: R \to S$ be a morphism of rings, making $S$ into an $R$-algebra.

\begin{definition} 
$S$ is a \textbf{faithfully flat $R$-algebra} if it is faithfully flat as an
$R$-module.
\end{definition} 

\begin{example} 
The map $R \to R[x]$ from a ring into its polynomial ring is always faithfully
flat. This is clear.
\end{example}

Next, we indicate the usual ``sorite'' for faithfully flat morphisms:
\begin{proposition} 
Faithfully flat morphisms are closed under composition and base change.
\end{proposition} 
That is, if $R \to S$, $S \to T$ are faithfully flat, so is $R \to T$.
Similarly, if $R \to S$ is faithfully flat and $R'$ any $R$-algebra, then $R'
\to S \otimes_R R'$ is faithfully flat.

The reader may wish to try this proof as an exercise.
\begin{proof} 
The first result follows because the composite of the two faithful and exact
functors (tensoring  $ \otimes_R S$ and tensoring  $ \otimes_S T$ gives the
composite $\otimes_R T$) yields a faithful and exact functor. 

In the second case, let $M$ be an $R'$-module. Then $M \otimes_{R'} (R'
\otimes_R S)$ is canonically isomorphic to $M \otimes_R S$. From this it is
clear if the functor $M \mapsto M \otimes_R S$ is faithful and
exact, so is 
$M \mapsto M \otimes_{R'} (R'
\otimes_R S)$.
\end{proof} 

Flat maps are usually injective, but they need not be. For instance, if $R$ is a
product $R_1 \times R_2$, then the projection map $R \to R_1$ is flat.
This never happens for faithfully flat maps.
In particular, a quotient can never be faithfully flat.

\begin{proposition}  \label{ffinjective}
If $S$ is a f.f. $R$-algebra, then the structure map $R \to S$ is injective.
\end{proposition} 
\begin{proof} 
Indeed, let us tensor the map $R \to S $ with $S$, over $R$. We get a morphism
of $S$-modules
\[ S \to S \otimes_R S ,  \]
sending $s \mapsto  1 \otimes s$.
This morphism has an obvious section $S \otimes_R S \to S$ sending $a \otimes b
\mapsto ab$. Since it has a section, it is injective. But faithful flatness says
that the original map $R \to S$ must be injective itself.
\end{proof} 

\begin{example} 
The converse of \cref{ffinjective} definitely fails. Consider the localization $\mathbb{Z}_{(2)}$;
it is a flat $\mathbb{Z}$-algebra, but not faithfully flat (for instance,
tensoring with $\mathbb{Z}/3$ yields zero).
\end{example} 

Flat morphisms need not be injective, but they are locally injective. We shall see this using:
\begin{proposition}  \label{flatlocal}
A flat local homomorphism of local rings is faithfully flat. In particular, it
is injective.
\end{proposition} 
\begin{proof} 
Let $\phi: R \to S$ be a local homomorphism of local rings with maximal ideals
$\mathfrak{m}, \mathfrak{n}$. Then by definition $\phi(\mathfrak{m}) \subset
\mathfrak{n}$. It follows that $S \neq \phi(\mathfrak{m})S$, so by
\rref{ffmaximal} we win.
\end{proof} 
The point of the above proof was, of course, the fact that the
ring-homomorphism was \emph{local}. If we just had that $\phi( \mathfrak{m})S
\subsetneq S$ for every maximal ideal $\mathfrak{m} \subset R$, that would be
sufficient for the argument.

\begin{corollary} 
Let $\phi: R \to S$ be a flat morphism. Let $\mathfrak{q} \in \spec S$,
$\mathfrak{p} = \phi^{-1}(\mathfrak{q})$ the image in $\spec R$. Then 
$R_{\mathfrak{p}} \to S_{\mathfrak{q}}$ is faithfully flat, hence injective.
\end{corollary} 
\begin{proof} 
We only need to show that the map is flat by \cref{flatlocal}. 

\end{proof} 

\subsection{Topological consequences}

There are many topological consequences of faithful flatness on the $\spec$'s.
These are
explored in detail in volume 4-2 of \cite{EGA}. We shall only scratch the
surface.
The reader 
should bear in mind the usual intuition that flatness means that the fibers
``look similar'' to one other. 

\begin{proposition} 
Let $R \to S$ be a faithfully flat morphism of rings. Then the map $\spec S
\to \spec R$ is surjective.
\end{proposition} 

\begin{proof} Since $R \to S$ is injective, we may regard $R$ as a subring of $S$.
We shall first show that:

\begin{lemma} 
If $I \subset R$ is any ideal, then $R \cap IS = I$.
\end{lemma}
\begin{proof} 
To see this, note that the morphism
\[ R/I \to S/IS  \]
is faithfully flat, since faithful flatness is preserved by base-change, and
this is the base-change of $R \to S$ via $R \to R/I$.
In particular, it is injective. Thus $IS \cap R = I$.
\end{proof} 


Now to see surjectivity, we use a general criterion:

\begin{lemma} \label{imagespec}
Let $\phi: R \to S$ be a morphism of rings and suppose $\mathfrak{p} \in \spec
R$. Then $\mathfrak{p}$ is in the image of $\spec S \to \spec R$ if and only if 
$\phi^{-1}( \phi(\mathfrak{p}) S) = \mathfrak{p}$.
\end{lemma} 

This lemma will prove the proposition.
\begin{proof} 
Suppose first that $\mathfrak{p}$ is in the image of $\spec S \to \spec R$. In
this case, there is $\mathfrak{q} \in \spec S$ such that
$ \mathfrak{p}$ is the preimage of $\mathfrak{q}$.
In particular, $\mathfrak{q} \supset \phi(\mathfrak{p})S$, so that, if we take
pre-images,
\[ \mathfrak{p} \supset \phi^{-1}(\phi(\mathfrak{p}) S),  \]
while the other inclusion is obviously true.

Conversely, suppose that $\mathfrak{p} \subset \phi^{-1}(\phi(\mathfrak{p})
S)$. In this case, we know that 
\[ \phi(R  - \mathfrak{p}) \cap \phi(\mathfrak{p})S = \emptyset.  \]
Now $T = \phi(R - \mathfrak{p})$ is a multiplicatively closed subset.
There is a morphism
\begin{equation} \label{randomequationwhichidonthaveanamefor}
R_{\mathfrak{p}} \to T^{-1}S 
\end{equation} 
which sends elements of $\mathfrak{p}$ into non-units, by
\eqref{randomequationwhichidonthaveanamefor} so it is a \emph{local}
homomorphism. The maximal ideal of $T^{-1} S$ pulls back to that of
$R_{\mathfrak{p}}$. By the usual commutative diagrams, it follows that
$\mathfrak{p}$ is the preimage of something in $\spec S$.
\end{proof} 
\end{proof} 

\begin{remark} 
The converse also holds. If $\phi: R \to S$ is a flat morphism of rings such
that $\spec S \to \spec R$ is surjective, then $\phi$ is faithfully flat.
Indeed, \cref{imagespec} shows then that for any prime ideal $\mathfrak{p}
\subset R$, $\phi(\mathfrak{p})$ fails to generate $S$. 
This is sufficient to imply that $S$ is faithfully flat by \cref{ffmaximal}.
\end{remark} 

In fact, one can show that the morphism $\spec S \to \spec R$ is actually an
\emph{identification,} that is, a quotient map. This is true more generally
for faithfully flat and quasi-compact morphisms of schemes; see \cite{EGA},
volume 4-2.

\begin{theorem} 
Let $\phi: R \to S$ be a faithfully flat morphism of rings. Then $\spec S \to
\spec R$ is a quotient map of topological spaces.
\end{theorem} 

In other words, a subset of $\spec R$ is closed if and only if its pre-image
in $\spec S$ is closed.

\begin{proof} 
We need to show that if $F \subset \spec R$ is such that its pre-image in
$\spec S$ is closed, then $F$ itself is closed.  \textbf{ADD THIS PROOF}
\end{proof} 


\begin{exercise} 
Let $R \to S$ be a faithfully flat morphism of rings. If $S$ is noetherian, so
is $R$. The converse is false!
\end{exercise} 


\begin{exercise} Many properties of morphisms of rings are such that if they hold after
one makes a faithfully flat base change, then they hold for the original
morphism.
Here is a simple example.
Suppose $S$ is a faithfully flat $R$-algebra. Let $R'$ be any $R$-algebra.
Suppose $S'  =S \otimes_R R'$ is finitely generated over $R'$. Then $S$ is
finitely generated over $R$. 

To see that, note that $R'$ is the colimit of its finitely generated
$R$-subalgebras $R_\alpha$. Thus $S'$ is the colimit of the $R_\alpha
\otimes_R S$, which inject into $S'$; finite generation implies that one of
the $R_\alpha \otimes_R S \to S'$ is an isomorphism. Now use the fact that
isomorphisms ``descend'' under faithfully flat morphisms.

In algebraic geometry, one can show that many properties of morphisms of
\emph{schemes} allow for descent under faithfully flat base-change. See
\cite{EGA}, volume IV-2.
\end{exercise} 

\section{Faithfully flat descent}

Fix a ring $R$, and let $S$ be an $R$-algebra. Then there is a natural functor
from $R$-modules to $S$-modules sending $N \mapsto S \otimes_R N$.
In this section, we shall be interested in going in the opposite direction,
or in characterizing the image of this functor.
Namely, given an $S$-module, we want to ``descend'' to an $R$-module when
possible; given a morphism of $S$-modules, we want to know when it comes from a
morphism of $R$-modules by base change.

\add{this entire section!}


\subsection{The Amitsur complex}
\add{citation needed}

Suppose $B$ is an $A$-algebra. 
Then we can construct a complex of $A$-modules
\[ 0 \to A \to B \to B \otimes_A B \to B \otimes_A B \otimes_A B \to \dots  \]
as follows. 
For each $n$, we denote by $B^{\otimes n}$ the tensor product of $B$ with
itself $n$ times (over $A$).
There are morphisms of $A$-algebras
\[ d_i: B^{\otimes n} \to B^{\otimes n+1} , \quad 0 \leq i \leq n+1 \]
where the map sends
\[ b_1 \otimes \dots \otimes b_n \mapsto b_1 \otimes \dots \otimes b_{i-1}
\otimes  1 \otimes  b_i \otimes \dots \otimes b_n,  \]
so that the $1$ is placed in the $i$th spot.
Then the coboundary 
$\partial: B^{\otimes n} \to B^{\otimes n+1}$ is defined as $\sum (-1)^i d_i$.
It is easy to check that this forms a complex of $A$-modules.

\begin{definition} 
The above complex of $B$-modules is called the \textbf{Amitsur complex} of $B$
over $A$, and we denote it $\mathcal{A}_{B/A}$. It is clearly functorial in
$B$; a map of $A$-algebras $B \to C$ induces a morphism of complexes
$\mathcal{A}_{B/A} \to \mathcal{A}_{C/A}$.
\end{definition} 

Note that the Amitsur complex behaves very nicely with respect to base-change.
If $A'$ is an $A$-algebra and $B' = B \otimes_A A'$ is the base extension, then 
$\mathcal{A}_{B'/A'}  = \mathcal{A}_{B/A} \otimes_A A'$, which follows easily
from the fact that base-change commutes with tensor products.

In general, the Amitsur complex is not even exact. 
For instance, if it is exact in degree one, then the map $A \to B$ is necessarily injective.
If, however, the morphism is \emph{faithfully flat}, then we do get exactness:

\begin{theorem} 
If $B$ is a faithfully flat $A$-algebra, then the Amitsur complex of $B/A$ is
exact.  In fact, if $M$ is any $A$-module, then $\mathcal{A}_{B/A} \otimes_A
M$ is exact.
\end{theorem} 
\begin{proof} 
We prove this first under the assumption that $A \to B$ has a section. 
In this case, we will even have:

\begin{lemma} 
Suppose $A \to B$ is a morphism of rings with a section $B \to A$. Then the
Amitsur complex $\mathcal{A}_{B/A}$ is homotopically trivial. (In particular,
$\mathcal{A}_{B/A} \otimes_A M$ is acyclic for all $M$.)
\end{lemma} 
\begin{proof} 
Let $s: B \to A$ be the section; by assumption, this is a morphism of
$A$-algebras. We shall define a chain contraction of $\mathcal{A}_{B/A}$. 
To do this, we must define a collection of morphisms of $A$-modules
\( h_{n+1} : B^{\otimes n+1} \to B^{\otimes n},  \)
and this we do by sending 
\[ b_1 \otimes \dots \otimes b_{n+1} \mapsto s(b_{n+1}) \left( b_1 \otimes
\dots \otimes b_n \right).  \]
It is still necessary to check that the $\left\{h_{n+1}\right\}$ form a chain
contraction; in other words, that $\partial h_{n} + h_{n+1} \partial =
1_{B^{\otimes n}}$. 
By linearity, we need only check this on elements of the form $b_1 \otimes
\dots \otimes b_n$. Then we find
\[ \partial h_n (b_1 \otimes b_n) = s(b_1) \sum (-1)^i b_2 \otimes \dots \otimes 1
\otimes \dots \otimes b_n  \]
where the $1$ is in the $i$th place,
while
\[ h_{n+1} \partial ( b_1 \otimes \dots \otimes  b_n) = b_1 \otimes \dots \otimes b_n +
\sum_{i>0} s(b_1) (-1)^{i-1}b_2 \otimes \dots \otimes 1 \otimes \dots \otimes b_n  \]
where again the $1$ is in the $i$th place. The assertion is from this clear.
Note that if $\mathcal{A}_{B/A}$ is contractible, we can tensor the chain
homotopy with $M$ to see that $\mathcal{A}_{B/A} \otimes_A M$ is chain contractible
for any $M$.
\end{proof} 

With this lemma proved, we see that the Amitsur complex $\mathcal{A}_{B/A}$
(or even $\mathcal{A}_{B/A} \otimes_A M$) is acyclic whenever $B/A$ admits a
section. Now if we make the base-change by the morphism $A \to B$, we get the
morphism $B \to B \otimes_A B$. That is,
\[  B \otimes_A \left( \mathcal{A}_{B/A} \otimes_A M \right)= \mathcal{A}_{B
\otimes_A B/B} \otimes_B (M \otimes_A B). \]
The latter is acyclic because $B \to B \otimes_A B$ admits a section (namely,
$b_1 \otimes b_2 \mapsto b_1 b_2$). So the complex $\mathcal{A}_{B/A}
\otimes_A M$ becomes acyclic after base-changing to $B$; this, however, is a
faithfully flat base-extension, so the original complex was itself exact.
\end{proof} 

\begin{remark} 
A powerful use of the Amitsur complex in algebraic geometry is to show that
the cohomology of a quasi-coherent sheaf on an affine scheme is trivial. In
this case, the Cech complex (of a suitable covering) turns out to be precisely
the Amitsur complex (with the faithfully flat morphism $A \to \prod A_{f_i}$
for the $\left\{f_i\right\}$ a family generating the unit ideal). This
argument generalizes to showing that the \emph{{\'e}tale}
cohomology of a quasi-coherent sheaf on an affine is trivial; cf. \cite{Ta94}.
\end{remark} 


\section{The $\tor$ functor}
 

\subsection{Introduction}
Fix $M$. The functor $N \mapsto N \otimes_R M$ is a right-exact functor on the
category of $R$-modules. We can thus consider its \emph{left-derived functors}
as in \cref{homological}. 
Recall:

\begin{definition} 
The derived functors of the tensor product functor $N \mapsto N \otimes_R M$ are denoted by
$\mathrm{Tor} _R^i( N, M), i \geq 0$.  We shall sometimes denote omit the
subscript $R$.
\end{definition} 

So in particular, $\mathrm{Tor} _R^0(M,N) = M \otimes N$.  
A priori, $\tor$ is only a functor of the first variable, but in fact, it is
not hard to see that $\tor$ is a covariant functor of two variables $M, N$. 
In fact, $\tor_R^i(M, N) \simeq \tor_R^i(N, M)$ for any two $R$-modules $M, N$.
For proofs, we refer to \cref{homological}. \textbf{ADD: THEY ARE NOT IN THAT
CHAPTER YET.}

Let us recall the basic properties of $\tor$ that follow from general facts
about derived functors. Given an exact sequence
\[ 0 \to N' \to N \to N'' \to 0 \]
we have a long exact sequence
\[ \mathrm{Tor} ^i(N',M) \to \mathrm{Tor} ^i(N,M) \to \mathrm{Tor} ^i(N'',M ) \to \mathrm{Tor} ^{i-1}(N',M) \to \dots \]
Since $\tor$ is symmetric, we can similarly get a long exact sequence if we
are given a short exact sequence of $M$'s.

Recall, moreover, that $\tor$ can be  computed explicitly (in theory). 
If we have modules $M, N$, and a projective resolution $P_* \to N$, then
$\tor_R^i(M,N)$ is the $i$th homology of the complex $M \otimes P_*$. 
We can use this to compute $\tor$ in the case of abelian groups.

\begin{example} We compute $\tor_{\mathbb{Z}}^*(A, B)$ whenever $A, B $ are abelian groups
and $B$ is finitely generated. This immediately reduces to the case of $B$
either $\mathbb{Z}$ or $\mathbb{Z}/d\mathbb{Z}$ for some $d$ by the
structure theorem. When $B= \mathbb{Z}$, there is nothing to
compute (derived functors are not very interesting on projective objects!).
Let us compute $\tor_{\mathbb{Z}}^*(A, \mathbb{Z}/d\mathbb{Z})$ for an abelian group $A$.


Actually, let us be more general and consider the case where the ring is
replaced by $\mathbb{Z}/m$ for some $m$ such that $d \mid m$. Then we will
compute $\tor_{\mathbb{Z}/m}^*(A, \mathbb{Z}/d)$ for any
$\mathbb{Z}/m$-module $A$.  The case $m = 0$
will handle the ring $\mathbb{Z}$.
Consider the projective resolution
\[ 
\xymatrix{
\cdots \ar[r]^{m/d} & \mathbb{Z}/m\mathbb{Z} \ar[r]^d & \mathbb{Z}/m\mathbb{Z} \ar[r]^{m/d} 
	%& \mathbb{Z}/m\mathbb{Z} \ar[r]^d & \mathbb{Z}/m\mathbb{Z} \ar[r]^{m/d} 
	& \mathbb{Z}/m\mathbb{Z} \ar[r]^{d} & \mathbb{Z}/m\mathbb{Z} \ar[r] & \mathbb{Z}/d\mathbb{Z} \ar[r] & 0.
}
\]
We apply $A \otimes_{\mathbb{Z}/m\mathbb{Z}} \cdot$. Since tensoring (over
$\mathbb{Z}/m$!) with $\mathbb{Z}/m\mathbb{Z}$ does nothing, we  obtain the complex
\[ 
\xymatrix{
\cdots \ar[r]^{m/d} & A \ar[r]^d & A \ar[r]^{m/d} 
	& A \ar[r]^{d} & A \ar[r] & 0.
}
\]
The groups $\Tor_n^{\mathbb{Z}/m\mathbb{Z}} (A, \mathbb{Z}/d\mathbb{Z})$ are simply the homology groups
(ker/im) of
the complex, which are simply 
\begin{align*} 
\Tor_0^{\mathbb{Z} / m\mathbb{Z}} (A, \mathbb{Z}/d\mathbb{Z}) &\cong A / dA \\
\Tor_n^{\mathbb{Z} / m\mathbb{Z}} (A, \mathbb{Z}/d\mathbb{Z}) &\cong {}_dA/(m/d)A 
			\quad \text{$n$ odd, $n \ge 1$} \\
\Tor_n^{\mathbb{Z} / m\mathbb{Z}} (A, \mathbb{Z}/d\mathbb{Z}) &\cong {}_{m/d}A/dA 
			\quad \text{$n$ even, $n \ge 2$},
\end{align*} 
where ${}_kA = \{ a \in A \mid ka = 0 \}$ denotes the set of elements of $A$
killed by $k$.
\end{example} 


The symmetry of the tensor product also provides with a simple proof that
$\tor$ commutes with filtered colimits. 
\begin{proposition} \label{torfilteredcolim}
Let $M$ be an $R$-module, $\left\{N_i\right\}$ a filtered system of
$R$-modules. Then the natural morphism
\[  \varinjlim_i \tor_R^i(M, N_i) \to \tor^i_R(M, \varinjlim_i N_i)   \]
is an isomorphism.
\end{proposition} 
\begin{proof} 
We can see this explicitly. Let us compute the $\tor$ functors by choosing a
projective resolution $P_* \to M$ of $M$ (note that which factor we use is irrelevant, by
symmetry!). Then the left side is the colimit
\( \varinjlim H(P_* \otimes N_i)  \), while the right side is $H(P_* \otimes
\varinjlim N_i)$. But tensor products commute with filtered (or arbitrary)
colimits, since the tensor product admits a right adjoint. Moreover, we know
that homology commutes with filtered colimits. Thus the natural map is an
isomorphism.
\end{proof} 


\subsection{$\tor$ and flatness}

$\tor$ provides a simple way of detecting flatness. Indeed, one of the basic applications of this is that for a flat module $M$, the tor-functors vanish for $i \geq 1$ (whatever be $N$).
Indeed, recall that $\mathrm{Tor} (M,N)$ is computed by taking a projective resolution of $N$,
\[ \dots \to P_2 \to P_1 \to P_0 \to M \to 0 \]
tensoring with $M$, and taking the homology.  But tensoring with $M$ is exact if we have flatness, so the higher $\mathrm{Tor} $ modules vanish.

The converse is also true. In fact, something even stronger holds:
\begin{proposition} $M$ is flat iff $\mathrm{Tor} ^1(M,R/I)=0$ for all finitely generated ideals $I \subset R$.
\end{proposition}
\begin{proof}
We have just seen one direction. 
Conversely, suppose $\mathrm{Tor} ^i(M,R/I) = 0$ for all finitely generated
ideals $I$ and $i>0$. 
Then the result holds, first of all, for all ideals $I$, because of
\cref{torfilteredcolim} and the fact that $R/I$ is always the colimit of $R/J$
as $J$ ranges over finitely generated ideals $J \subset I$.

We now show that $\tor^i(M, N) = 0$ whenever $N$ is finitely generated. To do
this, we induct on the number of generators of $N$. When $N$ has one
generator, it is cyclic and we are done. Suppose we have proved the result
whenever for modules that have $n-1$ generators or less, and suppose $N$ has
$n$ generators.
Then we can consider an exact sequence of the form
\[ 0 \to N' \hookrightarrow N \twoheadrightarrow N'' \to 0  \]
where $N'$ has $n-1$ generators and $N''$ is cyclic. Then the long exact
sequence shows that $\tor^i(M, N) = 0$ for all $i \geq 1$.

Thus we see that $\tor^i(M, N)  = 0$ whenever $N$ is finitely generated. Since
any module is a filtered colimit of finitely generated ones, we are done by
\cref{torfilteredcolim}.
\end{proof}


Note that there is an exact sequence $0 \to I \to R \to R/I \to 0$ and
so
\[ \mathrm{Tor} _1(M,R)=0 \to \mathrm{Tor} _1(M,R/I) \to I \otimes M \to M \]
is exact, and by this:

\begin{corollary} 
If the map
\[ I \otimes M \to M \]
is injective for all ideals $I$, then $M$ is flat.
\end{corollary} 

\subsection{Flatness over a noetherian local ring}

Let $R$ be a noetherian local ring with maximal ideal $\mathfrak{m}$ and residue field $k$, $S$ be a local finitely generated $R$-algebra with $\mathfrak{m}S \subset \mathfrak{n}$ for $\mathfrak{n}$ the maximal ideal of $S$, and $M$ a finitely generated $S$-module.

The first basic result is:
\begin{theorem} $M$ is flat over $R$ iff
\[ \mathrm{Tor} ^1_R( k, M) = 0.\]
In this case, $M$ is even free.
\end{theorem}

\begin{proof} 
Necessity is immediate.  What we have to prove is sufficiency.

First, I make the following claim. If $N$ is an $R$-module of finite length, then
\[ \mathrm{Tor} ^1_R( N, M)=0.\]
This is because $N$ has by devissage a filtration $N_i$ whose quotients are of the form $R/\mathfrak{p}$ for $\mathfrak{p}$ prime and (by finite length hypothesis) $\mathfrak{p}= \mathfrak{m}$.  
Then the result is true $N_0=0 \subset N$ trivially.  We climb up the filtration piece by piece inductively; if $\mathrm{Tor} ^1_R(N_i, M)=0$, then the exact sequence
\[ 0 \to N_i \to N_{i+1} \to k \to 0 \]
yields
\[ \mathrm{Tor} ^1_R(N_i, M) \to \mathrm{Tor} ^1_R(N_{i+1}, M) \to 0 \]
from the long exact sequence of $\mathrm{Tor} $ and the hypothesis on $M$.
The claim is proved.


The idea behind this proof is to show that $I \otimes_RM \to M$ is injective for any $I \subset R$.  We will use some diagram chasing and the Krull intersection theorem on the kernel $K$ of this map, to interpolate between it and various quotients by powers of $\mathfrak{m}$.
First we write some exact sequences.

We have an exact sequence
\[ 0 \to \mathfrak{m}^t \cap I \to I \to I/I \cap \mathfrak{m}^t \to 0\]
which we tensor with $M$:
\[   \mathfrak{m}^t \cap I \otimes M \to I \otimes M \to I/I \cap \mathfrak{m}^t \otimes M \to 0.\]

The sequence
\[ 0 \to  I/I  \cap \mathfrak{m}^t \to R/\mathfrak{m}^t \to R/(I+\mathfrak{m}^t) \to 0\]
is also exact, and tensoring with $M$ yields an exact sequence:
\[ 0 \to  I/I  \cap \mathfrak{m}^t \otimes M  \to M/\mathfrak{m}^tM  \to M/(\mathfrak{m}^t  + I) M \to 0\]
because $\mathrm{Tor} ^1_R(M,   R/(I+\mathfrak{m}^t))=0$ (finite length hypothesis.


Let us draw the following commutative diagram:\\
\xymatrix{
& & 0 \ar[d] \\
\mathfrak{m}^t \cap I \otimes M \ar[r] & I \otimes M \ar[r] & I/I \cap \mathfrak{m}^t \otimes M \ar[d] \\
& & M/\mathfrak{m}^t M 
}

where the column and the row are exact.
As a result, if an element in $I \otimes M$ goes to zero in $M$ (a fortiori in  $M/\mathfrak{m}^tM$) it must come from $\mathfrak{m}^t \cap I \otimes M$ for all $t$.  Thus it belongs to $\mathfrak{m}^t(I \otimes M)$ for all $t$, and the Krull intersection theorem (applied to $S$, since $\mathfrak{m}S \subset \mathfrak{n}$) implies it is zero.

\end{proof} 

\subsection{The infinitesimal criterion}

\begin{theorem} Let $M$ be a module over a noetherian local ring $R$.  Then $M$ is flat iff $M/\mathfrak{m}^tM$ is flat over $R/\mathfrak{m}^t$ for all $t>0$.
\end{theorem}
\begin{proof} 
One direction is easy, because if $M$ is a flat $R$-module and $S$ an $R$-algebra, then $M \otimes_R S$ is flat over $S$. 
For the other direction, take the same commutative diagram as before:\\
\xymatrix{
& & 0 \ar[d] \\
\mathfrak{m}^t \cap I \otimes M \ar[r] & I \otimes M \ar[r] & I/I \cap \mathfrak{m}^t \otimes M \ar[d] \\
& & M/\mathfrak{m}^t M 
}

The horizontal sequence was always exact.  The vertical sequence can be argued to be exact by tensoring the exact sequence 
\[ 0 \to  I/I  \cap \mathfrak{m}^t \to R/\mathfrak{m}^t \to R/(I+\mathfrak{m}^t) \to 0\]
of $R/\mathfrak{m}^t$-modules with $M/\mathfrak{m}^tM$, and using flatness.
Thus we get flatness of $M$ as before.

\end{proof} 
Incidentally, if we combine the local and infinitesimal criteria fo flatness, we get a little more.

